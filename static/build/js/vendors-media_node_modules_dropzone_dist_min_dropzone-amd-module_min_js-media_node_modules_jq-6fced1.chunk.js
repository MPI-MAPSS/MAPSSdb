/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackChunkmapss"] = self["webpackChunkmapss"] || []).push([["vendors-media_node_modules_dropzone_dist_min_dropzone-amd-module_min_js-media_node_modules_jq-6fced1"],{

/***/ "./media/node_modules/dropzone/dist/min/dropzone-amd-module.min.js":
/*!*************************************************************************!*\
  !*** ./media/node_modules/dropzone/dist/min/dropzone-amd-module.min.js ***!
  \*************************************************************************/
/***/ ((module, exports, __webpack_require__) => {

eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!function(e){ true?!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(/*! jquery */ \"./media/node_modules/jquery/dist/jquery.min.js\")], __WEBPACK_AMD_DEFINE_FACTORY__ = (e),\n\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__)):0}(function(e){var t={exports:{}};function n(e){return(n=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e})(e)}function a(e,t){return!t||\"object\"!==n(t)&&\"function\"!=typeof t?s(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}var c=function(){function e(){u(this,e)}return o(e,[{key:\"on\",value:function(e,t){return this._callbacks=this._callbacks||{},this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(t),this}},{key:\"emit\",value:function(e){this._callbacks=this._callbacks||{};var t=this._callbacks[e];if(t){for(var n=arguments.length,i=new Array(1<n?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];var o=!0,a=!1,l=void 0;try{for(var s,u=t[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){s.value.apply(this,i)}}catch(e){a=!0,l=e}finally{try{o||null==u.return||u.return()}finally{if(a)throw l}}}return this}},{key:\"off\",value:function(e,t){if(!this._callbacks||0===arguments.length)return this._callbacks={},this;var n=this._callbacks[e];if(!n)return this;if(1===arguments.length)return delete this._callbacks[e],this;for(var i=0;i<n.length;i++){if(n[i]===t){n.splice(i,1);break}}return this}}]),e}(),d=function(){function z(e,t){var n,i,r;if(u(this,z),(n=a(this,l(z).call(this))).element=e,n.version=z.version,n.defaultOptions.previewTemplate=n.defaultOptions.previewTemplate.replace(/\\n*/g,\"\"),n.clickableElements=[],n.listeners=[],n.files=[],\"string\"==typeof n.element&&(n.element=document.querySelector(n.element)),!n.element||null==n.element.nodeType)throw new Error(\"Invalid dropzone element.\");if(n.element.dropzone)throw new Error(\"Dropzone already attached.\");z.instances.push(s(n)),n.element.dropzone=s(n);var o=null!=(r=z.optionsForElement(n.element))?r:{};if(n.options=z.extend({},n.defaultOptions,o,null!=t?t:{}),n.options.forceFallback||!z.isBrowserSupported())return a(n,n.options.fallback.call(s(n)));if(null==n.options.url&&(n.options.url=n.element.getAttribute(\"action\")),!n.options.url)throw new Error(\"No URL provided.\");if(n.options.acceptedFiles&&n.options.acceptedMimeTypes)throw new Error(\"You can't provide both 'acceptedFiles' and 'acceptedMimeTypes'. 'acceptedMimeTypes' is deprecated.\");if(n.options.uploadMultiple&&n.options.chunking)throw new Error(\"You cannot set both: uploadMultiple and chunking.\");return n.options.acceptedMimeTypes&&(n.options.acceptedFiles=n.options.acceptedMimeTypes,delete n.options.acceptedMimeTypes),null!=n.options.renameFilename&&(n.options.renameFile=function(e){return n.options.renameFilename.call(s(n),e.name,e)}),n.options.method=n.options.method.toUpperCase(),(i=n.getExistingFallback())&&i.parentNode&&i.parentNode.removeChild(i),!1!==n.options.previewsContainer&&(n.options.previewsContainer?n.previewsContainer=z.getElement(n.options.previewsContainer,\"previewsContainer\"):n.previewsContainer=n.element),n.options.clickable&&(!0===n.options.clickable?n.clickableElements=[n.element]:n.clickableElements=z.getElements(n.options.clickable,\"clickable\")),n.init(),n}return function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(z,c),o(z,null,[{key:\"initClass\",value:function(){this.prototype.Emitter=c,this.prototype.events=[\"drop\",\"dragstart\",\"dragend\",\"dragenter\",\"dragover\",\"dragleave\",\"addedfile\",\"addedfiles\",\"removedfile\",\"thumbnail\",\"error\",\"errormultiple\",\"processing\",\"processingmultiple\",\"uploadprogress\",\"totaluploadprogress\",\"sending\",\"sendingmultiple\",\"success\",\"successmultiple\",\"canceled\",\"canceledmultiple\",\"complete\",\"completemultiple\",\"reset\",\"maxfilesexceeded\",\"maxfilesreached\",\"queuecomplete\"],this.prototype.defaultOptions={url:null,method:\"post\",withCredentials:!1,timeout:3e4,parallelUploads:2,uploadMultiple:!1,chunking:!1,forceChunking:!1,chunkSize:2e6,parallelChunkUploads:!1,retryChunks:!1,retryChunksLimit:3,maxFilesize:256,paramName:\"file\",createImageThumbnails:!0,maxThumbnailFilesize:10,thumbnailWidth:120,thumbnailHeight:120,thumbnailMethod:\"crop\",resizeWidth:null,resizeHeight:null,resizeMimeType:null,resizeQuality:.8,resizeMethod:\"contain\",filesizeBase:1e3,maxFiles:null,headers:null,clickable:!0,ignoreHiddenFiles:!0,acceptedFiles:null,acceptedMimeTypes:null,autoProcessQueue:!0,autoQueue:!0,addRemoveLinks:!1,previewsContainer:null,hiddenInputContainer:\"body\",capture:null,renameFilename:null,renameFile:null,forceFallback:!1,dictDefaultMessage:\"Drop files here to upload\",dictFallbackMessage:\"Your browser does not support drag'n'drop file uploads.\",dictFallbackText:\"Please use the fallback form below to upload your files like in the olden days.\",dictFileTooBig:\"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.\",dictInvalidFileType:\"You can't upload files of this type.\",dictResponseError:\"Server responded with {{statusCode}} code.\",dictCancelUpload:\"Cancel upload\",dictUploadCanceled:\"Upload canceled.\",dictCancelUploadConfirmation:\"Are you sure you want to cancel this upload?\",dictRemoveFile:\"Remove file\",dictRemoveFileConfirmation:null,dictMaxFilesExceeded:\"You can not upload any more files.\",dictFileSizeUnits:{tb:\"TB\",gb:\"GB\",mb:\"MB\",kb:\"KB\",b:\"b\"},init:function(){},params:function(e,t,n){if(n)return{dzuuid:n.file.upload.uuid,dzchunkindex:n.index,dztotalfilesize:n.file.size,dzchunksize:this.options.chunkSize,dztotalchunkcount:n.file.upload.totalChunkCount,dzchunkbyteoffset:n.index*this.options.chunkSize}},accept:function(e,t){return t()},chunksUploaded:function(e,t){t()},fallback:function(){var e;this.element.className=\"\".concat(this.element.className,\" dz-browser-not-supported\");var t=!0,n=!1,i=void 0;try{for(var r,o=this.element.getElementsByTagName(\"div\")[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var a=r.value;if(/(^| )dz-message($| )/.test(a.className)){(e=a).className=\"dz-message\";break}}}catch(e){n=!0,i=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}e||(e=z.createElement('<div class=\"dz-message\"><span></span></div>'),this.element.appendChild(e));var l=e.getElementsByTagName(\"span\")[0];return l&&(null!=l.textContent?l.textContent=this.options.dictFallbackMessage:null!=l.innerText&&(l.innerText=this.options.dictFallbackMessage)),this.element.appendChild(this.getFallbackForm())},resize:function(e,t,n,i){var r={srcX:0,srcY:0,srcWidth:e.width,srcHeight:e.height},o=e.width/e.height;null==t&&null==n?(t=r.srcWidth,n=r.srcHeight):null==t?t=n*o:null==n&&(n=t/o);var a=(t=Math.min(t,r.srcWidth))/(n=Math.min(n,r.srcHeight));if(r.srcWidth>t||r.srcHeight>n)if(\"crop\"===i)a<o?(r.srcHeight=e.height,r.srcWidth=r.srcHeight*a):(r.srcWidth=e.width,r.srcHeight=r.srcWidth/a);else{if(\"contain\"!==i)throw new Error(\"Unknown resizeMethod '\".concat(i,\"'\"));a<o?n=t/o:t=n*o}return r.srcX=(e.width-r.srcWidth)/2,r.srcY=(e.height-r.srcHeight)/2,r.trgWidth=t,r.trgHeight=n,r},transformFile:function(e,t){return(this.options.resizeWidth||this.options.resizeHeight)&&e.type.match(/image.*/)?this.resizeImage(e,this.options.resizeWidth,this.options.resizeHeight,this.options.resizeMethod,t):t(e)},previewTemplate:'<div class=\"dz-preview dz-file-preview\">\\n  <div class=\"dz-image\"><img data-dz-thumbnail /></div>\\n  <div class=\"dz-details\">\\n    <div class=\"dz-size\"><span data-dz-size></span></div>\\n    <div class=\"dz-filename\"><span data-dz-name></span></div>\\n  </div>\\n  <div class=\"dz-progress\"><span class=\"dz-upload\" data-dz-uploadprogress></span></div>\\n  <div class=\"dz-error-message\"><span data-dz-errormessage></span></div>\\n  <div class=\"dz-success-mark\">\\n    <svg width=\"54px\" height=\"54px\" viewBox=\"0 0 54 54\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\\n      <title>Check</title>\\n      <g stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\\n        <path d=\"M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z\" stroke-opacity=\"0.198794158\" stroke=\"#747474\" fill-opacity=\"0.816519475\" fill=\"#FFFFFF\"></path>\\n      </g>\\n    </svg>\\n  </div>\\n  <div class=\"dz-error-mark\">\\n    <svg width=\"54px\" height=\"54px\" viewBox=\"0 0 54 54\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\\n      <title>Error</title>\\n      <g stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\\n        <g stroke=\"#747474\" stroke-opacity=\"0.198794158\" fill=\"#FFFFFF\" fill-opacity=\"0.816519475\">\\n          <path d=\"M32.6568542,29 L38.3106978,23.3461564 C39.8771021,21.7797521 39.8758057,19.2483887 38.3137085,17.6862915 C36.7547899,16.1273729 34.2176035,16.1255422 32.6538436,17.6893022 L27,23.3431458 L21.3461564,17.6893022 C19.7823965,16.1255422 17.2452101,16.1273729 15.6862915,17.6862915 C14.1241943,19.2483887 14.1228979,21.7797521 15.6893022,23.3461564 L21.3431458,29 L15.6893022,34.6538436 C14.1228979,36.2202479 14.1241943,38.7516113 15.6862915,40.3137085 C17.2452101,41.8726271 19.7823965,41.8744578 21.3461564,40.3106978 L27,34.6568542 L32.6538436,40.3106978 C34.2176035,41.8744578 36.7547899,41.8726271 38.3137085,40.3137085 C39.8758057,38.7516113 39.8771021,36.2202479 38.3106978,34.6538436 L32.6568542,29 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z\"></path>\\n        </g>\\n      </g>\\n    </svg>\\n  </div>\\n</div>',drop:function(){return this.element.classList.remove(\"dz-drag-hover\")},dragstart:function(){},dragend:function(){return this.element.classList.remove(\"dz-drag-hover\")},dragenter:function(){return this.element.classList.add(\"dz-drag-hover\")},dragover:function(){return this.element.classList.add(\"dz-drag-hover\")},dragleave:function(){return this.element.classList.remove(\"dz-drag-hover\")},paste:function(){},reset:function(){return this.element.classList.remove(\"dz-started\")},addedfile:function(t){var n=this;if(this.element===this.previewsContainer&&this.element.classList.add(\"dz-started\"),this.previewsContainer){t.previewElement=z.createElement(this.options.previewTemplate.trim()),t.previewTemplate=t.previewElement,this.previewsContainer.appendChild(t.previewElement);var e=!0,i=!1,r=void 0;try{for(var o,a=t.previewElement.querySelectorAll(\"[data-dz-name]\")[Symbol.iterator]();!(e=(o=a.next()).done);e=!0){var l=o.value;l.textContent=t.name}}catch(e){i=!0,r=e}finally{try{e||null==a.return||a.return()}finally{if(i)throw r}}var s=!0,u=!1,c=void 0;try{for(var d,h=t.previewElement.querySelectorAll(\"[data-dz-size]\")[Symbol.iterator]();!(s=(d=h.next()).done);s=!0)(l=d.value).innerHTML=this.filesize(t.size)}catch(e){u=!0,c=e}finally{try{s||null==h.return||h.return()}finally{if(u)throw c}}this.options.addRemoveLinks&&(t._removeLink=z.createElement('<a class=\"dz-remove\" href=\"javascript:undefined;\" data-dz-remove>'.concat(this.options.dictRemoveFile,\"</a>\")),t.previewElement.appendChild(t._removeLink));function p(e){return e.preventDefault(),e.stopPropagation(),t.status===z.UPLOADING?z.confirm(n.options.dictCancelUploadConfirmation,function(){return n.removeFile(t)}):n.options.dictRemoveFileConfirmation?z.confirm(n.options.dictRemoveFileConfirmation,function(){return n.removeFile(t)}):n.removeFile(t)}var f=!0,v=!1,m=void 0;try{for(var y,g=t.previewElement.querySelectorAll(\"[data-dz-remove]\")[Symbol.iterator]();!(f=(y=g.next()).done);f=!0){y.value.addEventListener(\"click\",p)}}catch(e){v=!0,m=e}finally{try{f||null==g.return||g.return()}finally{if(v)throw m}}}},removedfile:function(e){return null!=e.previewElement&&null!=e.previewElement.parentNode&&e.previewElement.parentNode.removeChild(e.previewElement),this._updateMaxFilesReachedClass()},thumbnail:function(e,t){if(e.previewElement){e.previewElement.classList.remove(\"dz-file-preview\");var n=!0,i=!1,r=void 0;try{for(var o,a=e.previewElement.querySelectorAll(\"[data-dz-thumbnail]\")[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var l=o.value;l.alt=e.name,l.src=t}}catch(e){i=!0,r=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw r}}return setTimeout(function(){return e.previewElement.classList.add(\"dz-image-preview\")},1)}},error:function(e,t){if(e.previewElement){e.previewElement.classList.add(\"dz-error\"),\"String\"!=typeof t&&t.error&&(t=t.error);var n=!0,i=!1,r=void 0;try{for(var o,a=e.previewElement.querySelectorAll(\"[data-dz-errormessage]\")[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){o.value.textContent=t}}catch(e){i=!0,r=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw r}}}},errormultiple:function(){},processing:function(e){if(e.previewElement&&(e.previewElement.classList.add(\"dz-processing\"),e._removeLink))return e._removeLink.innerHTML=this.options.dictCancelUpload},processingmultiple:function(){},uploadprogress:function(e,t){if(e.previewElement){var n=!0,i=!1,r=void 0;try{for(var o,a=e.previewElement.querySelectorAll(\"[data-dz-uploadprogress]\")[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var l=o.value;\"PROGRESS\"===l.nodeName?l.value=t:l.style.width=\"\".concat(t,\"%\")}}catch(e){i=!0,r=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw r}}}},totaluploadprogress:function(){},sending:function(){},sendingmultiple:function(){},success:function(e){if(e.previewElement)return e.previewElement.classList.add(\"dz-success\")},successmultiple:function(){},canceled:function(e){return this.emit(\"error\",e,this.options.dictUploadCanceled)},canceledmultiple:function(){},complete:function(e){if(e._removeLink&&(e._removeLink.innerHTML=this.options.dictRemoveFile),e.previewElement)return e.previewElement.classList.add(\"dz-complete\")},completemultiple:function(){},maxfilesexceeded:function(){},maxfilesreached:function(){},queuecomplete:function(){},addedfiles:function(){}},this.prototype._thumbnailQueue=[],this.prototype._processingThumbnail=!1}},{key:\"extend\",value:function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(var r=0,o=n;r<o.length;r++){var a=o[r];for(var l in a){var s=a[l];e[l]=s}}return e}}]),o(z,[{key:\"getAcceptedFiles\",value:function(){return this.files.filter(function(e){return e.accepted}).map(function(e){return e})}},{key:\"getRejectedFiles\",value:function(){return this.files.filter(function(e){return!e.accepted}).map(function(e){return e})}},{key:\"getFilesWithStatus\",value:function(t){return this.files.filter(function(e){return e.status===t}).map(function(e){return e})}},{key:\"getQueuedFiles\",value:function(){return this.getFilesWithStatus(z.QUEUED)}},{key:\"getUploadingFiles\",value:function(){return this.getFilesWithStatus(z.UPLOADING)}},{key:\"getAddedFiles\",value:function(){return this.getFilesWithStatus(z.ADDED)}},{key:\"getActiveFiles\",value:function(){return this.files.filter(function(e){return e.status===z.UPLOADING||e.status===z.QUEUED}).map(function(e){return e})}},{key:\"init\",value:function(){var s=this;if(\"form\"===this.element.tagName&&this.element.setAttribute(\"enctype\",\"multipart/form-data\"),this.element.classList.contains(\"dropzone\")&&!this.element.querySelector(\".dz-message\")&&this.element.appendChild(z.createElement('<div class=\"dz-default dz-message\"><button class=\"dz-button\" type=\"button\">'.concat(this.options.dictDefaultMessage,\"</button></div>\"))),this.clickableElements.length){!function l(){return s.hiddenFileInput&&s.hiddenFileInput.parentNode.removeChild(s.hiddenFileInput),s.hiddenFileInput=document.createElement(\"input\"),s.hiddenFileInput.setAttribute(\"type\",\"file\"),(null===s.options.maxFiles||1<s.options.maxFiles)&&s.hiddenFileInput.setAttribute(\"multiple\",\"multiple\"),s.hiddenFileInput.className=\"dz-hidden-input\",null!==s.options.acceptedFiles&&s.hiddenFileInput.setAttribute(\"accept\",s.options.acceptedFiles),null!==s.options.capture&&s.hiddenFileInput.setAttribute(\"capture\",s.options.capture),s.hiddenFileInput.style.visibility=\"hidden\",s.hiddenFileInput.style.position=\"absolute\",s.hiddenFileInput.style.top=\"0\",s.hiddenFileInput.style.left=\"0\",s.hiddenFileInput.style.height=\"0\",s.hiddenFileInput.style.width=\"0\",z.getElement(s.options.hiddenInputContainer,\"hiddenInputContainer\").appendChild(s.hiddenFileInput),s.hiddenFileInput.addEventListener(\"change\",function(){var e=s.hiddenFileInput.files;if(e.length){var t=!0,n=!1,i=void 0;try{for(var r,o=e[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var a=r.value;s.addFile(a)}}catch(e){n=!0,i=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}}return s.emit(\"addedfiles\",e),l()})}()}this.URL=null!==window.URL?window.URL:window.webkitURL;var e=!0,t=!1,n=void 0;try{for(var i,r=this.events[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){var o=i.value;this.on(o,this.options[o])}}catch(e){t=!0,n=e}finally{try{e||null==r.return||r.return()}finally{if(t)throw n}}this.on(\"uploadprogress\",function(){return s.updateTotalUploadProgress()}),this.on(\"removedfile\",function(){return s.updateTotalUploadProgress()}),this.on(\"canceled\",function(e){return s.emit(\"complete\",e)}),this.on(\"complete\",function(e){if(0===s.getAddedFiles().length&&0===s.getUploadingFiles().length&&0===s.getQueuedFiles().length)return setTimeout(function(){return s.emit(\"queuecomplete\")},0)});function a(e){var t;return(t=e).dataTransfer.types&&t.dataTransfer.types.some(function(e){return\"Files\"==e})&&(e.stopPropagation(),e.preventDefault?e.preventDefault():e.returnValue=!1)}return this.listeners=[{element:this.element,events:{dragstart:function(e){return s.emit(\"dragstart\",e)},dragenter:function(e){return a(e),s.emit(\"dragenter\",e)},dragover:function(e){var t;try{t=e.dataTransfer.effectAllowed}catch(e){}return e.dataTransfer.dropEffect=\"move\"===t||\"linkMove\"===t?\"move\":\"copy\",a(e),s.emit(\"dragover\",e)},dragleave:function(e){return s.emit(\"dragleave\",e)},drop:function(e){return a(e),s.drop(e)},dragend:function(e){return s.emit(\"dragend\",e)}}}],this.clickableElements.forEach(function(t){return s.listeners.push({element:t,events:{click:function(e){return t===s.element&&e.target!==s.element&&!z.elementInside(e.target,s.element.querySelector(\".dz-message\"))||s.hiddenFileInput.click(),!0}}})}),this.enable(),this.options.init.call(this)}},{key:\"destroy\",value:function(){return this.disable(),this.removeAllFiles(!0),null!=this.hiddenFileInput&&this.hiddenFileInput.parentNode&&(this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput),this.hiddenFileInput=null),delete this.element.dropzone,z.instances.splice(z.instances.indexOf(this),1)}},{key:\"updateTotalUploadProgress\",value:function(){var e,t=0,n=0;if(this.getActiveFiles().length){var i=!0,r=!1,o=void 0;try{for(var a,l=this.getActiveFiles()[Symbol.iterator]();!(i=(a=l.next()).done);i=!0){var s=a.value;t+=s.upload.bytesSent,n+=s.upload.total}}catch(e){r=!0,o=e}finally{try{i||null==l.return||l.return()}finally{if(r)throw o}}e=100*t/n}else e=100;return this.emit(\"totaluploadprogress\",e,n,t)}},{key:\"_getParamName\",value:function(e){return\"function\"==typeof this.options.paramName?this.options.paramName(e):\"\".concat(this.options.paramName).concat(this.options.uploadMultiple?\"[\".concat(e,\"]\"):\"\")}},{key:\"_renameFile\",value:function(e){return\"function\"!=typeof this.options.renameFile?e.name:this.options.renameFile(e)}},{key:\"getFallbackForm\",value:function(){var e,t;if(e=this.getExistingFallback())return e;var n='<div class=\"dz-fallback\">';this.options.dictFallbackText&&(n+=\"<p>\".concat(this.options.dictFallbackText,\"</p>\")),n+='<input type=\"file\" name=\"'.concat(this._getParamName(0),'\" ').concat(this.options.uploadMultiple?'multiple=\"multiple\"':void 0,' /><input type=\"submit\" value=\"Upload!\"></div>');var i=z.createElement(n);return\"FORM\"!==this.element.tagName?(t=z.createElement('<form action=\"'.concat(this.options.url,'\" enctype=\"multipart/form-data\" method=\"').concat(this.options.method,'\"></form>'))).appendChild(i):(this.element.setAttribute(\"enctype\",\"multipart/form-data\"),this.element.setAttribute(\"method\",this.options.method)),null!=t?t:i}},{key:\"getExistingFallback\",value:function(){function e(e){var t=!0,n=!1,i=void 0;try{for(var r,o=e[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var a=r.value;if(/(^| )fallback($| )/.test(a.className))return a}}catch(e){n=!0,i=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}}for(var t=0,n=[\"div\",\"form\"];t<n.length;t++){var i,r=n[t];if(i=e(this.element.getElementsByTagName(r)))return i}}},{key:\"setupEventListeners\",value:function(){return this.listeners.map(function(i){return function(){var e=[];for(var t in i.events){var n=i.events[t];e.push(i.element.addEventListener(t,n,!1))}return e}()})}},{key:\"removeEventListeners\",value:function(){return this.listeners.map(function(i){return function(){var e=[];for(var t in i.events){var n=i.events[t];e.push(i.element.removeEventListener(t,n,!1))}return e}()})}},{key:\"disable\",value:function(){var t=this;return this.clickableElements.forEach(function(e){return e.classList.remove(\"dz-clickable\")}),this.removeEventListeners(),this.disabled=!0,this.files.map(function(e){return t.cancelUpload(e)})}},{key:\"enable\",value:function(){return delete this.disabled,this.clickableElements.forEach(function(e){return e.classList.add(\"dz-clickable\")}),this.setupEventListeners()}},{key:\"filesize\",value:function(e){var t=0,n=\"b\";if(0<e){for(var i=[\"tb\",\"gb\",\"mb\",\"kb\",\"b\"],r=0;r<i.length;r++){var o=i[r];if(Math.pow(this.options.filesizeBase,4-r)/10<=e){t=e/Math.pow(this.options.filesizeBase,4-r),n=o;break}}t=Math.round(10*t)/10}return\"<strong>\".concat(t,\"</strong> \").concat(this.options.dictFileSizeUnits[n])}},{key:\"_updateMaxFilesReachedClass\",value:function(){return null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(this.getAcceptedFiles().length===this.options.maxFiles&&this.emit(\"maxfilesreached\",this.files),this.element.classList.add(\"dz-max-files-reached\")):this.element.classList.remove(\"dz-max-files-reached\")}},{key:\"drop\",value:function(e){if(e.dataTransfer){this.emit(\"drop\",e);for(var t=[],n=0;n<e.dataTransfer.files.length;n++)t[n]=e.dataTransfer.files[n];if(t.length){var i=e.dataTransfer.items;i&&i.length&&null!=i[0].webkitGetAsEntry?this._addFilesFromItems(i):this.handleFiles(t)}this.emit(\"addedfiles\",t)}}},{key:\"paste\",value:function(e){if(null!=(t=null!=e?e.clipboardData:void 0,n=function(e){return e.items},null!=t?n(t):void 0)){var t,n;this.emit(\"paste\",e);var i=e.clipboardData.items;return i.length?this._addFilesFromItems(i):void 0}}},{key:\"handleFiles\",value:function(e){var t=!0,n=!1,i=void 0;try{for(var r,o=e[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var a=r.value;this.addFile(a)}}catch(e){n=!0,i=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}}},{key:\"_addFilesFromItems\",value:function(s){var u=this;return function(){var e=[],t=!0,n=!1,i=void 0;try{for(var r,o=s[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var a,l=r.value;null!=l.webkitGetAsEntry&&(a=l.webkitGetAsEntry())?a.isFile?e.push(u.addFile(l.getAsFile())):a.isDirectory?e.push(u._addFilesFromDirectory(a,a.name)):e.push(void 0):null!=l.getAsFile&&(null==l.kind||\"file\"===l.kind)?e.push(u.addFile(l.getAsFile())):e.push(void 0)}}catch(e){n=!0,i=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}return e}()}},{key:\"_addFilesFromDirectory\",value:function(e,s){function t(t){return e=console,n=\"log\",i=function(e){return e.log(t)},null!=e&&\"function\"==typeof e[n]?i(e,n):void 0;var e,n,i}var u=this,n=e.createReader();return function l(){return n.readEntries(function(e){if(0<e.length){var t=!0,n=!1,i=void 0;try{for(var r,o=e[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var a=r.value;a.isFile?a.file(function(e){if(!u.options.ignoreHiddenFiles||\".\"!==e.name.substring(0,1))return e.fullPath=\"\".concat(s,\"/\").concat(e.name),u.addFile(e)}):a.isDirectory&&u._addFilesFromDirectory(a,\"\".concat(s,\"/\").concat(a.name))}}catch(e){n=!0,i=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}l()}return null},t)}()}},{key:\"accept\",value:function(e,t){this.options.maxFilesize&&e.size>1024*this.options.maxFilesize*1024?t(this.options.dictFileTooBig.replace(\"{{filesize}}\",Math.round(e.size/1024/10.24)/100).replace(\"{{maxFilesize}}\",this.options.maxFilesize)):z.isValidFile(e,this.options.acceptedFiles)?null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(t(this.options.dictMaxFilesExceeded.replace(\"{{maxFiles}}\",this.options.maxFiles)),this.emit(\"maxfilesexceeded\",e)):this.options.accept.call(this,e,t):t(this.options.dictInvalidFileType)}},{key:\"addFile\",value:function(t){var n=this;t.upload={uuid:z.uuidv4(),progress:0,total:t.size,bytesSent:0,filename:this._renameFile(t)},this.files.push(t),t.status=z.ADDED,this.emit(\"addedfile\",t),this._enqueueThumbnail(t),this.accept(t,function(e){e?(t.accepted=!1,n._errorProcessing([t],e)):(t.accepted=!0,n.options.autoQueue&&n.enqueueFile(t)),n._updateMaxFilesReachedClass()})}},{key:\"enqueueFiles\",value:function(e){var t=!0,n=!1,i=void 0;try{for(var r,o=e[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var a=r.value;this.enqueueFile(a)}}catch(e){n=!0,i=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}return null}},{key:\"enqueueFile\",value:function(e){var t=this;if(e.status!==z.ADDED||!0!==e.accepted)throw new Error(\"This file can't be queued because it has already been processed or was rejected.\");if(e.status=z.QUEUED,this.options.autoProcessQueue)return setTimeout(function(){return t.processQueue()},0)}},{key:\"_enqueueThumbnail\",value:function(e){var t=this;if(this.options.createImageThumbnails&&e.type.match(/image.*/)&&e.size<=1024*this.options.maxThumbnailFilesize*1024)return this._thumbnailQueue.push(e),setTimeout(function(){return t._processThumbnailQueue()},0)}},{key:\"_processThumbnailQueue\",value:function(){var t=this;if(!this._processingThumbnail&&0!==this._thumbnailQueue.length){this._processingThumbnail=!0;var n=this._thumbnailQueue.shift();return this.createThumbnail(n,this.options.thumbnailWidth,this.options.thumbnailHeight,this.options.thumbnailMethod,!0,function(e){return t.emit(\"thumbnail\",n,e),t._processingThumbnail=!1,t._processThumbnailQueue()})}}},{key:\"removeFile\",value:function(e){if(e.status===z.UPLOADING&&this.cancelUpload(e),this.files=h(this.files,e),this.emit(\"removedfile\",e),0===this.files.length)return this.emit(\"reset\")}},{key:\"removeAllFiles\",value:function(e){null==e&&(e=!1);var t=!0,n=!1,i=void 0;try{for(var r,o=this.files.slice()[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var a=r.value;a.status===z.UPLOADING&&!e||this.removeFile(a)}}catch(e){n=!0,i=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}return null}},{key:\"resizeImage\",value:function(r,e,t,n,o){var a=this;return this.createThumbnail(r,e,t,n,!0,function(e,t){if(null==t)return o(r);var n=a.options.resizeMimeType;null==n&&(n=r.type);var i=t.toDataURL(n,a.options.resizeQuality);return\"image/jpeg\"!==n&&\"image/jpg\"!==n||(i=v.restore(r.dataURL,i)),o(z.dataURItoBlob(i))})}},{key:\"createThumbnail\",value:function(e,t,n,i,r,o){var a=this,l=new FileReader;l.onload=function(){e.dataURL=l.result,\"image/svg+xml\"!==e.type?a.createThumbnailFromUrl(e,t,n,i,r,o):null!=o&&o(l.result)},l.readAsDataURL(e)}},{key:\"displayExistingFile\",value:function(t,e,n,i,r){var o=this,a=!(4<arguments.length&&void 0!==r)||r;if(this.emit(\"addedfile\",t),this.emit(\"complete\",t),a){t.dataURL=e,this.createThumbnailFromUrl(t,this.options.thumbnailWidth,this.options.thumbnailHeight,this.options.resizeMethod,this.options.fixOrientation,function(e){o.emit(\"thumbnail\",t,e),n&&n()},i)}else this.emit(\"thumbnail\",t,e),n&&n()}},{key:\"createThumbnailFromUrl\",value:function(o,a,l,s,t,u,e){var c=this,d=document.createElement(\"img\");return e&&(d.crossOrigin=e),d.onload=function(){var e=function(e){return e(1)};return\"undefined\"!=typeof EXIF&&null!==EXIF&&t&&(e=function(e){return EXIF.getData(d,function(){return e(EXIF.getTag(this,\"Orientation\"))})}),e(function(e){o.width=d.width,o.height=d.height;var t=c.options.resize.call(c,o,a,l,s),n=document.createElement(\"canvas\"),i=n.getContext(\"2d\");switch(n.width=t.trgWidth,n.height=t.trgHeight,4<e&&(n.width=t.trgHeight,n.height=t.trgWidth),e){case 2:i.translate(n.width,0),i.scale(-1,1);break;case 3:i.translate(n.width,n.height),i.rotate(Math.PI);break;case 4:i.translate(0,n.height),i.scale(1,-1);break;case 5:i.rotate(.5*Math.PI),i.scale(1,-1);break;case 6:i.rotate(.5*Math.PI),i.translate(0,-n.width);break;case 7:i.rotate(.5*Math.PI),i.translate(n.height,-n.width),i.scale(-1,1);break;case 8:i.rotate(-.5*Math.PI),i.translate(-n.height,0)}f(i,d,null!=t.srcX?t.srcX:0,null!=t.srcY?t.srcY:0,t.srcWidth,t.srcHeight,null!=t.trgX?t.trgX:0,null!=t.trgY?t.trgY:0,t.trgWidth,t.trgHeight);var r=n.toDataURL(\"image/png\");if(null!=u)return u(r,n)})},null!=u&&(d.onerror=u),d.src=o.dataURL}},{key:\"processQueue\",value:function(){var e=this.options.parallelUploads,t=this.getUploadingFiles().length,n=t;if(!(e<=t)){var i=this.getQueuedFiles();if(0<i.length){if(this.options.uploadMultiple)return this.processFiles(i.slice(0,e-t));for(;n<e;){if(!i.length)return;this.processFile(i.shift()),n++}}}}},{key:\"processFile\",value:function(e){return this.processFiles([e])}},{key:\"processFiles\",value:function(e){var t=!0,n=!1,i=void 0;try{for(var r,o=e[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var a=r.value;a.processing=!0,a.status=z.UPLOADING,this.emit(\"processing\",a)}}catch(e){n=!0,i=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}return this.options.uploadMultiple&&this.emit(\"processingmultiple\",e),this.uploadFiles(e)}},{key:\"_getFilesWithXhr\",value:function(t){return this.files.filter(function(e){return e.xhr===t}).map(function(e){return e})}},{key:\"cancelUpload\",value:function(e){if(e.status===z.UPLOADING){var t=this._getFilesWithXhr(e.xhr),n=!0,i=!1,r=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){o.value.status=z.CANCELED}}catch(e){i=!0,r=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw r}}void 0!==e.xhr&&e.xhr.abort();var l=!0,s=!1,u=void 0;try{for(var c,d=t[Symbol.iterator]();!(l=(c=d.next()).done);l=!0){var h=c.value;this.emit(\"canceled\",h)}}catch(e){s=!0,u=e}finally{try{l||null==d.return||d.return()}finally{if(s)throw u}}this.options.uploadMultiple&&this.emit(\"canceledmultiple\",t)}else e.status!==z.ADDED&&e.status!==z.QUEUED||(e.status=z.CANCELED,this.emit(\"canceled\",e),this.options.uploadMultiple&&this.emit(\"canceledmultiple\",[e]));if(this.options.autoProcessQueue)return this.processQueue()}},{key:\"resolveOption\",value:function(e){if(\"function\"!=typeof e)return e;for(var t=arguments.length,n=new Array(1<t?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return e.apply(this,n)}},{key:\"uploadFile\",value:function(e){return this.uploadFiles([e])}},{key:\"uploadFiles\",value:function(s){var u=this;this._transformFiles(s,function(e){if(u.options.chunking){var t=e[0];s[0].upload.chunked=u.options.chunking&&(u.options.forceChunking||t.size>u.options.chunkSize),s[0].upload.totalChunkCount=Math.ceil(t.size/u.options.chunkSize)}if(s[0].upload.chunked){var r=s[0],o=e[0];r.upload.chunks=[];function i(){for(var e=0;void 0!==r.upload.chunks[e];)e++;if(!(e>=r.upload.totalChunkCount)){0;var t=e*u.options.chunkSize,n=Math.min(t+u.options.chunkSize,r.size),i={name:u._getParamName(0),data:o.webkitSlice?o.webkitSlice(t,n):o.slice(t,n),filename:r.upload.filename,chunkIndex:e};r.upload.chunks[e]={file:r,index:e,dataBlock:i,status:z.UPLOADING,progress:0,retries:0},u._uploadData(s,[i])}}if(r.upload.finishedChunkUpload=function(e){var t=!0;e.status=z.SUCCESS,e.dataBlock=null,e.xhr=null;for(var n=0;n<r.upload.totalChunkCount;n++){if(void 0===r.upload.chunks[n])return i();r.upload.chunks[n].status!==z.SUCCESS&&(t=!1)}t&&u.options.chunksUploaded(r,function(){u._finished(s,\"\",null)})},u.options.parallelChunkUploads)for(var n=0;n<r.upload.totalChunkCount;n++)i();else i()}else{for(var a=[],l=0;l<s.length;l++)a[l]={name:u._getParamName(l),data:e[l],filename:s[l].upload.filename};u._uploadData(s,a)}})}},{key:\"_getChunk\",value:function(e,t){for(var n=0;n<e.upload.totalChunkCount;n++)if(void 0!==e.upload.chunks[n]&&e.upload.chunks[n].xhr===t)return e.upload.chunks[n]}},{key:\"_uploadData\",value:function(t,e){var n=this,i=new XMLHttpRequest,r=!0,o=!1,a=void 0;try{for(var l,s=t[Symbol.iterator]();!(r=(l=s.next()).done);r=!0){l.value.xhr=i}}catch(e){o=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw a}}t[0].upload.chunked&&(t[0].upload.chunks[e[0].chunkIndex].xhr=i);var u=this.resolveOption(this.options.method,t),c=this.resolveOption(this.options.url,t);i.open(u,c,!0),i.timeout=this.resolveOption(this.options.timeout,t),i.withCredentials=!!this.options.withCredentials,i.onload=function(e){n._finishedUploading(t,i,e)},i.ontimeout=function(){n._handleUploadError(t,i,\"Request timedout after \".concat(n.options.timeout,\" seconds\"))},i.onerror=function(){n._handleUploadError(t,i)},(null!=i.upload?i.upload:i).onprogress=function(e){return n._updateFilesUploadProgress(t,i,e)};var d={Accept:\"application/json\",\"Cache-Control\":\"no-cache\",\"X-Requested-With\":\"XMLHttpRequest\"};for(var h in this.options.headers&&z.extend(d,this.options.headers),d){var p=d[h];p&&i.setRequestHeader(h,p)}var f=new FormData;if(this.options.params){var v=this.options.params;for(var m in\"function\"==typeof v&&(v=v.call(this,t,i,t[0].upload.chunked?this._getChunk(t[0],i):null)),v){var y=v[m];f.append(m,y)}}var g=!0,b=!1,k=void 0;try{for(var w,F=t[Symbol.iterator]();!(g=(w=F.next()).done);g=!0){var x=w.value;this.emit(\"sending\",x,i,f)}}catch(e){b=!0,k=e}finally{try{g||null==F.return||F.return()}finally{if(b)throw k}}this.options.uploadMultiple&&this.emit(\"sendingmultiple\",t,i,f),this._addFormElementData(f);for(var E=0;E<e.length;E++){var C=e[E];f.append(C.name,C.data,C.filename)}this.submitRequest(i,f,t)}},{key:\"_transformFiles\",value:function(n,i){function e(t){r.options.transformFile.call(r,n[t],function(e){o[t]=e,++a===n.length&&i(o)})}for(var r=this,o=[],a=0,t=0;t<n.length;t++)e(t)}},{key:\"_addFormElementData\",value:function(e){if(\"FORM\"===this.element.tagName){var t=!0,n=!1,i=void 0;try{for(var r,o=this.element.querySelectorAll(\"input, textarea, select, button\")[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var a=r.value,l=a.getAttribute(\"name\"),s=a.getAttribute(\"type\");if(s=s&&s.toLowerCase(),null!=l)if(\"SELECT\"===a.tagName&&a.hasAttribute(\"multiple\")){var u=!0,c=!1,d=void 0;try{for(var h,p=a.options[Symbol.iterator]();!(u=(h=p.next()).done);u=!0){var f=h.value;f.selected&&e.append(l,f.value)}}catch(e){c=!0,d=e}finally{try{u||null==p.return||p.return()}finally{if(c)throw d}}}else(!s||\"checkbox\"!==s&&\"radio\"!==s||a.checked)&&e.append(l,a.value)}}catch(e){n=!0,i=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}}}},{key:\"_updateFilesUploadProgress\",value:function(e,t,n){var i;if(void 0!==n){if(i=100*n.loaded/n.total,e[0].upload.chunked){var r=e[0],o=this._getChunk(r,t);o.progress=i,o.total=n.total,o.bytesSent=n.loaded;r.upload.progress=0,r.upload.total=0;for(var a=r.upload.bytesSent=0;a<r.upload.totalChunkCount;a++)void 0!==r.upload.chunks[a]&&void 0!==r.upload.chunks[a].progress&&(r.upload.progress+=r.upload.chunks[a].progress,r.upload.total+=r.upload.chunks[a].total,r.upload.bytesSent+=r.upload.chunks[a].bytesSent);r.upload.progress=r.upload.progress/r.upload.totalChunkCount}else{var l=!0,s=!1,u=void 0;try{for(var c,d=e[Symbol.iterator]();!(l=(c=d.next()).done);l=!0){var h=c.value;h.upload.progress=i,h.upload.total=n.total,h.upload.bytesSent=n.loaded}}catch(e){s=!0,u=e}finally{try{l||null==d.return||d.return()}finally{if(s)throw u}}}var p=!0,f=!1,v=void 0;try{for(var m,y=e[Symbol.iterator]();!(p=(m=y.next()).done);p=!0){var g=m.value;this.emit(\"uploadprogress\",g,g.upload.progress,g.upload.bytesSent)}}catch(e){f=!0,v=e}finally{try{p||null==y.return||y.return()}finally{if(f)throw v}}}else{var b=!0,k=!0,w=!(i=100),F=void 0;try{for(var x,E=e[Symbol.iterator]();!(k=(x=E.next()).done);k=!0){var C=x.value;100===C.upload.progress&&C.upload.bytesSent===C.upload.total||(b=!1),C.upload.progress=i,C.upload.bytesSent=C.upload.total}}catch(e){w=!0,F=e}finally{try{k||null==E.return||E.return()}finally{if(w)throw F}}if(b)return;var z=!0,S=!1,L=void 0;try{for(var _,T=e[Symbol.iterator]();!(z=(_=T.next()).done);z=!0){var A=_.value;this.emit(\"uploadprogress\",A,i,A.upload.bytesSent)}}catch(e){S=!0,L=e}finally{try{z||null==T.return||T.return()}finally{if(S)throw L}}}}},{key:\"_finishedUploading\",value:function(e,t,n){var i;if(e[0].status!==z.CANCELED&&4===t.readyState){if(\"arraybuffer\"!==t.responseType&&\"blob\"!==t.responseType&&(i=t.responseText,t.getResponseHeader(\"content-type\")&&~t.getResponseHeader(\"content-type\").indexOf(\"application/json\")))try{i=JSON.parse(i)}catch(e){n=e,i=\"Invalid JSON response from server.\"}this._updateFilesUploadProgress(e),200<=t.status&&t.status<300?e[0].upload.chunked?e[0].upload.finishedChunkUpload(this._getChunk(e[0],t)):this._finished(e,i,n):this._handleUploadError(e,t,i)}}},{key:\"_handleUploadError\",value:function(e,t,n){if(e[0].status!==z.CANCELED){if(e[0].upload.chunked&&this.options.retryChunks){var i=this._getChunk(e[0],t);if(i.retries++<this.options.retryChunksLimit)return void this._uploadData(e,[i.dataBlock]);console.warn(\"Retried this chunk too often. Giving up.\")}this._errorProcessing(e,n||this.options.dictResponseError.replace(\"{{statusCode}}\",t.status),t)}}},{key:\"submitRequest\",value:function(e,t){e.send(t)}},{key:\"_finished\",value:function(e,t,n){var i=!0,r=!1,o=void 0;try{for(var a,l=e[Symbol.iterator]();!(i=(a=l.next()).done);i=!0){var s=a.value;s.status=z.SUCCESS,this.emit(\"success\",s,t,n),this.emit(\"complete\",s)}}catch(e){r=!0,o=e}finally{try{i||null==l.return||l.return()}finally{if(r)throw o}}if(this.options.uploadMultiple&&(this.emit(\"successmultiple\",e,t,n),this.emit(\"completemultiple\",e)),this.options.autoProcessQueue)return this.processQueue()}},{key:\"_errorProcessing\",value:function(e,t,n){var i=!0,r=!1,o=void 0;try{for(var a,l=e[Symbol.iterator]();!(i=(a=l.next()).done);i=!0){var s=a.value;s.status=z.ERROR,this.emit(\"error\",s,t,n),this.emit(\"complete\",s)}}catch(e){r=!0,o=e}finally{try{i||null==l.return||l.return()}finally{if(r)throw o}}if(this.options.uploadMultiple&&(this.emit(\"errormultiple\",e,t,n),this.emit(\"completemultiple\",e)),this.options.autoProcessQueue)return this.processQueue()}}],[{key:\"uuidv4\",value:function(){return\"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return(\"x\"===e?t:3&t|8).toString(16)})}}]),z}();d.initClass(),d.version=\"5.7.0\",d.options={},d.optionsForElement=function(e){return e.getAttribute(\"id\")?d.options[p(e.getAttribute(\"id\"))]:void 0},d.instances=[],d.forElement=function(e){if(\"string\"==typeof e&&(e=document.querySelector(e)),null==(null!=e?e.dropzone:void 0))throw new Error(\"No Dropzone found for given element. This is probably because you're trying to access it before Dropzone had the time to initialize. Use the `init` option to setup any additional observers on your Dropzone.\");return e.dropzone},d.autoDiscover=!0,d.discover=function(){var s;if(document.querySelectorAll)s=document.querySelectorAll(\".dropzone\");else{s=[];function e(l){return function(){var e=[],t=!0,n=!1,i=void 0;try{for(var r,o=l[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var a=r.value;/(^| )dropzone($| )/.test(a.className)?e.push(s.push(a)):e.push(void 0)}}catch(e){n=!0,i=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}return e}()}e(document.getElementsByTagName(\"div\")),e(document.getElementsByTagName(\"form\"))}return function(){var e=[],t=!0,n=!1,i=void 0;try{for(var r,o=s[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var a=r.value;!1!==d.optionsForElement(a)?e.push(new d(a)):e.push(void 0)}}catch(e){n=!0,i=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}return e}()},d.blacklistedBrowsers=[/opera.*(Macintosh|Windows Phone).*version\\/12/i],d.isBrowserSupported=function(){var e=!0;if(window.File&&window.FileReader&&window.FileList&&window.Blob&&window.FormData&&document.querySelector)if(\"classList\"in document.createElement(\"a\")){var t=!0,n=!1,i=void 0;try{for(var r,o=d.blacklistedBrowsers[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){r.value.test(navigator.userAgent)&&(e=!1)}}catch(e){n=!0,i=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}}else e=!1;else e=!1;return e},d.dataURItoBlob=function(e){for(var t=atob(e.split(\",\")[1]),n=e.split(\",\")[0].split(\":\")[1].split(\";\")[0],i=new ArrayBuffer(t.length),r=new Uint8Array(i),o=0,a=t.length,l=0<=a;l?o<=a:a<=o;l?o++:o--)r[o]=t.charCodeAt(o);return new Blob([i],{type:n})};var h=function(e,t){return e.filter(function(e){return e!==t}).map(function(e){return e})},p=function(e){return e.replace(/[\\-_](\\w)/g,function(e){return e.charAt(1).toUpperCase()})};d.createElement=function(e){var t=document.createElement(\"div\");return t.innerHTML=e,t.childNodes[0]},d.elementInside=function(e,t){if(e===t)return!0;for(;e=e.parentNode;)if(e===t)return!0;return!1},d.getElement=function(e,t){var n;if(\"string\"==typeof e?n=document.querySelector(e):null!=e.nodeType&&(n=e),null==n)throw new Error(\"Invalid `\".concat(t,\"` option provided. Please provide a CSS selector or a plain HTML element.\"));return n},d.getElements=function(e,t){var n,i;if(e instanceof Array){i=[];try{var r=!0,o=!1,a=void 0;try{for(var l,s=e[Symbol.iterator]();!(r=(l=s.next()).done);r=!0)n=l.value,i.push(this.getElement(n,t))}catch(e){o=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw a}}}catch(e){i=null}}else if(\"string\"==typeof e){var u=!0,c=!(i=[]),d=void 0;try{for(var h,p=document.querySelectorAll(e)[Symbol.iterator]();!(u=(h=p.next()).done);u=!0)n=h.value,i.push(n)}catch(e){c=!0,d=e}finally{try{u||null==p.return||p.return()}finally{if(c)throw d}}}else null!=e.nodeType&&(i=[e]);if(null==i||!i.length)throw new Error(\"Invalid `\".concat(t,\"` option provided. Please provide a CSS selector, a plain HTML element or a list of those.\"));return i},d.confirm=function(e,t,n){return window.confirm(e)?t():null!=n?n():void 0},d.isValidFile=function(e,t){if(!t)return!0;t=t.split(\",\");var n=e.type,i=n.replace(/\\/.*$/,\"\"),r=!0,o=!1,a=void 0;try{for(var l,s=t[Symbol.iterator]();!(r=(l=s.next()).done);r=!0){var u=l.value;if(\".\"===(u=u.trim()).charAt(0)){if(-1!==e.name.toLowerCase().indexOf(u.toLowerCase(),e.name.length-u.length))return!0}else if(/\\/\\*$/.test(u)){if(i===u.replace(/\\/.*$/,\"\"))return!0}else if(n===u)return!0}}catch(e){o=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw a}}return!1},null!=e&&(e.fn.dropzone=function(e){return this.each(function(){return new d(this,e)})}),null!=t?t.exports=d:window.Dropzone=d,d.ADDED=\"added\",d.QUEUED=\"queued\",d.ACCEPTED=d.QUEUED,d.UPLOADING=\"uploading\",d.PROCESSING=d.UPLOADING,d.CANCELED=\"canceled\",d.ERROR=\"error\",d.SUCCESS=\"success\";var f=function(e,t,n,i,r,o,a,l,s,u){var c=function(e){e.naturalWidth;var t=e.naturalHeight,n=document.createElement(\"canvas\");n.width=1,n.height=t;var i=n.getContext(\"2d\");i.drawImage(e,0,0);for(var r=i.getImageData(1,0,1,t).data,o=0,a=t,l=t;o<l;){0===r[4*(l-1)+3]?a=l:o=l,l=a+o>>1}var s=l/t;return 0==s?1:s}(t);return e.drawImage(t,n,i,r,o,a,l,s,u/c)},v=function(){function e(){u(this,e)}return o(e,null,[{key:\"initClass\",value:function(){this.KEY_STR=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\"}},{key:\"encode64\",value:function(e){for(var t=\"\",n=void 0,i=void 0,r=\"\",o=void 0,a=void 0,l=void 0,s=\"\",u=0;o=(n=e[u++])>>2,a=(3&n)<<4|(i=e[u++])>>4,l=(15&i)<<2|(r=e[u++])>>6,s=63&r,isNaN(i)?l=s=64:isNaN(r)&&(s=64),t=t+this.KEY_STR.charAt(o)+this.KEY_STR.charAt(a)+this.KEY_STR.charAt(l)+this.KEY_STR.charAt(s),n=i=r=\"\",o=a=l=s=\"\",u<e.length;);return t}},{key:\"restore\",value:function(e,t){if(!e.match(\"data:image/jpeg;base64,\"))return t;var n=this.decode64(e.replace(\"data:image/jpeg;base64,\",\"\")),i=this.slice2Segments(n),r=this.exifManipulation(t,i);return\"data:image/jpeg;base64,\".concat(this.encode64(r))}},{key:\"exifManipulation\",value:function(e,t){var n=this.getExifArray(t),i=this.insertExif(e,n);return new Uint8Array(i)}},{key:\"getExifArray\",value:function(e){for(var t=void 0,n=0;n<e.length;){if(255===(t=e[n])[0]&225===t[1])return t;n++}return[]}},{key:\"insertExif\",value:function(e,t){var n=e.replace(\"data:image/jpeg;base64,\",\"\"),i=this.decode64(n),r=i.indexOf(255,3),o=i.slice(0,r),a=i.slice(r),l=o;return l=(l=l.concat(t)).concat(a)}},{key:\"slice2Segments\",value:function(e){for(var t=0,n=[];;){if(255===e[t]&218===e[t+1])break;if(255===e[t]&216===e[t+1])t+=2;else{var i=t+(256*e[t+2]+e[t+3])+2,r=e.slice(t,i);n.push(r),t=i}if(t>e.length)break}return n}},{key:\"decode64\",value:function(e){var t=void 0,n=void 0,i=\"\",r=void 0,o=void 0,a=\"\",l=0,s=[];for(/[^A-Za-z0-9\\+\\/\\=]/g.exec(e)&&console.warn(\"There were invalid base64 characters in the input text.\\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\\nExpect errors in decoding.\"),e=e.replace(/[^A-Za-z0-9\\+\\/\\=]/g,\"\");t=this.KEY_STR.indexOf(e.charAt(l++))<<2|(r=this.KEY_STR.indexOf(e.charAt(l++)))>>4,n=(15&r)<<4|(o=this.KEY_STR.indexOf(e.charAt(l++)))>>2,i=(3&o)<<6|(a=this.KEY_STR.indexOf(e.charAt(l++))),s.push(t),64!==o&&s.push(n),64!==a&&s.push(i),t=n=i=\"\",r=o=a=\"\",l<e.length;);return s}}]),e}();v.initClass();return d._autoDiscoverFunction=function(){if(d.autoDiscover)return d.discover()},function(t,n){function i(e){if(\"readystatechange\"!==e.type||\"complete\"===o.readyState)return(\"load\"===e.type?t:o)[s](u+e.type,i,!1),!r&&(r=!0)?n.call(t,e.type||e):void 0}var r=!1,e=!0,o=t.document,a=o.documentElement,l=o.addEventListener?\"addEventListener\":\"attachEvent\",s=o.addEventListener?\"removeEventListener\":\"detachEvent\",u=o.addEventListener?\"\":\"on\";if(\"complete\"!==o.readyState){if(o.createEventObject&&a.doScroll){try{e=!t.frameElement}catch(e){}e&&!function t(){try{a.doScroll(\"left\")}catch(e){return void setTimeout(t,50)}return i(\"poll\")}()}o[l](u+\"DOMContentLoaded\",i,!1),o[l](u+\"readystatechange\",i,!1),t[l](u+\"load\",i,!1)}}(window,d._autoDiscoverFunction),t.exports});\n\n//# sourceURL=webpack://mapss/./media/node_modules/dropzone/dist/min/dropzone-amd-module.min.js?");

/***/ }),

/***/ "./media/node_modules/jqtree/tree.jquery.js":
/*!**************************************************!*\
  !*** ./media/node_modules/jqtree/tree.jquery.js ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

eval("/* provided dependency */ var jQuery = __webpack_require__(/*! ./media/node_modules/jquery/dist/jquery.min */ \"./media/node_modules/jquery/dist/jquery.min.js\");\n/*\nJqTree 1.3.4\n\nCopyright 2015 Marco Braak\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=undefined;if(!u&&a)return require(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=undefined;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\nvar $, DragAndDropHandler, DragElement, HitAreasGenerator, Position, VisibleNodeIterator, node_module, util,\n  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n  hasProp = {}.hasOwnProperty;\n\nnode_module = require('./node');\n\nutil = require('./util');\n\nPosition = node_module.Position;\n\n$ = jQuery;\n\nDragAndDropHandler = (function() {\n  function DragAndDropHandler(tree_widget) {\n    this.tree_widget = tree_widget;\n    this.hovered_area = null;\n    this.$ghost = null;\n    this.hit_areas = [];\n    this.is_dragging = false;\n    this.current_item = null;\n  }\n\n  DragAndDropHandler.prototype.mouseCapture = function(position_info) {\n    var $element, node_element;\n    $element = $(position_info.target);\n    if (!this.mustCaptureElement($element)) {\n      return null;\n    }\n    if (this.tree_widget.options.onIsMoveHandle && !this.tree_widget.options.onIsMoveHandle($element)) {\n      return null;\n    }\n    node_element = this.tree_widget._getNodeElement($element);\n    if (node_element && this.tree_widget.options.onCanMove) {\n      if (!this.tree_widget.options.onCanMove(node_element.node)) {\n        node_element = null;\n      }\n    }\n    this.current_item = node_element;\n    return this.current_item !== null;\n  };\n\n  DragAndDropHandler.prototype.mouseStart = function(position_info) {\n    var offset;\n    this.refresh();\n    offset = $(position_info.target).offset();\n    this.drag_element = new DragElement(this.current_item.node, position_info.page_x - offset.left, position_info.page_y - offset.top, this.tree_widget.element);\n    this.is_dragging = true;\n    this.current_item.$element.addClass('jqtree-moving');\n    return true;\n  };\n\n  DragAndDropHandler.prototype.mouseDrag = function(position_info) {\n    var area, can_move_to;\n    this.drag_element.move(position_info.page_x, position_info.page_y);\n    area = this.findHoveredArea(position_info.page_x, position_info.page_y);\n    can_move_to = this.canMoveToArea(area);\n    if (can_move_to && area) {\n      if (!area.node.isFolder()) {\n        this.stopOpenFolderTimer();\n      }\n      if (this.hovered_area !== area) {\n        this.hovered_area = area;\n        if (this.mustOpenFolderTimer(area)) {\n          this.startOpenFolderTimer(area.node);\n        } else {\n          this.stopOpenFolderTimer();\n        }\n        this.updateDropHint();\n      }\n    } else {\n      this.removeHover();\n      this.removeDropHint();\n      this.stopOpenFolderTimer();\n    }\n    if (!area) {\n      if (this.tree_widget.options.onDragMove != null) {\n        this.tree_widget.options.onDragMove(this.current_item.node, position_info.original_event);\n      }\n    }\n    return true;\n  };\n\n  DragAndDropHandler.prototype.mustCaptureElement = function($element) {\n    return !$element.is('input,select');\n  };\n\n  DragAndDropHandler.prototype.canMoveToArea = function(area) {\n    var position_name;\n    if (!area) {\n      return false;\n    } else if (this.tree_widget.options.onCanMoveTo) {\n      position_name = Position.getName(area.position);\n      return this.tree_widget.options.onCanMoveTo(this.current_item.node, area.node, position_name);\n    } else {\n      return true;\n    }\n  };\n\n  DragAndDropHandler.prototype.mouseStop = function(position_info) {\n    var current_item;\n    this.moveItem(position_info);\n    this.clear();\n    this.removeHover();\n    this.removeDropHint();\n    this.removeHitAreas();\n    current_item = this.current_item;\n    if (this.current_item) {\n      this.current_item.$element.removeClass('jqtree-moving');\n      this.current_item = null;\n    }\n    this.is_dragging = false;\n    if (!this.hovered_area && current_item) {\n      if (this.tree_widget.options.onDragStop != null) {\n        this.tree_widget.options.onDragStop(current_item.node, position_info.original_event);\n      }\n    }\n    return false;\n  };\n\n  DragAndDropHandler.prototype.refresh = function() {\n    this.removeHitAreas();\n    if (this.current_item) {\n      this.generateHitAreas();\n      this.current_item = this.tree_widget._getNodeElementForNode(this.current_item.node);\n      if (this.is_dragging) {\n        return this.current_item.$element.addClass('jqtree-moving');\n      }\n    }\n  };\n\n  DragAndDropHandler.prototype.removeHitAreas = function() {\n    return this.hit_areas = [];\n  };\n\n  DragAndDropHandler.prototype.clear = function() {\n    this.drag_element.remove();\n    return this.drag_element = null;\n  };\n\n  DragAndDropHandler.prototype.removeDropHint = function() {\n    if (this.previous_ghost) {\n      return this.previous_ghost.remove();\n    }\n  };\n\n  DragAndDropHandler.prototype.removeHover = function() {\n    return this.hovered_area = null;\n  };\n\n  DragAndDropHandler.prototype.generateHitAreas = function() {\n    var hit_areas_generator;\n    hit_areas_generator = new HitAreasGenerator(this.tree_widget.tree, this.current_item.node, this.getTreeDimensions().bottom);\n    return this.hit_areas = hit_areas_generator.generate();\n  };\n\n  DragAndDropHandler.prototype.findHoveredArea = function(x, y) {\n    var area, dimensions, high, low, mid;\n    dimensions = this.getTreeDimensions();\n    if (x < dimensions.left || y < dimensions.top || x > dimensions.right || y > dimensions.bottom) {\n      return null;\n    }\n    low = 0;\n    high = this.hit_areas.length;\n    while (low < high) {\n      mid = (low + high) >> 1;\n      area = this.hit_areas[mid];\n      if (y < area.top) {\n        high = mid;\n      } else if (y > area.bottom) {\n        low = mid + 1;\n      } else {\n        return area;\n      }\n    }\n    return null;\n  };\n\n  DragAndDropHandler.prototype.mustOpenFolderTimer = function(area) {\n    var node;\n    node = area.node;\n    return node.isFolder() && !node.is_open && area.position === Position.INSIDE;\n  };\n\n  DragAndDropHandler.prototype.updateDropHint = function() {\n    var node_element;\n    if (!this.hovered_area) {\n      return;\n    }\n    this.removeDropHint();\n    node_element = this.tree_widget._getNodeElementForNode(this.hovered_area.node);\n    return this.previous_ghost = node_element.addDropHint(this.hovered_area.position);\n  };\n\n  DragAndDropHandler.prototype.startOpenFolderTimer = function(folder) {\n    var openFolder;\n    openFolder = (function(_this) {\n      return function() {\n        return _this.tree_widget._openNode(folder, _this.tree_widget.options.slide, function() {\n          _this.refresh();\n          return _this.updateDropHint();\n        });\n      };\n    })(this);\n    this.stopOpenFolderTimer();\n    return this.open_folder_timer = setTimeout(openFolder, this.tree_widget.options.openFolderDelay);\n  };\n\n  DragAndDropHandler.prototype.stopOpenFolderTimer = function() {\n    if (this.open_folder_timer) {\n      clearTimeout(this.open_folder_timer);\n      return this.open_folder_timer = null;\n    }\n  };\n\n  DragAndDropHandler.prototype.moveItem = function(position_info) {\n    var doMove, event, moved_node, position, previous_parent, target_node;\n    if (this.hovered_area && this.hovered_area.position !== Position.NONE && this.canMoveToArea(this.hovered_area)) {\n      moved_node = this.current_item.node;\n      target_node = this.hovered_area.node;\n      position = this.hovered_area.position;\n      previous_parent = moved_node.parent;\n      if (position === Position.INSIDE) {\n        this.hovered_area.node.is_open = true;\n      }\n      doMove = (function(_this) {\n        return function() {\n          _this.tree_widget.tree.moveNode(moved_node, target_node, position);\n          _this.tree_widget.element.empty();\n          return _this.tree_widget._refreshElements();\n        };\n      })(this);\n      event = this.tree_widget._triggerEvent('tree.move', {\n        move_info: {\n          moved_node: moved_node,\n          target_node: target_node,\n          position: Position.getName(position),\n          previous_parent: previous_parent,\n          do_move: doMove,\n          original_event: position_info.original_event\n        }\n      });\n      if (!event.isDefaultPrevented()) {\n        return doMove();\n      }\n    }\n  };\n\n  DragAndDropHandler.prototype.getTreeDimensions = function() {\n    var offset;\n    offset = this.tree_widget.element.offset();\n    return {\n      left: offset.left,\n      top: offset.top,\n      right: offset.left + this.tree_widget.element.width(),\n      bottom: offset.top + this.tree_widget.element.height() + 16\n    };\n  };\n\n  return DragAndDropHandler;\n\n})();\n\nVisibleNodeIterator = (function() {\n  function VisibleNodeIterator(tree) {\n    this.tree = tree;\n  }\n\n  VisibleNodeIterator.prototype.iterate = function() {\n    var _iterateNode, is_first_node;\n    is_first_node = true;\n    _iterateNode = (function(_this) {\n      return function(node, next_node) {\n        var $element, child, children_length, i, j, len, must_iterate_inside, ref;\n        must_iterate_inside = (node.is_open || !node.element) && node.hasChildren();\n        if (node.element) {\n          $element = $(node.element);\n          if (!$element.is(':visible')) {\n            return;\n          }\n          if (is_first_node) {\n            _this.handleFirstNode(node, $element);\n            is_first_node = false;\n          }\n          if (!node.hasChildren()) {\n            _this.handleNode(node, next_node, $element);\n          } else if (node.is_open) {\n            if (!_this.handleOpenFolder(node, $element)) {\n              must_iterate_inside = false;\n            }\n          } else {\n            _this.handleClosedFolder(node, next_node, $element);\n          }\n        }\n        if (must_iterate_inside) {\n          children_length = node.children.length;\n          ref = node.children;\n          for (i = j = 0, len = ref.length; j < len; i = ++j) {\n            child = ref[i];\n            if (i === (children_length - 1)) {\n              _iterateNode(node.children[i], null);\n            } else {\n              _iterateNode(node.children[i], node.children[i + 1]);\n            }\n          }\n          if (node.is_open) {\n            return _this.handleAfterOpenFolder(node, next_node, $element);\n          }\n        }\n      };\n    })(this);\n    return _iterateNode(this.tree, null);\n  };\n\n  VisibleNodeIterator.prototype.handleNode = function(node, next_node, $element) {};\n\n  VisibleNodeIterator.prototype.handleOpenFolder = function(node, $element) {};\n\n  VisibleNodeIterator.prototype.handleClosedFolder = function(node, next_node, $element) {};\n\n  VisibleNodeIterator.prototype.handleAfterOpenFolder = function(node, next_node, $element) {};\n\n  VisibleNodeIterator.prototype.handleFirstNode = function(node, $element) {};\n\n  return VisibleNodeIterator;\n\n})();\n\nHitAreasGenerator = (function(superClass) {\n  extend(HitAreasGenerator, superClass);\n\n  function HitAreasGenerator(tree, current_node, tree_bottom) {\n    HitAreasGenerator.__super__.constructor.call(this, tree);\n    this.current_node = current_node;\n    this.tree_bottom = tree_bottom;\n  }\n\n  HitAreasGenerator.prototype.generate = function() {\n    this.positions = [];\n    this.last_top = 0;\n    this.iterate();\n    return this.generateHitAreas(this.positions);\n  };\n\n  HitAreasGenerator.prototype.getTop = function($element) {\n    return $element.offset().top;\n  };\n\n  HitAreasGenerator.prototype.addPosition = function(node, position, top) {\n    var area;\n    area = {\n      top: top,\n      node: node,\n      position: position\n    };\n    this.positions.push(area);\n    return this.last_top = top;\n  };\n\n  HitAreasGenerator.prototype.handleNode = function(node, next_node, $element) {\n    var top;\n    top = this.getTop($element);\n    if (node === this.current_node) {\n      this.addPosition(node, Position.NONE, top);\n    } else {\n      this.addPosition(node, Position.INSIDE, top);\n    }\n    if (next_node === this.current_node || node === this.current_node) {\n      return this.addPosition(node, Position.NONE, top);\n    } else {\n      return this.addPosition(node, Position.AFTER, top);\n    }\n  };\n\n  HitAreasGenerator.prototype.handleOpenFolder = function(node, $element) {\n    if (node === this.current_node) {\n      return false;\n    }\n    if (node.children[0] !== this.current_node) {\n      this.addPosition(node, Position.INSIDE, this.getTop($element));\n    }\n    return true;\n  };\n\n  HitAreasGenerator.prototype.handleClosedFolder = function(node, next_node, $element) {\n    var top;\n    top = this.getTop($element);\n    if (node === this.current_node) {\n      return this.addPosition(node, Position.NONE, top);\n    } else {\n      this.addPosition(node, Position.INSIDE, top);\n      if (next_node !== this.current_node) {\n        return this.addPosition(node, Position.AFTER, top);\n      }\n    }\n  };\n\n  HitAreasGenerator.prototype.handleFirstNode = function(node, $element) {\n    if (node !== this.current_node) {\n      return this.addPosition(node, Position.BEFORE, this.getTop($(node.element)));\n    }\n  };\n\n  HitAreasGenerator.prototype.handleAfterOpenFolder = function(node, next_node, $element) {\n    if (node === this.current_node.node || next_node === this.current_node.node) {\n      return this.addPosition(node, Position.NONE, this.last_top);\n    } else {\n      return this.addPosition(node, Position.AFTER, this.last_top);\n    }\n  };\n\n  HitAreasGenerator.prototype.generateHitAreas = function(positions) {\n    var group, hit_areas, j, len, position, previous_top;\n    previous_top = -1;\n    group = [];\n    hit_areas = [];\n    for (j = 0, len = positions.length; j < len; j++) {\n      position = positions[j];\n      if (position.top !== previous_top && group.length) {\n        if (group.length) {\n          this.generateHitAreasForGroup(hit_areas, group, previous_top, position.top);\n        }\n        previous_top = position.top;\n        group = [];\n      }\n      group.push(position);\n    }\n    this.generateHitAreasForGroup(hit_areas, group, previous_top, this.tree_bottom);\n    return hit_areas;\n  };\n\n  HitAreasGenerator.prototype.generateHitAreasForGroup = function(hit_areas, positions_in_group, top, bottom) {\n    var area_height, area_top, i, position, position_count;\n    position_count = Math.min(positions_in_group.length, 4);\n    area_height = Math.round((bottom - top) / position_count);\n    area_top = top;\n    i = 0;\n    while (i < position_count) {\n      position = positions_in_group[i];\n      hit_areas.push({\n        top: area_top,\n        bottom: area_top + area_height,\n        node: position.node,\n        position: position.position\n      });\n      area_top += area_height;\n      i += 1;\n    }\n    return null;\n  };\n\n  return HitAreasGenerator;\n\n})(VisibleNodeIterator);\n\nDragElement = (function() {\n  function DragElement(node, offset_x, offset_y, $tree) {\n    var node_name;\n    this.offset_x = offset_x;\n    this.offset_y = offset_y;\n    node_name = util.html_escape(node.name);\n    this.$element = $(\"<span class=\\\"jqtree-title jqtree-dragging\\\">\" + node_name + \"</span>\");\n    this.$element.css(\"position\", \"absolute\");\n    $tree.append(this.$element);\n  }\n\n  DragElement.prototype.move = function(page_x, page_y) {\n    return this.$element.offset({\n      left: page_x - this.offset_x,\n      top: page_y - this.offset_y\n    });\n  };\n\n  DragElement.prototype.remove = function() {\n    return this.$element.remove();\n  };\n\n  return DragElement;\n\n})();\n\nmodule.exports = {\n  DragAndDropHandler: DragAndDropHandler,\n  DragElement: DragElement,\n  HitAreasGenerator: HitAreasGenerator\n};\n\n},{\"./node\":5,\"./util\":12}],2:[function(require,module,exports){\nvar $, ElementsRenderer, NodeElement, html_escape, node_element, util;\n\nnode_element = require('./node_element');\n\nNodeElement = node_element.NodeElement;\n\nutil = require('./util');\n\nhtml_escape = util.html_escape;\n\n$ = jQuery;\n\nElementsRenderer = (function() {\n  function ElementsRenderer(tree_widget) {\n    this.tree_widget = tree_widget;\n    this.opened_icon_element = this.createButtonElement(tree_widget.options.openedIcon);\n    this.closed_icon_element = this.createButtonElement(tree_widget.options.closedIcon);\n  }\n\n  ElementsRenderer.prototype.render = function(from_node) {\n    if (from_node && from_node.parent) {\n      return this.renderFromNode(from_node);\n    } else {\n      return this.renderFromRoot();\n    }\n  };\n\n  ElementsRenderer.prototype.renderFromRoot = function() {\n    var $element;\n    $element = this.tree_widget.element;\n    $element.empty();\n    return this.createDomElements($element[0], this.tree_widget.tree.children, true, true, 1);\n  };\n\n  ElementsRenderer.prototype.renderFromNode = function(node) {\n    var $previous_li, li;\n    $previous_li = $(node.element);\n    li = this.createLi(node, node.getLevel());\n    this.attachNodeData(node, li);\n    $previous_li.after(li);\n    $previous_li.remove();\n    if (node.children) {\n      return this.createDomElements(li, node.children, false, false, node.getLevel() + 1);\n    }\n  };\n\n  ElementsRenderer.prototype.createDomElements = function(element, children, is_root_node, is_open, level) {\n    var child, i, len, li, ul;\n    ul = this.createUl(is_root_node);\n    element.appendChild(ul);\n    for (i = 0, len = children.length; i < len; i++) {\n      child = children[i];\n      li = this.createLi(child, level);\n      ul.appendChild(li);\n      this.attachNodeData(child, li);\n      if (child.hasChildren()) {\n        this.createDomElements(li, child.children, false, child.is_open, level + 1);\n      }\n    }\n    return null;\n  };\n\n  ElementsRenderer.prototype.attachNodeData = function(node, li) {\n    node.element = li;\n    return $(li).data('node', node);\n  };\n\n  ElementsRenderer.prototype.createUl = function(is_root_node) {\n    var class_string, role, ul;\n    if (!is_root_node) {\n      class_string = '';\n      role = 'group';\n    } else {\n      class_string = 'jqtree-tree';\n      role = 'tree';\n      if (this.tree_widget.options.rtl) {\n        class_string += ' jqtree-rtl';\n      }\n    }\n    ul = document.createElement('ul');\n    ul.className = \"jqtree_common \" + class_string;\n    ul.setAttribute('role', role);\n    return ul;\n  };\n\n  ElementsRenderer.prototype.createLi = function(node, level) {\n    var is_selected, li;\n    is_selected = this.tree_widget.select_node_handler && this.tree_widget.select_node_handler.isNodeSelected(node);\n    if (node.isFolder()) {\n      li = this.createFolderLi(node, level, is_selected);\n    } else {\n      li = this.createNodeLi(node, level, is_selected);\n    }\n    if (this.tree_widget.options.onCreateLi) {\n      this.tree_widget.options.onCreateLi(node, $(li));\n    }\n    return li;\n  };\n\n  ElementsRenderer.prototype.createFolderLi = function(node, level, is_selected) {\n    var button_classes, button_link, div, folder_classes, icon_element, is_folder, li;\n    button_classes = this.getButtonClasses(node);\n    folder_classes = this.getFolderClasses(node, is_selected);\n    if (node.is_open) {\n      icon_element = this.opened_icon_element;\n    } else {\n      icon_element = this.closed_icon_element;\n    }\n    li = document.createElement('li');\n    li.className = \"jqtree_common \" + folder_classes;\n    li.setAttribute('role', 'presentation');\n    div = document.createElement('div');\n    div.className = \"jqtree-element jqtree_common\";\n    div.setAttribute('role', 'presentation');\n    li.appendChild(div);\n    button_link = document.createElement('a');\n    button_link.className = button_classes;\n    button_link.appendChild(icon_element.cloneNode(false));\n    button_link.setAttribute('role', 'presentation');\n    button_link.setAttribute('aria-hidden', 'true');\n    if (this.tree_widget.options.buttonLeft) {\n      div.appendChild(button_link);\n    }\n    div.appendChild(this.createTitleSpan(node.name, level, is_selected, node.is_open, is_folder = true));\n    if (!this.tree_widget.options.buttonLeft) {\n      div.appendChild(button_link);\n    }\n    return li;\n  };\n\n  ElementsRenderer.prototype.createNodeLi = function(node, level, is_selected) {\n    var class_string, div, is_folder, li, li_classes;\n    li_classes = ['jqtree_common'];\n    if (is_selected) {\n      li_classes.push('jqtree-selected');\n    }\n    class_string = li_classes.join(' ');\n    li = document.createElement('li');\n    li.className = class_string;\n    li.setAttribute('role', 'presentation');\n    div = document.createElement('div');\n    div.className = \"jqtree-element jqtree_common\";\n    div.setAttribute('role', 'presentation');\n    li.appendChild(div);\n    div.appendChild(this.createTitleSpan(node.name, level, is_selected, node.is_open, is_folder = false));\n    return li;\n  };\n\n  ElementsRenderer.prototype.createTitleSpan = function(node_name, level, is_selected, is_open, is_folder) {\n    var classes, title_span;\n    title_span = document.createElement('span');\n    classes = \"jqtree-title jqtree_common\";\n    if (is_folder) {\n      classes += \" jqtree-title-folder\";\n    }\n    title_span.className = classes;\n    title_span.setAttribute('role', 'treeitem');\n    title_span.setAttribute('aria-level', level);\n    title_span.setAttribute('aria-selected', util.getBoolString(is_selected));\n    title_span.setAttribute('aria-expanded', util.getBoolString(is_open));\n    if (is_selected) {\n      title_span.setAttribute('tabindex', 0);\n    }\n    title_span.innerHTML = this.escapeIfNecessary(node_name);\n    return title_span;\n  };\n\n  ElementsRenderer.prototype.getButtonClasses = function(node) {\n    var classes;\n    classes = ['jqtree-toggler', 'jqtree_common'];\n    if (!node.is_open) {\n      classes.push('jqtree-closed');\n    }\n    if (this.tree_widget.options.buttonLeft) {\n      classes.push('jqtree-toggler-left');\n    } else {\n      classes.push('jqtree-toggler-right');\n    }\n    return classes.join(' ');\n  };\n\n  ElementsRenderer.prototype.getFolderClasses = function(node, is_selected) {\n    var classes;\n    classes = ['jqtree-folder'];\n    if (!node.is_open) {\n      classes.push('jqtree-closed');\n    }\n    if (is_selected) {\n      classes.push('jqtree-selected');\n    }\n    if (node.is_loading) {\n      classes.push('jqtree-loading');\n    }\n    return classes.join(' ');\n  };\n\n  ElementsRenderer.prototype.escapeIfNecessary = function(value) {\n    if (this.tree_widget.options.autoEscape) {\n      return html_escape(value);\n    } else {\n      return value;\n    }\n  };\n\n  ElementsRenderer.prototype.createButtonElement = function(value) {\n    var div;\n    if (typeof value === 'string') {\n      div = document.createElement('div');\n      div.innerHTML = value;\n      return document.createTextNode(div.innerHTML);\n    } else {\n      return $(value)[0];\n    }\n  };\n\n  return ElementsRenderer;\n\n})();\n\nmodule.exports = ElementsRenderer;\n\n},{\"./node_element\":6,\"./util\":12}],3:[function(require,module,exports){\nvar $, KeyHandler,\n  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n$ = jQuery;\n\nKeyHandler = (function() {\n  var DOWN, LEFT, RIGHT, UP;\n\n  LEFT = 37;\n\n  UP = 38;\n\n  RIGHT = 39;\n\n  DOWN = 40;\n\n  function KeyHandler(tree_widget) {\n    this.selectNode = bind(this.selectNode, this);\n    this.tree_widget = tree_widget;\n    if (tree_widget.options.keyboardSupport) {\n      $(document).bind('keydown.jqtree', $.proxy(this.handleKeyDown, this));\n    }\n  }\n\n  KeyHandler.prototype.deinit = function() {\n    return $(document).unbind('keydown.jqtree');\n  };\n\n  KeyHandler.prototype.moveDown = function() {\n    var node;\n    node = this.tree_widget.getSelectedNode();\n    if (node) {\n      return this.selectNode(node.getNextNode());\n    } else {\n      return false;\n    }\n  };\n\n  KeyHandler.prototype.moveUp = function() {\n    var node;\n    node = this.tree_widget.getSelectedNode();\n    if (node) {\n      return this.selectNode(node.getPreviousNode());\n    } else {\n      return false;\n    }\n  };\n\n  KeyHandler.prototype.moveRight = function() {\n    var node;\n    node = this.tree_widget.getSelectedNode();\n    if (!node) {\n      return true;\n    } else if (!node.isFolder()) {\n      return true;\n    } else {\n      if (node.is_open) {\n        return this.selectNode(node.getNextNode());\n      } else {\n        this.tree_widget.openNode(node);\n        return false;\n      }\n    }\n  };\n\n  KeyHandler.prototype.moveLeft = function() {\n    var node;\n    node = this.tree_widget.getSelectedNode();\n    if (!node) {\n      return true;\n    } else if (node.isFolder() && node.is_open) {\n      this.tree_widget.closeNode(node);\n      return false;\n    } else {\n      return this.selectNode(node.getParent());\n    }\n  };\n\n  KeyHandler.prototype.handleKeyDown = function(e) {\n    var key;\n    if (!this.tree_widget.options.keyboardSupport) {\n      return true;\n    }\n    if ($(document.activeElement).is('textarea,input,select')) {\n      return true;\n    }\n    if (!this.tree_widget.getSelectedNode()) {\n      return true;\n    }\n    key = e.which;\n    switch (key) {\n      case DOWN:\n        return this.moveDown();\n      case UP:\n        return this.moveUp();\n      case RIGHT:\n        return this.moveRight();\n      case LEFT:\n        return this.moveLeft();\n    }\n    return true;\n  };\n\n  KeyHandler.prototype.selectNode = function(node) {\n    if (!node) {\n      return true;\n    } else {\n      this.tree_widget.selectNode(node);\n      if (this.tree_widget.scroll_handler && (!this.tree_widget.scroll_handler.isScrolledIntoView($(node.element).find('.jqtree-element')))) {\n        this.tree_widget.scrollToNode(node);\n      }\n      return false;\n    }\n  };\n\n  return KeyHandler;\n\n})();\n\nmodule.exports = KeyHandler;\n\n},{}],4:[function(require,module,exports){\n\n/*\nThis widget does the same a the mouse widget in jqueryui.\n */\nvar $, MouseWidget, SimpleWidget,\n  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n  hasProp = {}.hasOwnProperty;\n\nSimpleWidget = require('./simple.widget');\n\n$ = jQuery;\n\nMouseWidget = (function(superClass) {\n  extend(MouseWidget, superClass);\n\n  function MouseWidget() {\n    return MouseWidget.__super__.constructor.apply(this, arguments);\n  }\n\n  MouseWidget.is_mouse_handled = false;\n\n  MouseWidget.prototype._init = function() {\n    this.$el.bind('mousedown.mousewidget', $.proxy(this._mouseDown, this));\n    this.$el.bind('touchstart.mousewidget', $.proxy(this._touchStart, this));\n    this.is_mouse_started = false;\n    this.mouse_delay = 0;\n    this._mouse_delay_timer = null;\n    this._is_mouse_delay_met = true;\n    return this.mouse_down_info = null;\n  };\n\n  MouseWidget.prototype._deinit = function() {\n    var $document;\n    this.$el.unbind('mousedown.mousewidget');\n    this.$el.unbind('touchstart.mousewidget');\n    $document = $(document);\n    $document.unbind('mousemove.mousewidget');\n    return $document.unbind('mouseup.mousewidget');\n  };\n\n  MouseWidget.prototype._mouseDown = function(e) {\n    var result;\n    if (e.which !== 1) {\n      return;\n    }\n    result = this._handleMouseDown(e, this._getPositionInfo(e));\n    if (result) {\n      e.preventDefault();\n    }\n    return result;\n  };\n\n  MouseWidget.prototype._handleMouseDown = function(e, position_info) {\n    if (MouseWidget.is_mouse_handled) {\n      return;\n    }\n    if (this.is_mouse_started) {\n      this._handleMouseUp(position_info);\n    }\n    this.mouse_down_info = position_info;\n    if (!this._mouseCapture(position_info)) {\n      return;\n    }\n    this._handleStartMouse();\n    this.is_mouse_handled = true;\n    return true;\n  };\n\n  MouseWidget.prototype._handleStartMouse = function() {\n    var $document;\n    $document = $(document);\n    $document.bind('mousemove.mousewidget', $.proxy(this._mouseMove, this));\n    $document.bind('touchmove.mousewidget', $.proxy(this._touchMove, this));\n    $document.bind('mouseup.mousewidget', $.proxy(this._mouseUp, this));\n    $document.bind('touchend.mousewidget', $.proxy(this._touchEnd, this));\n    if (this.mouse_delay) {\n      return this._startMouseDelayTimer();\n    }\n  };\n\n  MouseWidget.prototype._startMouseDelayTimer = function() {\n    if (this._mouse_delay_timer) {\n      clearTimeout(this._mouse_delay_timer);\n    }\n    this._mouse_delay_timer = setTimeout((function(_this) {\n      return function() {\n        return _this._is_mouse_delay_met = true;\n      };\n    })(this), this.mouse_delay);\n    return this._is_mouse_delay_met = false;\n  };\n\n  MouseWidget.prototype._mouseMove = function(e) {\n    return this._handleMouseMove(e, this._getPositionInfo(e));\n  };\n\n  MouseWidget.prototype._handleMouseMove = function(e, position_info) {\n    if (this.is_mouse_started) {\n      this._mouseDrag(position_info);\n      return e.preventDefault();\n    }\n    if (this.mouse_delay && !this._is_mouse_delay_met) {\n      return true;\n    }\n    this.is_mouse_started = this._mouseStart(this.mouse_down_info) !== false;\n    if (this.is_mouse_started) {\n      this._mouseDrag(position_info);\n    } else {\n      this._handleMouseUp(position_info);\n    }\n    return !this.is_mouse_started;\n  };\n\n  MouseWidget.prototype._getPositionInfo = function(e) {\n    return {\n      page_x: e.pageX,\n      page_y: e.pageY,\n      target: e.target,\n      original_event: e\n    };\n  };\n\n  MouseWidget.prototype._mouseUp = function(e) {\n    return this._handleMouseUp(this._getPositionInfo(e));\n  };\n\n  MouseWidget.prototype._handleMouseUp = function(position_info) {\n    var $document;\n    $document = $(document);\n    $document.unbind('mousemove.mousewidget');\n    $document.unbind('touchmove.mousewidget');\n    $document.unbind('mouseup.mousewidget');\n    $document.unbind('touchend.mousewidget');\n    if (this.is_mouse_started) {\n      this.is_mouse_started = false;\n      this._mouseStop(position_info);\n    }\n  };\n\n  MouseWidget.prototype._mouseCapture = function(position_info) {\n    return true;\n  };\n\n  MouseWidget.prototype._mouseStart = function(position_info) {\n    return null;\n  };\n\n  MouseWidget.prototype._mouseDrag = function(position_info) {\n    return null;\n  };\n\n  MouseWidget.prototype._mouseStop = function(position_info) {\n    return null;\n  };\n\n  MouseWidget.prototype.setMouseDelay = function(mouse_delay) {\n    return this.mouse_delay = mouse_delay;\n  };\n\n  MouseWidget.prototype._touchStart = function(e) {\n    var touch;\n    if (e.originalEvent.touches.length > 1) {\n      return;\n    }\n    touch = e.originalEvent.changedTouches[0];\n    return this._handleMouseDown(e, this._getPositionInfo(touch));\n  };\n\n  MouseWidget.prototype._touchMove = function(e) {\n    var touch;\n    if (e.originalEvent.touches.length > 1) {\n      return;\n    }\n    touch = e.originalEvent.changedTouches[0];\n    return this._handleMouseMove(e, this._getPositionInfo(touch));\n  };\n\n  MouseWidget.prototype._touchEnd = function(e) {\n    var touch;\n    if (e.originalEvent.touches.length > 1) {\n      return;\n    }\n    touch = e.originalEvent.changedTouches[0];\n    return this._handleMouseUp(this._getPositionInfo(touch));\n  };\n\n  return MouseWidget;\n\n})(SimpleWidget);\n\nmodule.exports = MouseWidget;\n\n},{\"./simple.widget\":10}],5:[function(require,module,exports){\nvar $, Node, Position;\n\n$ = jQuery;\n\nPosition = {\n  getName: function(position) {\n    return Position.strings[position - 1];\n  },\n  nameToIndex: function(name) {\n    var i, j, ref;\n    for (i = j = 1, ref = Position.strings.length; 1 <= ref ? j <= ref : j >= ref; i = 1 <= ref ? ++j : --j) {\n      if (Position.strings[i - 1] === name) {\n        return i;\n      }\n    }\n    return 0;\n  }\n};\n\nPosition.BEFORE = 1;\n\nPosition.AFTER = 2;\n\nPosition.INSIDE = 3;\n\nPosition.NONE = 4;\n\nPosition.strings = ['before', 'after', 'inside', 'none'];\n\nNode = (function() {\n  function Node(o, is_root, node_class) {\n    if (is_root == null) {\n      is_root = false;\n    }\n    if (node_class == null) {\n      node_class = Node;\n    }\n    this.name = '';\n    this.setData(o);\n    this.children = [];\n    this.parent = null;\n    if (is_root) {\n      this.id_mapping = {};\n      this.tree = this;\n      this.node_class = node_class;\n    }\n  }\n\n  Node.prototype.setData = function(o) {\n\n    /*\n    Set the data of this node.\n    \n    setData(string): set the name of the node\n    setdata(object): set attributes of the node\n    \n    Examples:\n        setdata('node1')\n    \n        setData({ name: 'node1', id: 1});\n    \n        setData({ name: 'node2', id: 2, color: 'green'});\n    \n    * This is an internal function; it is not in the docs\n    * Does not remove existing node values\n     */\n    var key, setName, value;\n    setName = (function(_this) {\n      return function(name) {\n        if (name !== null) {\n          return _this.name = name;\n        }\n      };\n    })(this);\n    if (typeof o !== 'object') {\n      setName(o);\n    } else {\n      for (key in o) {\n        value = o[key];\n        if (key === 'label') {\n          setName(value);\n        } else if (key !== 'children') {\n          this[key] = value;\n        }\n      }\n    }\n    return null;\n  };\n\n  Node.prototype.initFromData = function(data) {\n    var addChildren, addNode;\n    addNode = (function(_this) {\n      return function(node_data) {\n        _this.setData(node_data);\n        if (node_data.children) {\n          return addChildren(node_data.children);\n        }\n      };\n    })(this);\n    addChildren = (function(_this) {\n      return function(children_data) {\n        var child, j, len, node;\n        for (j = 0, len = children_data.length; j < len; j++) {\n          child = children_data[j];\n          node = new _this.tree.node_class('');\n          node.initFromData(child);\n          _this.addChild(node);\n        }\n        return null;\n      };\n    })(this);\n    addNode(data);\n    return null;\n  };\n\n\n  /*\n  Create tree from data.\n  \n  Structure of data is:\n  [\n      {\n          label: 'node1',\n          children: [\n              { label: 'child1' },\n              { label: 'child2' }\n          ]\n      },\n      {\n          label: 'node2'\n      }\n  ]\n   */\n\n  Node.prototype.loadFromData = function(data) {\n    var j, len, node, o;\n    this.removeChildren();\n    for (j = 0, len = data.length; j < len; j++) {\n      o = data[j];\n      node = new this.tree.node_class(o);\n      this.addChild(node);\n      if (typeof o === 'object' && o.children) {\n        node.loadFromData(o.children);\n      }\n    }\n    return null;\n  };\n\n\n  /*\n  Add child.\n  \n  tree.addChild(\n      new Node('child1')\n  );\n   */\n\n  Node.prototype.addChild = function(node) {\n    this.children.push(node);\n    return node._setParent(this);\n  };\n\n\n  /*\n  Add child at position. Index starts at 0.\n  \n  tree.addChildAtPosition(\n      new Node('abc'),\n      1\n  );\n   */\n\n  Node.prototype.addChildAtPosition = function(node, index) {\n    this.children.splice(index, 0, node);\n    return node._setParent(this);\n  };\n\n  Node.prototype._setParent = function(parent) {\n    this.parent = parent;\n    this.tree = parent.tree;\n    return this.tree.addNodeToIndex(this);\n  };\n\n\n  /*\n  Remove child. This also removes the children of the node.\n  \n  tree.removeChild(tree.children[0]);\n   */\n\n  Node.prototype.removeChild = function(node) {\n    node.removeChildren();\n    return this._removeChild(node);\n  };\n\n  Node.prototype._removeChild = function(node) {\n    this.children.splice(this.getChildIndex(node), 1);\n    return this.tree.removeNodeFromIndex(node);\n  };\n\n\n  /*\n  Get child index.\n  \n  var index = getChildIndex(node);\n   */\n\n  Node.prototype.getChildIndex = function(node) {\n    return $.inArray(node, this.children);\n  };\n\n\n  /*\n  Does the tree have children?\n  \n  if (tree.hasChildren()) {\n      //\n  }\n   */\n\n  Node.prototype.hasChildren = function() {\n    return this.children.length !== 0;\n  };\n\n  Node.prototype.isFolder = function() {\n    return this.hasChildren() || this.load_on_demand;\n  };\n\n\n  /*\n  Iterate over all the nodes in the tree.\n  \n  Calls callback with (node, level).\n  \n  The callback must return true to continue the iteration on current node.\n  \n  tree.iterate(\n      function(node, level) {\n         console.log(node.name);\n  \n         // stop iteration after level 2\n         return (level <= 2);\n      }\n  );\n   */\n\n  Node.prototype.iterate = function(callback) {\n    var _iterate;\n    _iterate = function(node, level) {\n      var child, j, len, ref, result;\n      if (node.children) {\n        ref = node.children;\n        for (j = 0, len = ref.length; j < len; j++) {\n          child = ref[j];\n          result = callback(child, level);\n          if (result && child.hasChildren()) {\n            _iterate(child, level + 1);\n          }\n        }\n        return null;\n      }\n    };\n    _iterate(this, 0);\n    return null;\n  };\n\n\n  /*\n  Move node relative to another node.\n  \n  Argument position: Position.BEFORE, Position.AFTER or Position.Inside\n  \n  // move node1 after node2\n  tree.moveNode(node1, node2, Position.AFTER);\n   */\n\n  Node.prototype.moveNode = function(moved_node, target_node, position) {\n    if (moved_node.isParentOf(target_node)) {\n      return;\n    }\n    moved_node.parent._removeChild(moved_node);\n    if (position === Position.AFTER) {\n      return target_node.parent.addChildAtPosition(moved_node, target_node.parent.getChildIndex(target_node) + 1);\n    } else if (position === Position.BEFORE) {\n      return target_node.parent.addChildAtPosition(moved_node, target_node.parent.getChildIndex(target_node));\n    } else if (position === Position.INSIDE) {\n      return target_node.addChildAtPosition(moved_node, 0);\n    }\n  };\n\n\n  /*\n  Get the tree as data.\n   */\n\n  Node.prototype.getData = function(include_parent) {\n    var getDataFromNodes;\n    if (include_parent == null) {\n      include_parent = false;\n    }\n    getDataFromNodes = function(nodes) {\n      var data, j, k, len, node, tmp_node, v;\n      data = [];\n      for (j = 0, len = nodes.length; j < len; j++) {\n        node = nodes[j];\n        tmp_node = {};\n        for (k in node) {\n          v = node[k];\n          if ((k !== 'parent' && k !== 'children' && k !== 'element' && k !== 'tree') && Object.prototype.hasOwnProperty.call(node, k)) {\n            tmp_node[k] = v;\n          }\n        }\n        if (node.hasChildren()) {\n          tmp_node.children = getDataFromNodes(node.children);\n        }\n        data.push(tmp_node);\n      }\n      return data;\n    };\n    if (include_parent) {\n      return getDataFromNodes([this]);\n    } else {\n      return getDataFromNodes(this.children);\n    }\n  };\n\n  Node.prototype.getNodeByName = function(name) {\n    return this.getNodeByCallback(function(node) {\n      return node.name === name;\n    });\n  };\n\n  Node.prototype.getNodeByCallback = function(callback) {\n    var result;\n    result = null;\n    this.iterate(function(node) {\n      if (callback(node)) {\n        result = node;\n        return false;\n      } else {\n        return true;\n      }\n    });\n    return result;\n  };\n\n  Node.prototype.addAfter = function(node_info) {\n    var child_index, node;\n    if (!this.parent) {\n      return null;\n    } else {\n      node = new this.tree.node_class(node_info);\n      child_index = this.parent.getChildIndex(this);\n      this.parent.addChildAtPosition(node, child_index + 1);\n      if (typeof node_info === 'object' && node_info.children && node_info.children.length) {\n        node.loadFromData(node_info.children);\n      }\n      return node;\n    }\n  };\n\n  Node.prototype.addBefore = function(node_info) {\n    var child_index, node;\n    if (!this.parent) {\n      return null;\n    } else {\n      node = new this.tree.node_class(node_info);\n      child_index = this.parent.getChildIndex(this);\n      this.parent.addChildAtPosition(node, child_index);\n      if (typeof node_info === 'object' && node_info.children && node_info.children.length) {\n        node.loadFromData(node_info.children);\n      }\n      return node;\n    }\n  };\n\n  Node.prototype.addParent = function(node_info) {\n    var child, j, len, new_parent, original_parent, ref;\n    if (!this.parent) {\n      return null;\n    } else {\n      new_parent = new this.tree.node_class(node_info);\n      new_parent._setParent(this.tree);\n      original_parent = this.parent;\n      ref = original_parent.children;\n      for (j = 0, len = ref.length; j < len; j++) {\n        child = ref[j];\n        new_parent.addChild(child);\n      }\n      original_parent.children = [];\n      original_parent.addChild(new_parent);\n      return new_parent;\n    }\n  };\n\n  Node.prototype.remove = function() {\n    if (this.parent) {\n      this.parent.removeChild(this);\n      return this.parent = null;\n    }\n  };\n\n  Node.prototype.append = function(node_info) {\n    var node;\n    node = new this.tree.node_class(node_info);\n    this.addChild(node);\n    if (typeof node_info === 'object' && node_info.children && node_info.children.length) {\n      node.loadFromData(node_info.children);\n    }\n    return node;\n  };\n\n  Node.prototype.prepend = function(node_info) {\n    var node;\n    node = new this.tree.node_class(node_info);\n    this.addChildAtPosition(node, 0);\n    if (typeof node_info === 'object' && node_info.children && node_info.children.length) {\n      node.loadFromData(node_info.children);\n    }\n    return node;\n  };\n\n  Node.prototype.isParentOf = function(node) {\n    var parent;\n    parent = node.parent;\n    while (parent) {\n      if (parent === this) {\n        return true;\n      }\n      parent = parent.parent;\n    }\n    return false;\n  };\n\n  Node.prototype.getLevel = function() {\n    var level, node;\n    level = 0;\n    node = this;\n    while (node.parent) {\n      level += 1;\n      node = node.parent;\n    }\n    return level;\n  };\n\n  Node.prototype.getNodeById = function(node_id) {\n    return this.id_mapping[node_id];\n  };\n\n  Node.prototype.addNodeToIndex = function(node) {\n    if (node.id != null) {\n      return this.id_mapping[node.id] = node;\n    }\n  };\n\n  Node.prototype.removeNodeFromIndex = function(node) {\n    if (node.id != null) {\n      return delete this.id_mapping[node.id];\n    }\n  };\n\n  Node.prototype.removeChildren = function() {\n    this.iterate((function(_this) {\n      return function(child) {\n        _this.tree.removeNodeFromIndex(child);\n        return true;\n      };\n    })(this));\n    return this.children = [];\n  };\n\n  Node.prototype.getPreviousSibling = function() {\n    var previous_index;\n    if (!this.parent) {\n      return null;\n    } else {\n      previous_index = this.parent.getChildIndex(this) - 1;\n      if (previous_index >= 0) {\n        return this.parent.children[previous_index];\n      } else {\n        return null;\n      }\n    }\n  };\n\n  Node.prototype.getNextSibling = function() {\n    var next_index;\n    if (!this.parent) {\n      return null;\n    } else {\n      next_index = this.parent.getChildIndex(this) + 1;\n      if (next_index < this.parent.children.length) {\n        return this.parent.children[next_index];\n      } else {\n        return null;\n      }\n    }\n  };\n\n  Node.prototype.getNodesByProperty = function(key, value) {\n    return this.filter(function(node) {\n      return node[key] === value;\n    });\n  };\n\n  Node.prototype.filter = function(f) {\n    var result;\n    result = [];\n    this.iterate(function(node) {\n      if (f(node)) {\n        result.push(node);\n      }\n      return true;\n    });\n    return result;\n  };\n\n  Node.prototype.getNextNode = function(include_children) {\n    var next_sibling;\n    if (include_children == null) {\n      include_children = true;\n    }\n    if (include_children && this.hasChildren() && this.is_open) {\n      return this.children[0];\n    } else {\n      if (!this.parent) {\n        return null;\n      } else {\n        next_sibling = this.getNextSibling();\n        if (next_sibling) {\n          return next_sibling;\n        } else {\n          return this.parent.getNextNode(false);\n        }\n      }\n    }\n  };\n\n  Node.prototype.getPreviousNode = function() {\n    var previous_sibling;\n    if (!this.parent) {\n      return null;\n    } else {\n      previous_sibling = this.getPreviousSibling();\n      if (previous_sibling) {\n        if (!previous_sibling.hasChildren() || !previous_sibling.is_open) {\n          return previous_sibling;\n        } else {\n          return previous_sibling.getLastChild();\n        }\n      } else {\n        return this.getParent();\n      }\n    }\n  };\n\n  Node.prototype.getParent = function() {\n    if (!this.parent) {\n      return null;\n    } else if (!this.parent.parent) {\n      return null;\n    } else {\n      return this.parent;\n    }\n  };\n\n  Node.prototype.getLastChild = function() {\n    var last_child;\n    if (!this.hasChildren()) {\n      return null;\n    } else {\n      last_child = this.children[this.children.length - 1];\n      if (!last_child.hasChildren() || !last_child.is_open) {\n        return last_child;\n      } else {\n        return last_child.getLastChild();\n      }\n    }\n  };\n\n  return Node;\n\n})();\n\nmodule.exports = {\n  Node: Node,\n  Position: Position\n};\n\n},{}],6:[function(require,module,exports){\nvar $, BorderDropHint, FolderElement, GhostDropHint, NodeElement, Position, node,\n  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n  hasProp = {}.hasOwnProperty;\n\nnode = require('./node');\n\nPosition = node.Position;\n\n$ = jQuery;\n\nNodeElement = (function() {\n  function NodeElement(node, tree_widget) {\n    this.init(node, tree_widget);\n  }\n\n  NodeElement.prototype.init = function(node, tree_widget) {\n    this.node = node;\n    this.tree_widget = tree_widget;\n    if (!node.element) {\n      node.element = this.tree_widget.element;\n    }\n    return this.$element = $(node.element);\n  };\n\n  NodeElement.prototype.getUl = function() {\n    return this.$element.children('ul:first');\n  };\n\n  NodeElement.prototype.getSpan = function() {\n    return this.$element.children('.jqtree-element').find('span.jqtree-title');\n  };\n\n  NodeElement.prototype.getLi = function() {\n    return this.$element;\n  };\n\n  NodeElement.prototype.addDropHint = function(position) {\n    if (position === Position.INSIDE) {\n      return new BorderDropHint(this.$element);\n    } else {\n      return new GhostDropHint(this.node, this.$element, position);\n    }\n  };\n\n  NodeElement.prototype.select = function() {\n    var $li, $span;\n    $li = this.getLi();\n    $li.addClass('jqtree-selected');\n    $li.attr('aria-selected', 'true');\n    $span = this.getSpan();\n    return $span.attr('tabindex', 0);\n  };\n\n  NodeElement.prototype.deselect = function() {\n    var $li, $span;\n    $li = this.getLi();\n    $li.removeClass('jqtree-selected');\n    $li.attr('aria-selected', 'false');\n    $span = this.getSpan();\n    return $span.attr('tabindex', -1);\n  };\n\n  return NodeElement;\n\n})();\n\nFolderElement = (function(superClass) {\n  extend(FolderElement, superClass);\n\n  function FolderElement() {\n    return FolderElement.__super__.constructor.apply(this, arguments);\n  }\n\n  FolderElement.prototype.open = function(on_finished, slide) {\n    var $button, doOpen;\n    if (slide == null) {\n      slide = true;\n    }\n    if (!this.node.is_open) {\n      this.node.is_open = true;\n      $button = this.getButton();\n      $button.removeClass('jqtree-closed');\n      $button.html('');\n      $button.append(this.tree_widget.renderer.opened_icon_element.cloneNode(false));\n      doOpen = (function(_this) {\n        return function() {\n          var $li, $span;\n          $li = _this.getLi();\n          $li.removeClass('jqtree-closed');\n          $span = _this.getSpan();\n          $span.attr('aria-expanded', 'true');\n          if (on_finished) {\n            on_finished();\n          }\n          return _this.tree_widget._triggerEvent('tree.open', {\n            node: _this.node\n          });\n        };\n      })(this);\n      if (slide) {\n        return this.getUl().slideDown('fast', doOpen);\n      } else {\n        this.getUl().show();\n        return doOpen();\n      }\n    }\n  };\n\n  FolderElement.prototype.close = function(slide) {\n    var $button, doClose;\n    if (slide == null) {\n      slide = true;\n    }\n    if (this.node.is_open) {\n      this.node.is_open = false;\n      $button = this.getButton();\n      $button.addClass('jqtree-closed');\n      $button.html('');\n      $button.append(this.tree_widget.renderer.closed_icon_element.cloneNode(false));\n      doClose = (function(_this) {\n        return function() {\n          var $li, $span;\n          $li = _this.getLi();\n          $li.addClass('jqtree-closed');\n          $span = _this.getSpan();\n          $span.attr('aria-expanded', 'false');\n          return _this.tree_widget._triggerEvent('tree.close', {\n            node: _this.node\n          });\n        };\n      })(this);\n      if (slide) {\n        return this.getUl().slideUp('fast', doClose);\n      } else {\n        this.getUl().hide();\n        return doClose();\n      }\n    }\n  };\n\n  FolderElement.prototype.getButton = function() {\n    return this.$element.children('.jqtree-element').find('a.jqtree-toggler');\n  };\n\n  FolderElement.prototype.addDropHint = function(position) {\n    if (!this.node.is_open && position === Position.INSIDE) {\n      return new BorderDropHint(this.$element);\n    } else {\n      return new GhostDropHint(this.node, this.$element, position);\n    }\n  };\n\n  return FolderElement;\n\n})(NodeElement);\n\nBorderDropHint = (function() {\n  function BorderDropHint($element) {\n    var $div, width;\n    $div = $element.children('.jqtree-element');\n    width = $element.width() - 4;\n    this.$hint = $('<span class=\"jqtree-border\"></span>');\n    $div.append(this.$hint);\n    this.$hint.css({\n      width: width,\n      height: $div.outerHeight() - 4\n    });\n  }\n\n  BorderDropHint.prototype.remove = function() {\n    return this.$hint.remove();\n  };\n\n  return BorderDropHint;\n\n})();\n\nGhostDropHint = (function() {\n  function GhostDropHint(node, $element, position) {\n    this.$element = $element;\n    this.node = node;\n    this.$ghost = $('<li class=\"jqtree_common jqtree-ghost\"><span class=\"jqtree_common jqtree-circle\"></span><span class=\"jqtree_common jqtree-line\"></span></li>');\n    if (position === Position.AFTER) {\n      this.moveAfter();\n    } else if (position === Position.BEFORE) {\n      this.moveBefore();\n    } else if (position === Position.INSIDE) {\n      if (node.isFolder() && node.is_open) {\n        this.moveInsideOpenFolder();\n      } else {\n        this.moveInside();\n      }\n    }\n  }\n\n  GhostDropHint.prototype.remove = function() {\n    return this.$ghost.remove();\n  };\n\n  GhostDropHint.prototype.moveAfter = function() {\n    return this.$element.after(this.$ghost);\n  };\n\n  GhostDropHint.prototype.moveBefore = function() {\n    return this.$element.before(this.$ghost);\n  };\n\n  GhostDropHint.prototype.moveInsideOpenFolder = function() {\n    return $(this.node.children[0].element).before(this.$ghost);\n  };\n\n  GhostDropHint.prototype.moveInside = function() {\n    this.$element.after(this.$ghost);\n    return this.$ghost.addClass('jqtree-inside');\n  };\n\n  return GhostDropHint;\n\n})();\n\nmodule.exports = {\n  BorderDropHint: BorderDropHint,\n  FolderElement: FolderElement,\n  GhostDropHint: GhostDropHint,\n  NodeElement: NodeElement\n};\n\n},{\"./node\":5}],7:[function(require,module,exports){\nvar $, SaveStateHandler, indexOf, isInt, util;\n\nutil = require('./util');\n\nindexOf = util.indexOf;\n\nisInt = util.isInt;\n\n$ = jQuery;\n\nSaveStateHandler = (function() {\n  function SaveStateHandler(tree_widget) {\n    this.tree_widget = tree_widget;\n  }\n\n  SaveStateHandler.prototype.saveState = function() {\n    var state;\n    state = JSON.stringify(this.getState());\n    if (this.tree_widget.options.onSetStateFromStorage) {\n      return this.tree_widget.options.onSetStateFromStorage(state);\n    } else if (this.supportsLocalStorage()) {\n      return localStorage.setItem(this.getCookieName(), state);\n    } else if ($.cookie) {\n      $.cookie.raw = true;\n      return $.cookie(this.getCookieName(), state, {\n        path: '/'\n      });\n    }\n  };\n\n  SaveStateHandler.prototype.getStateFromStorage = function() {\n    var json_data;\n    json_data = this._loadFromStorage();\n    if (json_data) {\n      return this._parseState(json_data);\n    } else {\n      return null;\n    }\n  };\n\n  SaveStateHandler.prototype._parseState = function(json_data) {\n    var state;\n    state = $.parseJSON(json_data);\n    if (state && state.selected_node && isInt(state.selected_node)) {\n      state.selected_node = [state.selected_node];\n    }\n    return state;\n  };\n\n  SaveStateHandler.prototype._loadFromStorage = function() {\n    if (this.tree_widget.options.onGetStateFromStorage) {\n      return this.tree_widget.options.onGetStateFromStorage();\n    } else if (this.supportsLocalStorage()) {\n      return localStorage.getItem(this.getCookieName());\n    } else if ($.cookie) {\n      $.cookie.raw = true;\n      return $.cookie(this.getCookieName());\n    } else {\n      return null;\n    }\n  };\n\n  SaveStateHandler.prototype.getState = function() {\n    var getOpenNodeIds, getSelectedNodeIds;\n    getOpenNodeIds = (function(_this) {\n      return function() {\n        var open_nodes;\n        open_nodes = [];\n        _this.tree_widget.tree.iterate(function(node) {\n          if (node.is_open && node.id && node.hasChildren()) {\n            open_nodes.push(node.id);\n          }\n          return true;\n        });\n        return open_nodes;\n      };\n    })(this);\n    getSelectedNodeIds = (function(_this) {\n      return function() {\n        var n;\n        return (function() {\n          var i, len, ref, results;\n          ref = this.tree_widget.getSelectedNodes();\n          results = [];\n          for (i = 0, len = ref.length; i < len; i++) {\n            n = ref[i];\n            results.push(n.id);\n          }\n          return results;\n        }).call(_this);\n      };\n    })(this);\n    return {\n      open_nodes: getOpenNodeIds(),\n      selected_node: getSelectedNodeIds()\n    };\n  };\n\n  SaveStateHandler.prototype.setInitialState = function(state) {\n    var must_load_on_demand;\n    if (!state) {\n      return false;\n    } else {\n      must_load_on_demand = this._openInitialNodes(state.open_nodes);\n      this._selectInitialNodes(state.selected_node);\n      return must_load_on_demand;\n    }\n  };\n\n  SaveStateHandler.prototype._openInitialNodes = function(node_ids) {\n    var i, len, must_load_on_demand, node, node_id;\n    must_load_on_demand = false;\n    for (i = 0, len = node_ids.length; i < len; i++) {\n      node_id = node_ids[i];\n      node = this.tree_widget.getNodeById(node_id);\n      if (node) {\n        if (!node.load_on_demand) {\n          node.is_open = true;\n        } else {\n          must_load_on_demand = true;\n        }\n      }\n    }\n    return must_load_on_demand;\n  };\n\n  SaveStateHandler.prototype._selectInitialNodes = function(node_ids) {\n    var i, len, node, node_id, select_count;\n    select_count = 0;\n    for (i = 0, len = node_ids.length; i < len; i++) {\n      node_id = node_ids[i];\n      node = this.tree_widget.getNodeById(node_id);\n      if (node) {\n        select_count += 1;\n        this.tree_widget.select_node_handler.addToSelection(node);\n      }\n    }\n    return select_count !== 0;\n  };\n\n  SaveStateHandler.prototype.setInitialStateOnDemand = function(state, cb_finished) {\n    if (state) {\n      return this._setInitialStateOnDemand(state.open_nodes, state.selected_node, cb_finished);\n    } else {\n      return cb_finished();\n    }\n  };\n\n  SaveStateHandler.prototype._setInitialStateOnDemand = function(node_ids, selected_nodes, cb_finished) {\n    var loadAndOpenNode, loading_count, openNodes;\n    loading_count = 0;\n    openNodes = (function(_this) {\n      return function() {\n        var i, len, new_nodes_ids, node, node_id;\n        new_nodes_ids = [];\n        for (i = 0, len = node_ids.length; i < len; i++) {\n          node_id = node_ids[i];\n          node = _this.tree_widget.getNodeById(node_id);\n          if (!node) {\n            new_nodes_ids.push(node_id);\n          } else {\n            if (!node.is_loading) {\n              if (node.load_on_demand) {\n                loadAndOpenNode(node);\n              } else {\n                _this.tree_widget._openNode(node, false);\n              }\n            }\n          }\n        }\n        node_ids = new_nodes_ids;\n        if (_this._selectInitialNodes(selected_nodes)) {\n          _this.tree_widget._refreshElements();\n        }\n        if (loading_count === 0) {\n          return cb_finished();\n        }\n      };\n    })(this);\n    loadAndOpenNode = (function(_this) {\n      return function(node) {\n        loading_count += 1;\n        return _this.tree_widget._openNode(node, false, function() {\n          loading_count -= 1;\n          return openNodes();\n        });\n      };\n    })(this);\n    return openNodes();\n  };\n\n  SaveStateHandler.prototype.getCookieName = function() {\n    if (typeof this.tree_widget.options.saveState === 'string') {\n      return this.tree_widget.options.saveState;\n    } else {\n      return 'tree';\n    }\n  };\n\n  SaveStateHandler.prototype.supportsLocalStorage = function() {\n    var testSupport;\n    testSupport = function() {\n      var error, error1, key;\n      if (typeof localStorage === \"undefined\" || localStorage === null) {\n        return false;\n      } else {\n        try {\n          key = '_storage_test';\n          sessionStorage.setItem(key, true);\n          sessionStorage.removeItem(key);\n        } catch (error1) {\n          error = error1;\n          return false;\n        }\n        return true;\n      }\n    };\n    if (this._supportsLocalStorage == null) {\n      this._supportsLocalStorage = testSupport();\n    }\n    return this._supportsLocalStorage;\n  };\n\n  SaveStateHandler.prototype.getNodeIdToBeSelected = function() {\n    var state;\n    state = this.getStateFromStorage();\n    if (state && state.selected_node) {\n      return state.selected_node[0];\n    } else {\n      return null;\n    }\n  };\n\n  return SaveStateHandler;\n\n})();\n\nmodule.exports = SaveStateHandler;\n\n},{\"./util\":12}],8:[function(require,module,exports){\nvar $, ScrollHandler;\n\n$ = jQuery;\n\nScrollHandler = (function() {\n  function ScrollHandler(tree_widget) {\n    this.tree_widget = tree_widget;\n    this.previous_top = -1;\n    this.is_initialized = false;\n    this._initScrollParent();\n  }\n\n  ScrollHandler.prototype._initScrollParent = function() {\n    var $scroll_parent, getParentWithOverflow, setDocumentAsScrollParent;\n    getParentWithOverflow = (function(_this) {\n      return function() {\n        var css_values, el, hasOverFlow, i, len, ref;\n        css_values = ['overflow', 'overflow-y'];\n        hasOverFlow = function(el) {\n          var css_value, i, len, ref;\n          for (i = 0, len = css_values.length; i < len; i++) {\n            css_value = css_values[i];\n            if ((ref = $.css(el, css_value)) === 'auto' || ref === 'scroll') {\n              return true;\n            }\n          }\n          return false;\n        };\n        if (hasOverFlow(_this.tree_widget.$el[0])) {\n          return _this.tree_widget.$el;\n        }\n        ref = _this.tree_widget.$el.parents();\n        for (i = 0, len = ref.length; i < len; i++) {\n          el = ref[i];\n          if (hasOverFlow(el)) {\n            return $(el);\n          }\n        }\n        return null;\n      };\n    })(this);\n    setDocumentAsScrollParent = (function(_this) {\n      return function() {\n        _this.scroll_parent_top = 0;\n        return _this.$scroll_parent = null;\n      };\n    })(this);\n    if (this.tree_widget.$el.css('position') === 'fixed') {\n      setDocumentAsScrollParent();\n    }\n    $scroll_parent = getParentWithOverflow();\n    if ($scroll_parent && $scroll_parent.length && $scroll_parent[0].tagName !== 'HTML') {\n      this.$scroll_parent = $scroll_parent;\n      this.scroll_parent_top = this.$scroll_parent.offset().top;\n    } else {\n      setDocumentAsScrollParent();\n    }\n    return this.is_initialized = true;\n  };\n\n  ScrollHandler.prototype._ensureInit = function() {\n    if (!this.is_initialized) {\n      return this._initScrollParent();\n    }\n  };\n\n  ScrollHandler.prototype.checkScrolling = function() {\n    var hovered_area;\n    this._ensureInit();\n    hovered_area = this.tree_widget.dnd_handler.hovered_area;\n    if (hovered_area && hovered_area.top !== this.previous_top) {\n      this.previous_top = hovered_area.top;\n      if (this.$scroll_parent) {\n        return this._handleScrollingWithScrollParent(hovered_area);\n      } else {\n        return this._handleScrollingWithDocument(hovered_area);\n      }\n    }\n  };\n\n  ScrollHandler.prototype._handleScrollingWithScrollParent = function(area) {\n    var distance_bottom;\n    distance_bottom = this.scroll_parent_top + this.$scroll_parent[0].offsetHeight - area.bottom;\n    if (distance_bottom < 20) {\n      this.$scroll_parent[0].scrollTop += 20;\n      this.tree_widget.refreshHitAreas();\n      return this.previous_top = -1;\n    } else if ((area.top - this.scroll_parent_top) < 20) {\n      this.$scroll_parent[0].scrollTop -= 20;\n      this.tree_widget.refreshHitAreas();\n      return this.previous_top = -1;\n    }\n  };\n\n  ScrollHandler.prototype._handleScrollingWithDocument = function(area) {\n    var distance_top;\n    distance_top = area.top - $(document).scrollTop();\n    if (distance_top < 20) {\n      return $(document).scrollTop($(document).scrollTop() - 20);\n    } else if ($(window).height() - (area.bottom - $(document).scrollTop()) < 20) {\n      return $(document).scrollTop($(document).scrollTop() + 20);\n    }\n  };\n\n  ScrollHandler.prototype.scrollTo = function(top) {\n    var tree_top;\n    this._ensureInit();\n    if (this.$scroll_parent) {\n      return this.$scroll_parent[0].scrollTop = top;\n    } else {\n      tree_top = this.tree_widget.$el.offset().top;\n      return $(document).scrollTop(top + tree_top);\n    }\n  };\n\n  ScrollHandler.prototype.isScrolledIntoView = function(element) {\n    var $element, element_bottom, element_top, view_bottom, view_top;\n    this._ensureInit();\n    $element = $(element);\n    if (this.$scroll_parent) {\n      view_top = 0;\n      view_bottom = this.$scroll_parent.height();\n      element_top = $element.offset().top - this.scroll_parent_top;\n      element_bottom = element_top + $element.height();\n    } else {\n      view_top = $(window).scrollTop();\n      view_bottom = view_top + $(window).height();\n      element_top = $element.offset().top;\n      element_bottom = element_top + $element.height();\n    }\n    return (element_bottom <= view_bottom) && (element_top >= view_top);\n  };\n\n  return ScrollHandler;\n\n})();\n\nmodule.exports = ScrollHandler;\n\n},{}],9:[function(require,module,exports){\nvar $, SelectNodeHandler;\n\n$ = jQuery;\n\nSelectNodeHandler = (function() {\n  function SelectNodeHandler(tree_widget) {\n    this.tree_widget = tree_widget;\n    this.clear();\n  }\n\n  SelectNodeHandler.prototype.getSelectedNode = function() {\n    var selected_nodes;\n    selected_nodes = this.getSelectedNodes();\n    if (selected_nodes.length) {\n      return selected_nodes[0];\n    } else {\n      return false;\n    }\n  };\n\n  SelectNodeHandler.prototype.getSelectedNodes = function() {\n    var id, node, selected_nodes;\n    if (this.selected_single_node) {\n      return [this.selected_single_node];\n    } else {\n      selected_nodes = [];\n      for (id in this.selected_nodes) {\n        node = this.tree_widget.getNodeById(id);\n        if (node) {\n          selected_nodes.push(node);\n        }\n      }\n      return selected_nodes;\n    }\n  };\n\n  SelectNodeHandler.prototype.getSelectedNodesUnder = function(parent) {\n    var id, node, selected_nodes;\n    if (this.selected_single_node) {\n      if (parent.isParentOf(this.selected_single_node)) {\n        return [this.selected_single_node];\n      } else {\n        return [];\n      }\n    } else {\n      selected_nodes = [];\n      for (id in this.selected_nodes) {\n        node = this.tree_widget.getNodeById(id);\n        if (node && parent.isParentOf(node)) {\n          selected_nodes.push(node);\n        }\n      }\n      return selected_nodes;\n    }\n  };\n\n  SelectNodeHandler.prototype.isNodeSelected = function(node) {\n    if (node.id) {\n      return this.selected_nodes[node.id];\n    } else if (this.selected_single_node) {\n      return this.selected_single_node.element === node.element;\n    } else {\n      return false;\n    }\n  };\n\n  SelectNodeHandler.prototype.clear = function() {\n    this.selected_nodes = {};\n    return this.selected_single_node = null;\n  };\n\n  SelectNodeHandler.prototype.removeFromSelection = function(node, include_children) {\n    if (include_children == null) {\n      include_children = false;\n    }\n    if (!node.id) {\n      if (this.selected_single_node && node.element === this.selected_single_node.element) {\n        return this.selected_single_node = null;\n      }\n    } else {\n      delete this.selected_nodes[node.id];\n      if (include_children) {\n        return node.iterate((function(_this) {\n          return function(n) {\n            delete _this.selected_nodes[node.id];\n            return true;\n          };\n        })(this));\n      }\n    }\n  };\n\n  SelectNodeHandler.prototype.addToSelection = function(node) {\n    if (node.id) {\n      return this.selected_nodes[node.id] = true;\n    } else {\n      return this.selected_single_node = node;\n    }\n  };\n\n  return SelectNodeHandler;\n\n})();\n\nmodule.exports = SelectNodeHandler;\n\n},{}],10:[function(require,module,exports){\n\n/*\nCopyright 2013 Marco Braak\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n */\nvar $, SimpleWidget,\n  slice = [].slice;\n\n$ = jQuery;\n\nSimpleWidget = (function() {\n  SimpleWidget.prototype.defaults = {};\n\n  function SimpleWidget(el, options) {\n    this.$el = $(el);\n    this.options = $.extend({}, this.defaults, options);\n  }\n\n  SimpleWidget.prototype.destroy = function() {\n    return this._deinit();\n  };\n\n  SimpleWidget.prototype._init = function() {\n    return null;\n  };\n\n  SimpleWidget.prototype._deinit = function() {\n    return null;\n  };\n\n  SimpleWidget.register = function(widget_class, widget_name) {\n    var callFunction, createWidget, destroyWidget, getDataKey, getWidgetData;\n    getDataKey = function() {\n      return \"simple_widget_\" + widget_name;\n    };\n    getWidgetData = function(el, data_key) {\n      var widget;\n      widget = $.data(el, data_key);\n      if (widget && (widget instanceof SimpleWidget)) {\n        return widget;\n      } else {\n        return null;\n      }\n    };\n    createWidget = function($el, options) {\n      var data_key, el, existing_widget, i, len, widget;\n      data_key = getDataKey();\n      for (i = 0, len = $el.length; i < len; i++) {\n        el = $el[i];\n        existing_widget = getWidgetData(el, data_key);\n        if (!existing_widget) {\n          widget = new widget_class(el, options);\n          if (!$.data(el, data_key)) {\n            $.data(el, data_key, widget);\n          }\n          widget._init();\n        }\n      }\n      return $el;\n    };\n    destroyWidget = function($el) {\n      var data_key, el, i, len, results, widget;\n      data_key = getDataKey();\n      results = [];\n      for (i = 0, len = $el.length; i < len; i++) {\n        el = $el[i];\n        widget = getWidgetData(el, data_key);\n        if (widget) {\n          widget.destroy();\n        }\n        results.push($.removeData(el, data_key));\n      }\n      return results;\n    };\n    callFunction = function($el, function_name, args) {\n      var el, i, len, result, widget, widget_function;\n      result = null;\n      for (i = 0, len = $el.length; i < len; i++) {\n        el = $el[i];\n        widget = $.data(el, getDataKey());\n        if (widget && (widget instanceof SimpleWidget)) {\n          widget_function = widget[function_name];\n          if (widget_function && (typeof widget_function === 'function')) {\n            result = widget_function.apply(widget, args);\n          }\n        }\n      }\n      return result;\n    };\n    return $.fn[widget_name] = function() {\n      var $el, args, argument1, function_name, options;\n      argument1 = arguments[0], args = 2 <= arguments.length ? slice.call(arguments, 1) : [];\n      $el = this;\n      if (argument1 === void 0 || typeof argument1 === 'object') {\n        options = argument1;\n        return createWidget($el, options);\n      } else if (typeof argument1 === 'string' && argument1[0] !== '_') {\n        function_name = argument1;\n        if (function_name === 'destroy') {\n          return destroyWidget($el);\n        } else if (function_name === 'get_widget_class') {\n          return widget_class;\n        } else {\n          return callFunction($el, function_name, args);\n        }\n      }\n    };\n  };\n\n  return SimpleWidget;\n\n})();\n\nmodule.exports = SimpleWidget;\n\n},{}],11:[function(require,module,exports){\nvar $, BorderDropHint, DragAndDropHandler, DragElement, ElementsRenderer, FolderElement, GhostDropHint, HitAreasGenerator, JqTreeWidget, KeyHandler, MouseWidget, Node, NodeElement, Position, SaveStateHandler, ScrollHandler, SelectNodeHandler, SimpleWidget, __version__, drag_and_drop_handler, node_module, ref, util_module,\n  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n  hasProp = {}.hasOwnProperty;\n\n__version__ = require('./version');\n\ndrag_and_drop_handler = require('./drag_and_drop_handler');\n\nElementsRenderer = require('./elements_renderer');\n\nKeyHandler = require('./key_handler');\n\nMouseWidget = require('./mouse.widget');\n\nSaveStateHandler = require('./save_state_handler');\n\nScrollHandler = require('./scroll_handler');\n\nSelectNodeHandler = require('./select_node_handler');\n\nSimpleWidget = require('./simple.widget');\n\nnode_module = require('./node');\n\nNode = node_module.Node;\n\nPosition = node_module.Position;\n\nutil_module = require('./util');\n\nref = require('./node_element'), BorderDropHint = ref.BorderDropHint, FolderElement = ref.FolderElement, GhostDropHint = ref.GhostDropHint, NodeElement = ref.NodeElement;\n\nDragAndDropHandler = drag_and_drop_handler.DragAndDropHandler, DragElement = drag_and_drop_handler.DragElement, HitAreasGenerator = drag_and_drop_handler.HitAreasGenerator;\n\n$ = jQuery;\n\nJqTreeWidget = (function(superClass) {\n  extend(JqTreeWidget, superClass);\n\n  function JqTreeWidget() {\n    return JqTreeWidget.__super__.constructor.apply(this, arguments);\n  }\n\n  JqTreeWidget.prototype.BorderDropHint = BorderDropHint;\n\n  JqTreeWidget.prototype.DragElement = DragElement;\n\n  JqTreeWidget.prototype.DragAndDropHandler = DragAndDropHandler;\n\n  JqTreeWidget.prototype.ElementsRenderer = ElementsRenderer;\n\n  JqTreeWidget.prototype.GhostDropHint = GhostDropHint;\n\n  JqTreeWidget.prototype.HitAreasGenerator = HitAreasGenerator;\n\n  JqTreeWidget.prototype.Node = Node;\n\n  JqTreeWidget.prototype.SaveStateHandler = SaveStateHandler;\n\n  JqTreeWidget.prototype.ScrollHandler = ScrollHandler;\n\n  JqTreeWidget.prototype.SelectNodeHandler = SelectNodeHandler;\n\n  JqTreeWidget.prototype.defaults = {\n    autoOpen: false,\n    saveState: false,\n    dragAndDrop: false,\n    selectable: true,\n    useContextMenu: true,\n    onCanSelectNode: null,\n    onSetStateFromStorage: null,\n    onGetStateFromStorage: null,\n    onCreateLi: null,\n    onIsMoveHandle: null,\n    onCanMove: null,\n    onCanMoveTo: null,\n    onLoadFailed: null,\n    autoEscape: true,\n    dataUrl: null,\n    closedIcon: null,\n    openedIcon: '&#x25bc;',\n    slide: true,\n    nodeClass: Node,\n    dataFilter: null,\n    keyboardSupport: true,\n    openFolderDelay: 500,\n    rtl: null,\n    onDragMove: null,\n    onDragStop: null,\n    buttonLeft: true,\n    onLoading: null\n  };\n\n  JqTreeWidget.prototype.toggle = function(node, slide) {\n    if (slide == null) {\n      slide = null;\n    }\n    if (slide === null) {\n      slide = this.options.slide;\n    }\n    if (node.is_open) {\n      this.closeNode(node, slide);\n    } else {\n      this.openNode(node, slide);\n    }\n    return this.element;\n  };\n\n  JqTreeWidget.prototype.getTree = function() {\n    return this.tree;\n  };\n\n  JqTreeWidget.prototype.selectNode = function(node) {\n    this._selectNode(node, false);\n    return this.element;\n  };\n\n  JqTreeWidget.prototype._selectNode = function(node, must_toggle) {\n    var canSelect, deselected_node, openParents, saveState;\n    if (must_toggle == null) {\n      must_toggle = false;\n    }\n    if (!this.select_node_handler) {\n      return;\n    }\n    canSelect = (function(_this) {\n      return function() {\n        if (_this.options.onCanSelectNode) {\n          return _this.options.selectable && _this.options.onCanSelectNode(node);\n        } else {\n          return _this.options.selectable;\n        }\n      };\n    })(this);\n    openParents = (function(_this) {\n      return function() {\n        var parent;\n        parent = node.parent;\n        if (parent && parent.parent && !parent.is_open) {\n          return _this.openNode(parent, false);\n        }\n      };\n    })(this);\n    saveState = (function(_this) {\n      return function() {\n        if (_this.options.saveState) {\n          return _this.save_state_handler.saveState();\n        }\n      };\n    })(this);\n    if (!node) {\n      this._deselectCurrentNode();\n      saveState();\n      return;\n    }\n    if (!canSelect()) {\n      return;\n    }\n    if (this.select_node_handler.isNodeSelected(node)) {\n      if (must_toggle) {\n        this._deselectCurrentNode();\n        this._triggerEvent('tree.select', {\n          node: null,\n          previous_node: node\n        });\n      }\n    } else {\n      deselected_node = this.getSelectedNode();\n      this._deselectCurrentNode();\n      this.addToSelection(node);\n      this._triggerEvent('tree.select', {\n        node: node,\n        deselected_node: deselected_node\n      });\n      openParents();\n    }\n    return saveState();\n  };\n\n  JqTreeWidget.prototype.getSelectedNode = function() {\n    if (this.select_node_handler) {\n      return this.select_node_handler.getSelectedNode();\n    } else {\n      return null;\n    }\n  };\n\n  JqTreeWidget.prototype.toJson = function() {\n    return JSON.stringify(this.tree.getData());\n  };\n\n  JqTreeWidget.prototype.loadData = function(data, parent_node) {\n    this._loadData(data, parent_node);\n    return this.element;\n  };\n\n\n  /*\n  signatures:\n  - loadDataFromUrl(url, parent_node=null, on_finished=null)\n      loadDataFromUrl('/my_data');\n      loadDataFromUrl('/my_data', node1);\n      loadDataFromUrl('/my_data', node1, function() { console.log('finished'); });\n      loadDataFromUrl('/my_data', null, function() { console.log('finished'); });\n  \n  - loadDataFromUrl(parent_node=null, on_finished=null)\n      loadDataFromUrl();\n      loadDataFromUrl(node1);\n      loadDataFromUrl(null, function() { console.log('finished'); });\n      loadDataFromUrl(node1, function() { console.log('finished'); });\n   */\n\n  JqTreeWidget.prototype.loadDataFromUrl = function(param1, param2, param3) {\n    if ($.type(param1) === 'string') {\n      this._loadDataFromUrl(param1, param2, param3);\n    } else {\n      this._loadDataFromUrl(null, param1, param2);\n    }\n    return this.element;\n  };\n\n  JqTreeWidget.prototype.reload = function(on_finished) {\n    this._loadDataFromUrl(null, null, on_finished);\n    return this.element;\n  };\n\n  JqTreeWidget.prototype._loadDataFromUrl = function(url_info, parent_node, on_finished) {\n    var $el, addLoadingClass, handeLoadData, handleError, handleSuccess, loadDataFromUrlInfo, parseUrlInfo, removeLoadingClass;\n    $el = null;\n    addLoadingClass = (function(_this) {\n      return function() {\n        if (parent_node) {\n          $el = $(parent_node.element);\n        } else {\n          $el = _this.element;\n        }\n        $el.addClass('jqtree-loading');\n        return _this._notifyLoading(true, parent_node, $el);\n      };\n    })(this);\n    removeLoadingClass = (function(_this) {\n      return function() {\n        if ($el) {\n          $el.removeClass('jqtree-loading');\n          return _this._notifyLoading(false, parent_node, $el);\n        }\n      };\n    })(this);\n    parseUrlInfo = function() {\n      if ($.type(url_info) === 'string') {\n        return {\n          url: url_info\n        };\n      }\n      if (!url_info.method) {\n        url_info.method = 'get';\n      }\n      return url_info;\n    };\n    handeLoadData = (function(_this) {\n      return function(data) {\n        removeLoadingClass();\n        _this._loadData(data, parent_node);\n        if (on_finished && $.isFunction(on_finished)) {\n          return on_finished();\n        }\n      };\n    })(this);\n    handleSuccess = (function(_this) {\n      return function(response) {\n        var data;\n        if ($.isArray(response) || typeof response === 'object') {\n          data = response;\n        } else if (data != null) {\n          data = $.parseJSON(response);\n        } else {\n          data = [];\n        }\n        if (_this.options.dataFilter) {\n          data = _this.options.dataFilter(data);\n        }\n        return handeLoadData(data);\n      };\n    })(this);\n    handleError = (function(_this) {\n      return function(response) {\n        removeLoadingClass();\n        if (_this.options.onLoadFailed) {\n          return _this.options.onLoadFailed(response);\n        }\n      };\n    })(this);\n    loadDataFromUrlInfo = function() {\n      url_info = parseUrlInfo();\n      return $.ajax($.extend({}, url_info, {\n        method: url_info.method != null ? url_info.method.toUpperCase() : 'GET',\n        cache: false,\n        dataType: 'json',\n        success: handleSuccess,\n        error: handleError\n      }));\n    };\n    if (!url_info) {\n      url_info = this._getDataUrlInfo(parent_node);\n    }\n    addLoadingClass();\n    if (!url_info) {\n      removeLoadingClass();\n    } else if ($.isArray(url_info)) {\n      handeLoadData(url_info);\n    } else {\n      loadDataFromUrlInfo();\n    }\n  };\n\n  JqTreeWidget.prototype._loadData = function(data, parent_node) {\n    var deselectNodes, loadSubtree;\n    if (parent_node == null) {\n      parent_node = null;\n    }\n    deselectNodes = (function(_this) {\n      return function() {\n        var i, len, n, selected_nodes_under_parent;\n        if (_this.select_node_handler) {\n          selected_nodes_under_parent = _this.select_node_handler.getSelectedNodesUnder(parent_node);\n          for (i = 0, len = selected_nodes_under_parent.length; i < len; i++) {\n            n = selected_nodes_under_parent[i];\n            _this.select_node_handler.removeFromSelection(n);\n          }\n        }\n        return null;\n      };\n    })(this);\n    loadSubtree = (function(_this) {\n      return function() {\n        parent_node.loadFromData(data);\n        parent_node.load_on_demand = false;\n        parent_node.is_loading = false;\n        return _this._refreshElements(parent_node);\n      };\n    })(this);\n    if (!data) {\n      return;\n    }\n    this._triggerEvent('tree.load_data', {\n      tree_data: data\n    });\n    if (!parent_node) {\n      this._initTree(data);\n    } else {\n      deselectNodes();\n      loadSubtree();\n    }\n    if (this.isDragging()) {\n      return this.dnd_handler.refresh();\n    }\n  };\n\n  JqTreeWidget.prototype.getNodeById = function(node_id) {\n    return this.tree.getNodeById(node_id);\n  };\n\n  JqTreeWidget.prototype.getNodeByName = function(name) {\n    return this.tree.getNodeByName(name);\n  };\n\n  JqTreeWidget.prototype.getNodesByProperty = function(key, value) {\n    return this.tree.getNodesByProperty(key, value);\n  };\n\n  JqTreeWidget.prototype.getNodeByHtmlElement = function(element) {\n    return this._getNode($(element));\n  };\n\n  JqTreeWidget.prototype.getNodeByCallback = function(callback) {\n    return this.tree.getNodeByCallback(callback);\n  };\n\n  JqTreeWidget.prototype.openNode = function(node, slide) {\n    if (slide == null) {\n      slide = null;\n    }\n    if (slide === null) {\n      slide = this.options.slide;\n    }\n    this._openNode(node, slide);\n    return this.element;\n  };\n\n  JqTreeWidget.prototype._openNode = function(node, slide, on_finished) {\n    var doOpenNode, parent;\n    if (slide == null) {\n      slide = true;\n    }\n    doOpenNode = (function(_this) {\n      return function(_node, _slide, _on_finished) {\n        var folder_element;\n        folder_element = new FolderElement(_node, _this);\n        return folder_element.open(_on_finished, _slide);\n      };\n    })(this);\n    if (node.isFolder()) {\n      if (node.load_on_demand) {\n        return this._loadFolderOnDemand(node, slide, on_finished);\n      } else {\n        parent = node.parent;\n        while (parent) {\n          if (parent.parent) {\n            doOpenNode(parent, false, null);\n          }\n          parent = parent.parent;\n        }\n        doOpenNode(node, slide, on_finished);\n        return this._saveState();\n      }\n    }\n  };\n\n  JqTreeWidget.prototype._loadFolderOnDemand = function(node, slide, on_finished) {\n    if (slide == null) {\n      slide = true;\n    }\n    node.is_loading = true;\n    return this._loadDataFromUrl(null, node, (function(_this) {\n      return function() {\n        return _this._openNode(node, slide, on_finished);\n      };\n    })(this));\n  };\n\n  JqTreeWidget.prototype.closeNode = function(node, slide) {\n    if (slide == null) {\n      slide = null;\n    }\n    if (slide === null) {\n      slide = this.options.slide;\n    }\n    if (node.isFolder()) {\n      new FolderElement(node, this).close(slide);\n      this._saveState();\n    }\n    return this.element;\n  };\n\n  JqTreeWidget.prototype.isDragging = function() {\n    if (this.dnd_handler) {\n      return this.dnd_handler.is_dragging;\n    } else {\n      return false;\n    }\n  };\n\n  JqTreeWidget.prototype.refreshHitAreas = function() {\n    this.dnd_handler.refresh();\n    return this.element;\n  };\n\n  JqTreeWidget.prototype.addNodeAfter = function(new_node_info, existing_node) {\n    var new_node;\n    new_node = existing_node.addAfter(new_node_info);\n    this._refreshElements(existing_node.parent);\n    return new_node;\n  };\n\n  JqTreeWidget.prototype.addNodeBefore = function(new_node_info, existing_node) {\n    var new_node;\n    new_node = existing_node.addBefore(new_node_info);\n    this._refreshElements(existing_node.parent);\n    return new_node;\n  };\n\n  JqTreeWidget.prototype.addParentNode = function(new_node_info, existing_node) {\n    var new_node;\n    new_node = existing_node.addParent(new_node_info);\n    this._refreshElements(new_node.parent);\n    return new_node;\n  };\n\n  JqTreeWidget.prototype.removeNode = function(node) {\n    var parent;\n    parent = node.parent;\n    if (parent) {\n      this.select_node_handler.removeFromSelection(node, true);\n      node.remove();\n      this._refreshElements(parent);\n    }\n    return this.element;\n  };\n\n  JqTreeWidget.prototype.appendNode = function(new_node_info, parent_node) {\n    var node;\n    parent_node = parent_node || this.tree;\n    node = parent_node.append(new_node_info);\n    this._refreshElements(parent_node);\n    return node;\n  };\n\n  JqTreeWidget.prototype.prependNode = function(new_node_info, parent_node) {\n    var node;\n    if (!parent_node) {\n      parent_node = this.tree;\n    }\n    node = parent_node.prepend(new_node_info);\n    this._refreshElements(parent_node);\n    return node;\n  };\n\n  JqTreeWidget.prototype.updateNode = function(node, data) {\n    var id_is_changed;\n    id_is_changed = data.id && data.id !== node.id;\n    if (id_is_changed) {\n      this.tree.removeNodeFromIndex(node);\n    }\n    node.setData(data);\n    if (id_is_changed) {\n      this.tree.addNodeToIndex(node);\n    }\n    if (typeof data === 'object' && data.children && data.children.length) {\n      node.removeChildren();\n      node.loadFromData(data.children);\n    }\n    this.renderer.renderFromNode(node);\n    this._selectCurrentNode();\n    return this.element;\n  };\n\n  JqTreeWidget.prototype.moveNode = function(node, target_node, position) {\n    var position_index;\n    position_index = Position.nameToIndex(position);\n    this.tree.moveNode(node, target_node, position_index);\n    this._refreshElements();\n    return this.element;\n  };\n\n  JqTreeWidget.prototype.getStateFromStorage = function() {\n    return this.save_state_handler.getStateFromStorage();\n  };\n\n  JqTreeWidget.prototype.addToSelection = function(node) {\n    if (node) {\n      this.select_node_handler.addToSelection(node);\n      this._getNodeElementForNode(node).select();\n      this._saveState();\n    }\n    return this.element;\n  };\n\n  JqTreeWidget.prototype.getSelectedNodes = function() {\n    return this.select_node_handler.getSelectedNodes();\n  };\n\n  JqTreeWidget.prototype.isNodeSelected = function(node) {\n    return this.select_node_handler.isNodeSelected(node);\n  };\n\n  JqTreeWidget.prototype.removeFromSelection = function(node) {\n    this.select_node_handler.removeFromSelection(node);\n    this._getNodeElementForNode(node).deselect();\n    this._saveState();\n    return this.element;\n  };\n\n  JqTreeWidget.prototype.scrollToNode = function(node) {\n    var $element, top;\n    $element = $(node.element);\n    top = $element.offset().top - this.$el.offset().top;\n    this.scroll_handler.scrollTo(top);\n    return this.element;\n  };\n\n  JqTreeWidget.prototype.getState = function() {\n    return this.save_state_handler.getState();\n  };\n\n  JqTreeWidget.prototype.setState = function(state) {\n    this.save_state_handler.setInitialState(state);\n    this._refreshElements();\n    return this.element;\n  };\n\n  JqTreeWidget.prototype.setOption = function(option, value) {\n    this.options[option] = value;\n    return this.element;\n  };\n\n  JqTreeWidget.prototype.moveDown = function() {\n    if (this.key_handler) {\n      this.key_handler.moveDown();\n    }\n    return this.element;\n  };\n\n  JqTreeWidget.prototype.moveUp = function() {\n    if (this.key_handler) {\n      this.key_handler.moveUp();\n    }\n    return this.element;\n  };\n\n  JqTreeWidget.prototype.getVersion = function() {\n    return __version__;\n  };\n\n  JqTreeWidget.prototype._init = function() {\n    JqTreeWidget.__super__._init.call(this);\n    this.element = this.$el;\n    this.mouse_delay = 300;\n    this.is_initialized = false;\n    this.options.rtl = this._getRtlOption();\n    if (!this.options.closedIcon) {\n      this.options.closedIcon = this._getDefaultClosedIcon();\n    }\n    this.renderer = new ElementsRenderer(this);\n    if (SaveStateHandler != null) {\n      this.save_state_handler = new SaveStateHandler(this);\n    } else {\n      this.options.saveState = false;\n    }\n    if (SelectNodeHandler != null) {\n      this.select_node_handler = new SelectNodeHandler(this);\n    }\n    if (DragAndDropHandler != null) {\n      this.dnd_handler = new DragAndDropHandler(this);\n    } else {\n      this.options.dragAndDrop = false;\n    }\n    if (ScrollHandler != null) {\n      this.scroll_handler = new ScrollHandler(this);\n    }\n    if ((KeyHandler != null) && (SelectNodeHandler != null)) {\n      this.key_handler = new KeyHandler(this);\n    }\n    this._initData();\n    this.element.click($.proxy(this._click, this));\n    this.element.dblclick($.proxy(this._dblclick, this));\n    if (this.options.useContextMenu) {\n      return this.element.bind('contextmenu', $.proxy(this._contextmenu, this));\n    }\n  };\n\n  JqTreeWidget.prototype._deinit = function() {\n    this.element.empty();\n    this.element.unbind();\n    if (this.key_handler) {\n      this.key_handler.deinit();\n    }\n    this.tree = null;\n    return JqTreeWidget.__super__._deinit.call(this);\n  };\n\n  JqTreeWidget.prototype._initData = function() {\n    if (this.options.data) {\n      return this._loadData(this.options.data);\n    } else {\n      return this._loadDataFromUrl(this._getDataUrlInfo());\n    }\n  };\n\n  JqTreeWidget.prototype._getDataUrlInfo = function(node) {\n    var data_url, getUrlFromString;\n    data_url = this.options.dataUrl || this.element.data('url');\n    getUrlFromString = (function(_this) {\n      return function() {\n        var data, selected_node_id, url_info;\n        url_info = {\n          url: data_url\n        };\n        if (node && node.id) {\n          data = {\n            node: node.id\n          };\n          url_info['data'] = data;\n        } else {\n          selected_node_id = _this._getNodeIdToBeSelected();\n          if (selected_node_id) {\n            data = {\n              selected_node: selected_node_id\n            };\n            url_info['data'] = data;\n          }\n        }\n        return url_info;\n      };\n    })(this);\n    if ($.isFunction(data_url)) {\n      return data_url(node);\n    } else if ($.type(data_url) === 'string') {\n      return getUrlFromString();\n    } else {\n      return data_url;\n    }\n  };\n\n  JqTreeWidget.prototype._getNodeIdToBeSelected = function() {\n    if (this.options.saveState) {\n      return this.save_state_handler.getNodeIdToBeSelected();\n    } else {\n      return null;\n    }\n  };\n\n  JqTreeWidget.prototype._initTree = function(data) {\n    var doInit, must_load_on_demand;\n    doInit = (function(_this) {\n      return function() {\n        if (!_this.is_initialized) {\n          _this.is_initialized = true;\n          return _this._triggerEvent('tree.init');\n        }\n      };\n    })(this);\n    this.tree = new this.options.nodeClass(null, true, this.options.nodeClass);\n    if (this.select_node_handler) {\n      this.select_node_handler.clear();\n    }\n    this.tree.loadFromData(data);\n    must_load_on_demand = this._setInitialState();\n    this._refreshElements();\n    if (!must_load_on_demand) {\n      return doInit();\n    } else {\n      return this._setInitialStateOnDemand(doInit);\n    }\n  };\n\n  JqTreeWidget.prototype._setInitialState = function() {\n    var autoOpenNodes, is_restored, must_load_on_demand, ref1, restoreState;\n    restoreState = (function(_this) {\n      return function() {\n        var must_load_on_demand, state;\n        if (!(_this.options.saveState && _this.save_state_handler)) {\n          return [false, false];\n        } else {\n          state = _this.save_state_handler.getStateFromStorage();\n          if (!state) {\n            return [false, false];\n          } else {\n            must_load_on_demand = _this.save_state_handler.setInitialState(state);\n            return [true, must_load_on_demand];\n          }\n        }\n      };\n    })(this);\n    autoOpenNodes = (function(_this) {\n      return function() {\n        var max_level, must_load_on_demand;\n        if (_this.options.autoOpen === false) {\n          return false;\n        }\n        max_level = _this._getAutoOpenMaxLevel();\n        must_load_on_demand = false;\n        _this.tree.iterate(function(node, level) {\n          if (node.load_on_demand) {\n            must_load_on_demand = true;\n            return false;\n          } else if (!node.hasChildren()) {\n            return false;\n          } else {\n            node.is_open = true;\n            return level !== max_level;\n          }\n        });\n        return must_load_on_demand;\n      };\n    })(this);\n    ref1 = restoreState(), is_restored = ref1[0], must_load_on_demand = ref1[1];\n    if (!is_restored) {\n      must_load_on_demand = autoOpenNodes();\n    }\n    return must_load_on_demand;\n  };\n\n  JqTreeWidget.prototype._setInitialStateOnDemand = function(cb_finished) {\n    var autoOpenNodes, restoreState;\n    restoreState = (function(_this) {\n      return function() {\n        var state;\n        if (!(_this.options.saveState && _this.save_state_handler)) {\n          return false;\n        } else {\n          state = _this.save_state_handler.getStateFromStorage();\n          if (!state) {\n            return false;\n          } else {\n            _this.save_state_handler.setInitialStateOnDemand(state, cb_finished);\n            return true;\n          }\n        }\n      };\n    })(this);\n    autoOpenNodes = (function(_this) {\n      return function() {\n        var loadAndOpenNode, loading_count, max_level, openNodes;\n        max_level = _this._getAutoOpenMaxLevel();\n        loading_count = 0;\n        loadAndOpenNode = function(node) {\n          loading_count += 1;\n          return _this._openNode(node, false, function() {\n            loading_count -= 1;\n            return openNodes();\n          });\n        };\n        openNodes = function() {\n          _this.tree.iterate(function(node, level) {\n            if (node.load_on_demand) {\n              if (!node.is_loading) {\n                loadAndOpenNode(node);\n              }\n              return false;\n            } else {\n              _this._openNode(node, false);\n              return level !== max_level;\n            }\n          });\n          if (loading_count === 0) {\n            return cb_finished();\n          }\n        };\n        return openNodes();\n      };\n    })(this);\n    if (!restoreState()) {\n      return autoOpenNodes();\n    }\n  };\n\n  JqTreeWidget.prototype._getAutoOpenMaxLevel = function() {\n    if (this.options.autoOpen === true) {\n      return -1;\n    } else {\n      return parseInt(this.options.autoOpen);\n    }\n  };\n\n\n  /*\n  Redraw the tree or part of the tree.\n   * from_node: redraw this subtree\n   */\n\n  JqTreeWidget.prototype._refreshElements = function(from_node) {\n    if (from_node == null) {\n      from_node = null;\n    }\n    this.renderer.render(from_node);\n    return this._triggerEvent('tree.refresh');\n  };\n\n  JqTreeWidget.prototype._click = function(e) {\n    var click_target, event, node;\n    click_target = this._getClickTarget(e.target);\n    if (click_target) {\n      if (click_target.type === 'button') {\n        this.toggle(click_target.node, this.options.slide);\n        e.preventDefault();\n        return e.stopPropagation();\n      } else if (click_target.type === 'label') {\n        node = click_target.node;\n        event = this._triggerEvent('tree.click', {\n          node: node,\n          click_event: e\n        });\n        if (!event.isDefaultPrevented()) {\n          return this._selectNode(node, true);\n        }\n      }\n    }\n  };\n\n  JqTreeWidget.prototype._dblclick = function(e) {\n    var click_target;\n    click_target = this._getClickTarget(e.target);\n    if (click_target && click_target.type === 'label') {\n      return this._triggerEvent('tree.dblclick', {\n        node: click_target.node,\n        click_event: e\n      });\n    }\n  };\n\n  JqTreeWidget.prototype._getClickTarget = function(element) {\n    var $button, $el, $target, node;\n    $target = $(element);\n    $button = $target.closest('.jqtree-toggler');\n    if ($button.length) {\n      node = this._getNode($button);\n      if (node) {\n        return {\n          type: 'button',\n          node: node\n        };\n      }\n    } else {\n      $el = $target.closest('.jqtree-element');\n      if ($el.length) {\n        node = this._getNode($el);\n        if (node) {\n          return {\n            type: 'label',\n            node: node\n          };\n        }\n      }\n    }\n    return null;\n  };\n\n  JqTreeWidget.prototype._getNode = function($element) {\n    var $li;\n    $li = $element.closest('li.jqtree_common');\n    if ($li.length === 0) {\n      return null;\n    } else {\n      return $li.data('node');\n    }\n  };\n\n  JqTreeWidget.prototype._getNodeElementForNode = function(node) {\n    if (node.isFolder()) {\n      return new FolderElement(node, this);\n    } else {\n      return new NodeElement(node, this);\n    }\n  };\n\n  JqTreeWidget.prototype._getNodeElement = function($element) {\n    var node;\n    node = this._getNode($element);\n    if (node) {\n      return this._getNodeElementForNode(node);\n    } else {\n      return null;\n    }\n  };\n\n  JqTreeWidget.prototype._contextmenu = function(e) {\n    var $div, node;\n    $div = $(e.target).closest('ul.jqtree-tree .jqtree-element');\n    if ($div.length) {\n      node = this._getNode($div);\n      if (node) {\n        e.preventDefault();\n        e.stopPropagation();\n        this._triggerEvent('tree.contextmenu', {\n          node: node,\n          click_event: e\n        });\n        return false;\n      }\n    }\n  };\n\n  JqTreeWidget.prototype._saveState = function() {\n    if (this.options.saveState) {\n      return this.save_state_handler.saveState();\n    }\n  };\n\n  JqTreeWidget.prototype._mouseCapture = function(position_info) {\n    if (this.options.dragAndDrop) {\n      return this.dnd_handler.mouseCapture(position_info);\n    } else {\n      return false;\n    }\n  };\n\n  JqTreeWidget.prototype._mouseStart = function(position_info) {\n    if (this.options.dragAndDrop) {\n      return this.dnd_handler.mouseStart(position_info);\n    } else {\n      return false;\n    }\n  };\n\n  JqTreeWidget.prototype._mouseDrag = function(position_info) {\n    var result;\n    if (this.options.dragAndDrop) {\n      result = this.dnd_handler.mouseDrag(position_info);\n      if (this.scroll_handler) {\n        this.scroll_handler.checkScrolling();\n      }\n      return result;\n    } else {\n      return false;\n    }\n  };\n\n  JqTreeWidget.prototype._mouseStop = function(position_info) {\n    if (this.options.dragAndDrop) {\n      return this.dnd_handler.mouseStop(position_info);\n    } else {\n      return false;\n    }\n  };\n\n  JqTreeWidget.prototype._triggerEvent = function(event_name, values) {\n    var event;\n    event = $.Event(event_name);\n    $.extend(event, values);\n    this.element.trigger(event);\n    return event;\n  };\n\n  JqTreeWidget.prototype.testGenerateHitAreas = function(moving_node) {\n    this.dnd_handler.current_item = this._getNodeElementForNode(moving_node);\n    this.dnd_handler.generateHitAreas();\n    return this.dnd_handler.hit_areas;\n  };\n\n  JqTreeWidget.prototype._selectCurrentNode = function() {\n    var node, node_element;\n    node = this.getSelectedNode();\n    if (node) {\n      node_element = this._getNodeElementForNode(node);\n      if (node_element) {\n        return node_element.select();\n      }\n    }\n  };\n\n  JqTreeWidget.prototype._deselectCurrentNode = function() {\n    var node;\n    node = this.getSelectedNode();\n    if (node) {\n      return this.removeFromSelection(node);\n    }\n  };\n\n  JqTreeWidget.prototype._getDefaultClosedIcon = function() {\n    if (this.options.rtl) {\n      return '&#x25c0;';\n    } else {\n      return '&#x25ba;';\n    }\n  };\n\n  JqTreeWidget.prototype._getRtlOption = function() {\n    var data_rtl;\n    if (this.options.rtl !== null) {\n      return this.options.rtl;\n    } else {\n      data_rtl = this.element.data('rtl');\n      if ((data_rtl != null) && data_rtl !== false) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n  };\n\n  JqTreeWidget.prototype._notifyLoading = function(is_loading, node, $el) {\n    if (this.options.onLoading) {\n      return this.options.onLoading(is_loading, node, $el);\n    }\n  };\n\n  return JqTreeWidget;\n\n})(MouseWidget);\n\nJqTreeWidget.getModule = function(name) {\n  var modules;\n  modules = {\n    'node': node_module,\n    'util': util_module,\n    'drag_and_drop_handler': drag_and_drop_handler\n  };\n  return modules[name];\n};\n\nSimpleWidget.register(JqTreeWidget, 'tree');\n\n},{\"./drag_and_drop_handler\":1,\"./elements_renderer\":2,\"./key_handler\":3,\"./mouse.widget\":4,\"./node\":5,\"./node_element\":6,\"./save_state_handler\":7,\"./scroll_handler\":8,\"./select_node_handler\":9,\"./simple.widget\":10,\"./util\":12,\"./version\":13}],12:[function(require,module,exports){\nvar _indexOf, getBoolString, html_escape, indexOf, isInt;\n\n_indexOf = function(array, item) {\n  var i, j, len, value;\n  for (i = j = 0, len = array.length; j < len; i = ++j) {\n    value = array[i];\n    if (value === item) {\n      return i;\n    }\n  }\n  return -1;\n};\n\nindexOf = function(array, item) {\n  if (array.indexOf) {\n    return array.indexOf(item);\n  } else {\n    return _indexOf(array, item);\n  }\n};\n\nisInt = function(n) {\n  return typeof n === 'number' && n % 1 === 0;\n};\n\nhtml_escape = function(string) {\n  return ('' + string).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;').replace(/'/g, '&#x27;').replace(/\\//g, '&#x2F;');\n};\n\ngetBoolString = function(value) {\n  if (value) {\n    return 'true';\n  } else {\n    return 'false';\n  }\n};\n\nmodule.exports = {\n  _indexOf: _indexOf,\n  getBoolString: getBoolString,\n  html_escape: html_escape,\n  indexOf: indexOf,\n  isInt: isInt\n};\n\n},{}],13:[function(require,module,exports){\nmodule.exports = '1.3.4';\n\n},{}]},{},[11]);\n\n\n//# sourceURL=webpack://mapss/./media/node_modules/jqtree/tree.jquery.js?");

/***/ }),

/***/ "./media/node_modules/select2/select2.js":
/*!***********************************************!*\
  !*** ./media/node_modules/select2/select2.js ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

eval("/* provided dependency */ var jQuery = __webpack_require__(/*! ./media/node_modules/jquery/dist/jquery.min */ \"./media/node_modules/jquery/dist/jquery.min.js\");\n/*\nCopyright 2012 Igor Vaynberg\n\nVersion: @@ver@@ Timestamp: @@timestamp@@\n\nThis software is licensed under the Apache License, Version 2.0 (the \"Apache License\") or the GNU\nGeneral Public License version 2 (the \"GPL License\"). You may choose either license to govern your\nuse of this software only upon the condition that you accept all of the terms of either the Apache\nLicense or the GPL License.\n\nYou may obtain a copy of the Apache License and the GPL License at:\n\n    http://www.apache.org/licenses/LICENSE-2.0\n    http://www.gnu.org/licenses/gpl-2.0.html\n\nUnless required by applicable law or agreed to in writing, software distributed under the\nApache License or the GPL License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\nCONDITIONS OF ANY KIND, either express or implied. See the Apache License and the GPL License for\nthe specific language governing permissions and limitations under the Apache License and the GPL License.\n*/\n(function ($) {\n    if(typeof $.fn.each2 == \"undefined\") {\n        $.extend($.fn, {\n            /*\n            * 4-10 times faster .each replacement\n            * use it carefully, as it overrides jQuery context of element on each iteration\n            */\n            each2 : function (c) {\n                var j = $([0]), i = -1, l = this.length;\n                while (\n                    ++i < l\n                    && (j.context = j[0] = this[i])\n                    && c.call(j[0], i, j) !== false //\"this\"=DOM, i=index, j=jQuery object\n                );\n                return this;\n            }\n        });\n    }\n})(jQuery);\n\n(function ($, undefined) {\n    \"use strict\";\n    /*global document, window, jQuery, console */\n\n    if (window.Select2 !== undefined) {\n        return;\n    }\n\n    var KEY, AbstractSelect2, SingleSelect2, MultiSelect2, nextUid, sizer,\n        lastMousePosition={x:0,y:0}, $document, scrollBarDimensions,\n\n    KEY = {\n        TAB: 9,\n        ENTER: 13,\n        ESC: 27,\n        SPACE: 32,\n        LEFT: 37,\n        UP: 38,\n        RIGHT: 39,\n        DOWN: 40,\n        SHIFT: 16,\n        CTRL: 17,\n        ALT: 18,\n        PAGE_UP: 33,\n        PAGE_DOWN: 34,\n        HOME: 36,\n        END: 35,\n        BACKSPACE: 8,\n        DELETE: 46,\n        isArrow: function (k) {\n            k = k.which ? k.which : k;\n            switch (k) {\n            case KEY.LEFT:\n            case KEY.RIGHT:\n            case KEY.UP:\n            case KEY.DOWN:\n                return true;\n            }\n            return false;\n        },\n        isControl: function (e) {\n            var k = e.which;\n            switch (k) {\n            case KEY.SHIFT:\n            case KEY.CTRL:\n            case KEY.ALT:\n                return true;\n            }\n\n            if (e.metaKey) return true;\n\n            return false;\n        },\n        isFunctionKey: function (k) {\n            k = k.which ? k.which : k;\n            return k >= 112 && k <= 123;\n        }\n    },\n    MEASURE_SCROLLBAR_TEMPLATE = \"<div class='select2-measure-scrollbar'></div>\",\n\n    DIACRITICS = {\"\\u24B6\":\"A\",\"\\uFF21\":\"A\",\"\\u00C0\":\"A\",\"\\u00C1\":\"A\",\"\\u00C2\":\"A\",\"\\u1EA6\":\"A\",\"\\u1EA4\":\"A\",\"\\u1EAA\":\"A\",\"\\u1EA8\":\"A\",\"\\u00C3\":\"A\",\"\\u0100\":\"A\",\"\\u0102\":\"A\",\"\\u1EB0\":\"A\",\"\\u1EAE\":\"A\",\"\\u1EB4\":\"A\",\"\\u1EB2\":\"A\",\"\\u0226\":\"A\",\"\\u01E0\":\"A\",\"\\u00C4\":\"A\",\"\\u01DE\":\"A\",\"\\u1EA2\":\"A\",\"\\u00C5\":\"A\",\"\\u01FA\":\"A\",\"\\u01CD\":\"A\",\"\\u0200\":\"A\",\"\\u0202\":\"A\",\"\\u1EA0\":\"A\",\"\\u1EAC\":\"A\",\"\\u1EB6\":\"A\",\"\\u1E00\":\"A\",\"\\u0104\":\"A\",\"\\u023A\":\"A\",\"\\u2C6F\":\"A\",\"\\uA732\":\"AA\",\"\\u00C6\":\"AE\",\"\\u01FC\":\"AE\",\"\\u01E2\":\"AE\",\"\\uA734\":\"AO\",\"\\uA736\":\"AU\",\"\\uA738\":\"AV\",\"\\uA73A\":\"AV\",\"\\uA73C\":\"AY\",\"\\u24B7\":\"B\",\"\\uFF22\":\"B\",\"\\u1E02\":\"B\",\"\\u1E04\":\"B\",\"\\u1E06\":\"B\",\"\\u0243\":\"B\",\"\\u0182\":\"B\",\"\\u0181\":\"B\",\"\\u24B8\":\"C\",\"\\uFF23\":\"C\",\"\\u0106\":\"C\",\"\\u0108\":\"C\",\"\\u010A\":\"C\",\"\\u010C\":\"C\",\"\\u00C7\":\"C\",\"\\u1E08\":\"C\",\"\\u0187\":\"C\",\"\\u023B\":\"C\",\"\\uA73E\":\"C\",\"\\u24B9\":\"D\",\"\\uFF24\":\"D\",\"\\u1E0A\":\"D\",\"\\u010E\":\"D\",\"\\u1E0C\":\"D\",\"\\u1E10\":\"D\",\"\\u1E12\":\"D\",\"\\u1E0E\":\"D\",\"\\u0110\":\"D\",\"\\u018B\":\"D\",\"\\u018A\":\"D\",\"\\u0189\":\"D\",\"\\uA779\":\"D\",\"\\u01F1\":\"DZ\",\"\\u01C4\":\"DZ\",\"\\u01F2\":\"Dz\",\"\\u01C5\":\"Dz\",\"\\u24BA\":\"E\",\"\\uFF25\":\"E\",\"\\u00C8\":\"E\",\"\\u00C9\":\"E\",\"\\u00CA\":\"E\",\"\\u1EC0\":\"E\",\"\\u1EBE\":\"E\",\"\\u1EC4\":\"E\",\"\\u1EC2\":\"E\",\"\\u1EBC\":\"E\",\"\\u0112\":\"E\",\"\\u1E14\":\"E\",\"\\u1E16\":\"E\",\"\\u0114\":\"E\",\"\\u0116\":\"E\",\"\\u00CB\":\"E\",\"\\u1EBA\":\"E\",\"\\u011A\":\"E\",\"\\u0204\":\"E\",\"\\u0206\":\"E\",\"\\u1EB8\":\"E\",\"\\u1EC6\":\"E\",\"\\u0228\":\"E\",\"\\u1E1C\":\"E\",\"\\u0118\":\"E\",\"\\u1E18\":\"E\",\"\\u1E1A\":\"E\",\"\\u0190\":\"E\",\"\\u018E\":\"E\",\"\\u24BB\":\"F\",\"\\uFF26\":\"F\",\"\\u1E1E\":\"F\",\"\\u0191\":\"F\",\"\\uA77B\":\"F\",\"\\u24BC\":\"G\",\"\\uFF27\":\"G\",\"\\u01F4\":\"G\",\"\\u011C\":\"G\",\"\\u1E20\":\"G\",\"\\u011E\":\"G\",\"\\u0120\":\"G\",\"\\u01E6\":\"G\",\"\\u0122\":\"G\",\"\\u01E4\":\"G\",\"\\u0193\":\"G\",\"\\uA7A0\":\"G\",\"\\uA77D\":\"G\",\"\\uA77E\":\"G\",\"\\u24BD\":\"H\",\"\\uFF28\":\"H\",\"\\u0124\":\"H\",\"\\u1E22\":\"H\",\"\\u1E26\":\"H\",\"\\u021E\":\"H\",\"\\u1E24\":\"H\",\"\\u1E28\":\"H\",\"\\u1E2A\":\"H\",\"\\u0126\":\"H\",\"\\u2C67\":\"H\",\"\\u2C75\":\"H\",\"\\uA78D\":\"H\",\"\\u24BE\":\"I\",\"\\uFF29\":\"I\",\"\\u00CC\":\"I\",\"\\u00CD\":\"I\",\"\\u00CE\":\"I\",\"\\u0128\":\"I\",\"\\u012A\":\"I\",\"\\u012C\":\"I\",\"\\u0130\":\"I\",\"\\u00CF\":\"I\",\"\\u1E2E\":\"I\",\"\\u1EC8\":\"I\",\"\\u01CF\":\"I\",\"\\u0208\":\"I\",\"\\u020A\":\"I\",\"\\u1ECA\":\"I\",\"\\u012E\":\"I\",\"\\u1E2C\":\"I\",\"\\u0197\":\"I\",\"\\u24BF\":\"J\",\"\\uFF2A\":\"J\",\"\\u0134\":\"J\",\"\\u0248\":\"J\",\"\\u24C0\":\"K\",\"\\uFF2B\":\"K\",\"\\u1E30\":\"K\",\"\\u01E8\":\"K\",\"\\u1E32\":\"K\",\"\\u0136\":\"K\",\"\\u1E34\":\"K\",\"\\u0198\":\"K\",\"\\u2C69\":\"K\",\"\\uA740\":\"K\",\"\\uA742\":\"K\",\"\\uA744\":\"K\",\"\\uA7A2\":\"K\",\"\\u24C1\":\"L\",\"\\uFF2C\":\"L\",\"\\u013F\":\"L\",\"\\u0139\":\"L\",\"\\u013D\":\"L\",\"\\u1E36\":\"L\",\"\\u1E38\":\"L\",\"\\u013B\":\"L\",\"\\u1E3C\":\"L\",\"\\u1E3A\":\"L\",\"\\u0141\":\"L\",\"\\u023D\":\"L\",\"\\u2C62\":\"L\",\"\\u2C60\":\"L\",\"\\uA748\":\"L\",\"\\uA746\":\"L\",\"\\uA780\":\"L\",\"\\u01C7\":\"LJ\",\"\\u01C8\":\"Lj\",\"\\u24C2\":\"M\",\"\\uFF2D\":\"M\",\"\\u1E3E\":\"M\",\"\\u1E40\":\"M\",\"\\u1E42\":\"M\",\"\\u2C6E\":\"M\",\"\\u019C\":\"M\",\"\\u24C3\":\"N\",\"\\uFF2E\":\"N\",\"\\u01F8\":\"N\",\"\\u0143\":\"N\",\"\\u00D1\":\"N\",\"\\u1E44\":\"N\",\"\\u0147\":\"N\",\"\\u1E46\":\"N\",\"\\u0145\":\"N\",\"\\u1E4A\":\"N\",\"\\u1E48\":\"N\",\"\\u0220\":\"N\",\"\\u019D\":\"N\",\"\\uA790\":\"N\",\"\\uA7A4\":\"N\",\"\\u01CA\":\"NJ\",\"\\u01CB\":\"Nj\",\"\\u24C4\":\"O\",\"\\uFF2F\":\"O\",\"\\u00D2\":\"O\",\"\\u00D3\":\"O\",\"\\u00D4\":\"O\",\"\\u1ED2\":\"O\",\"\\u1ED0\":\"O\",\"\\u1ED6\":\"O\",\"\\u1ED4\":\"O\",\"\\u00D5\":\"O\",\"\\u1E4C\":\"O\",\"\\u022C\":\"O\",\"\\u1E4E\":\"O\",\"\\u014C\":\"O\",\"\\u1E50\":\"O\",\"\\u1E52\":\"O\",\"\\u014E\":\"O\",\"\\u022E\":\"O\",\"\\u0230\":\"O\",\"\\u00D6\":\"O\",\"\\u022A\":\"O\",\"\\u1ECE\":\"O\",\"\\u0150\":\"O\",\"\\u01D1\":\"O\",\"\\u020C\":\"O\",\"\\u020E\":\"O\",\"\\u01A0\":\"O\",\"\\u1EDC\":\"O\",\"\\u1EDA\":\"O\",\"\\u1EE0\":\"O\",\"\\u1EDE\":\"O\",\"\\u1EE2\":\"O\",\"\\u1ECC\":\"O\",\"\\u1ED8\":\"O\",\"\\u01EA\":\"O\",\"\\u01EC\":\"O\",\"\\u00D8\":\"O\",\"\\u01FE\":\"O\",\"\\u0186\":\"O\",\"\\u019F\":\"O\",\"\\uA74A\":\"O\",\"\\uA74C\":\"O\",\"\\u01A2\":\"OI\",\"\\uA74E\":\"OO\",\"\\u0222\":\"OU\",\"\\u24C5\":\"P\",\"\\uFF30\":\"P\",\"\\u1E54\":\"P\",\"\\u1E56\":\"P\",\"\\u01A4\":\"P\",\"\\u2C63\":\"P\",\"\\uA750\":\"P\",\"\\uA752\":\"P\",\"\\uA754\":\"P\",\"\\u24C6\":\"Q\",\"\\uFF31\":\"Q\",\"\\uA756\":\"Q\",\"\\uA758\":\"Q\",\"\\u024A\":\"Q\",\"\\u24C7\":\"R\",\"\\uFF32\":\"R\",\"\\u0154\":\"R\",\"\\u1E58\":\"R\",\"\\u0158\":\"R\",\"\\u0210\":\"R\",\"\\u0212\":\"R\",\"\\u1E5A\":\"R\",\"\\u1E5C\":\"R\",\"\\u0156\":\"R\",\"\\u1E5E\":\"R\",\"\\u024C\":\"R\",\"\\u2C64\":\"R\",\"\\uA75A\":\"R\",\"\\uA7A6\":\"R\",\"\\uA782\":\"R\",\"\\u24C8\":\"S\",\"\\uFF33\":\"S\",\"\\u1E9E\":\"S\",\"\\u015A\":\"S\",\"\\u1E64\":\"S\",\"\\u015C\":\"S\",\"\\u1E60\":\"S\",\"\\u0160\":\"S\",\"\\u1E66\":\"S\",\"\\u1E62\":\"S\",\"\\u1E68\":\"S\",\"\\u0218\":\"S\",\"\\u015E\":\"S\",\"\\u2C7E\":\"S\",\"\\uA7A8\":\"S\",\"\\uA784\":\"S\",\"\\u24C9\":\"T\",\"\\uFF34\":\"T\",\"\\u1E6A\":\"T\",\"\\u0164\":\"T\",\"\\u1E6C\":\"T\",\"\\u021A\":\"T\",\"\\u0162\":\"T\",\"\\u1E70\":\"T\",\"\\u1E6E\":\"T\",\"\\u0166\":\"T\",\"\\u01AC\":\"T\",\"\\u01AE\":\"T\",\"\\u023E\":\"T\",\"\\uA786\":\"T\",\"\\uA728\":\"TZ\",\"\\u24CA\":\"U\",\"\\uFF35\":\"U\",\"\\u00D9\":\"U\",\"\\u00DA\":\"U\",\"\\u00DB\":\"U\",\"\\u0168\":\"U\",\"\\u1E78\":\"U\",\"\\u016A\":\"U\",\"\\u1E7A\":\"U\",\"\\u016C\":\"U\",\"\\u00DC\":\"U\",\"\\u01DB\":\"U\",\"\\u01D7\":\"U\",\"\\u01D5\":\"U\",\"\\u01D9\":\"U\",\"\\u1EE6\":\"U\",\"\\u016E\":\"U\",\"\\u0170\":\"U\",\"\\u01D3\":\"U\",\"\\u0214\":\"U\",\"\\u0216\":\"U\",\"\\u01AF\":\"U\",\"\\u1EEA\":\"U\",\"\\u1EE8\":\"U\",\"\\u1EEE\":\"U\",\"\\u1EEC\":\"U\",\"\\u1EF0\":\"U\",\"\\u1EE4\":\"U\",\"\\u1E72\":\"U\",\"\\u0172\":\"U\",\"\\u1E76\":\"U\",\"\\u1E74\":\"U\",\"\\u0244\":\"U\",\"\\u24CB\":\"V\",\"\\uFF36\":\"V\",\"\\u1E7C\":\"V\",\"\\u1E7E\":\"V\",\"\\u01B2\":\"V\",\"\\uA75E\":\"V\",\"\\u0245\":\"V\",\"\\uA760\":\"VY\",\"\\u24CC\":\"W\",\"\\uFF37\":\"W\",\"\\u1E80\":\"W\",\"\\u1E82\":\"W\",\"\\u0174\":\"W\",\"\\u1E86\":\"W\",\"\\u1E84\":\"W\",\"\\u1E88\":\"W\",\"\\u2C72\":\"W\",\"\\u24CD\":\"X\",\"\\uFF38\":\"X\",\"\\u1E8A\":\"X\",\"\\u1E8C\":\"X\",\"\\u24CE\":\"Y\",\"\\uFF39\":\"Y\",\"\\u1EF2\":\"Y\",\"\\u00DD\":\"Y\",\"\\u0176\":\"Y\",\"\\u1EF8\":\"Y\",\"\\u0232\":\"Y\",\"\\u1E8E\":\"Y\",\"\\u0178\":\"Y\",\"\\u1EF6\":\"Y\",\"\\u1EF4\":\"Y\",\"\\u01B3\":\"Y\",\"\\u024E\":\"Y\",\"\\u1EFE\":\"Y\",\"\\u24CF\":\"Z\",\"\\uFF3A\":\"Z\",\"\\u0179\":\"Z\",\"\\u1E90\":\"Z\",\"\\u017B\":\"Z\",\"\\u017D\":\"Z\",\"\\u1E92\":\"Z\",\"\\u1E94\":\"Z\",\"\\u01B5\":\"Z\",\"\\u0224\":\"Z\",\"\\u2C7F\":\"Z\",\"\\u2C6B\":\"Z\",\"\\uA762\":\"Z\",\"\\u24D0\":\"a\",\"\\uFF41\":\"a\",\"\\u1E9A\":\"a\",\"\\u00E0\":\"a\",\"\\u00E1\":\"a\",\"\\u00E2\":\"a\",\"\\u1EA7\":\"a\",\"\\u1EA5\":\"a\",\"\\u1EAB\":\"a\",\"\\u1EA9\":\"a\",\"\\u00E3\":\"a\",\"\\u0101\":\"a\",\"\\u0103\":\"a\",\"\\u1EB1\":\"a\",\"\\u1EAF\":\"a\",\"\\u1EB5\":\"a\",\"\\u1EB3\":\"a\",\"\\u0227\":\"a\",\"\\u01E1\":\"a\",\"\\u00E4\":\"a\",\"\\u01DF\":\"a\",\"\\u1EA3\":\"a\",\"\\u00E5\":\"a\",\"\\u01FB\":\"a\",\"\\u01CE\":\"a\",\"\\u0201\":\"a\",\"\\u0203\":\"a\",\"\\u1EA1\":\"a\",\"\\u1EAD\":\"a\",\"\\u1EB7\":\"a\",\"\\u1E01\":\"a\",\"\\u0105\":\"a\",\"\\u2C65\":\"a\",\"\\u0250\":\"a\",\"\\uA733\":\"aa\",\"\\u00E6\":\"ae\",\"\\u01FD\":\"ae\",\"\\u01E3\":\"ae\",\"\\uA735\":\"ao\",\"\\uA737\":\"au\",\"\\uA739\":\"av\",\"\\uA73B\":\"av\",\"\\uA73D\":\"ay\",\"\\u24D1\":\"b\",\"\\uFF42\":\"b\",\"\\u1E03\":\"b\",\"\\u1E05\":\"b\",\"\\u1E07\":\"b\",\"\\u0180\":\"b\",\"\\u0183\":\"b\",\"\\u0253\":\"b\",\"\\u24D2\":\"c\",\"\\uFF43\":\"c\",\"\\u0107\":\"c\",\"\\u0109\":\"c\",\"\\u010B\":\"c\",\"\\u010D\":\"c\",\"\\u00E7\":\"c\",\"\\u1E09\":\"c\",\"\\u0188\":\"c\",\"\\u023C\":\"c\",\"\\uA73F\":\"c\",\"\\u2184\":\"c\",\"\\u24D3\":\"d\",\"\\uFF44\":\"d\",\"\\u1E0B\":\"d\",\"\\u010F\":\"d\",\"\\u1E0D\":\"d\",\"\\u1E11\":\"d\",\"\\u1E13\":\"d\",\"\\u1E0F\":\"d\",\"\\u0111\":\"d\",\"\\u018C\":\"d\",\"\\u0256\":\"d\",\"\\u0257\":\"d\",\"\\uA77A\":\"d\",\"\\u01F3\":\"dz\",\"\\u01C6\":\"dz\",\"\\u24D4\":\"e\",\"\\uFF45\":\"e\",\"\\u00E8\":\"e\",\"\\u00E9\":\"e\",\"\\u00EA\":\"e\",\"\\u1EC1\":\"e\",\"\\u1EBF\":\"e\",\"\\u1EC5\":\"e\",\"\\u1EC3\":\"e\",\"\\u1EBD\":\"e\",\"\\u0113\":\"e\",\"\\u1E15\":\"e\",\"\\u1E17\":\"e\",\"\\u0115\":\"e\",\"\\u0117\":\"e\",\"\\u00EB\":\"e\",\"\\u1EBB\":\"e\",\"\\u011B\":\"e\",\"\\u0205\":\"e\",\"\\u0207\":\"e\",\"\\u1EB9\":\"e\",\"\\u1EC7\":\"e\",\"\\u0229\":\"e\",\"\\u1E1D\":\"e\",\"\\u0119\":\"e\",\"\\u1E19\":\"e\",\"\\u1E1B\":\"e\",\"\\u0247\":\"e\",\"\\u025B\":\"e\",\"\\u01DD\":\"e\",\"\\u24D5\":\"f\",\"\\uFF46\":\"f\",\"\\u1E1F\":\"f\",\"\\u0192\":\"f\",\"\\uA77C\":\"f\",\"\\u24D6\":\"g\",\"\\uFF47\":\"g\",\"\\u01F5\":\"g\",\"\\u011D\":\"g\",\"\\u1E21\":\"g\",\"\\u011F\":\"g\",\"\\u0121\":\"g\",\"\\u01E7\":\"g\",\"\\u0123\":\"g\",\"\\u01E5\":\"g\",\"\\u0260\":\"g\",\"\\uA7A1\":\"g\",\"\\u1D79\":\"g\",\"\\uA77F\":\"g\",\"\\u24D7\":\"h\",\"\\uFF48\":\"h\",\"\\u0125\":\"h\",\"\\u1E23\":\"h\",\"\\u1E27\":\"h\",\"\\u021F\":\"h\",\"\\u1E25\":\"h\",\"\\u1E29\":\"h\",\"\\u1E2B\":\"h\",\"\\u1E96\":\"h\",\"\\u0127\":\"h\",\"\\u2C68\":\"h\",\"\\u2C76\":\"h\",\"\\u0265\":\"h\",\"\\u0195\":\"hv\",\"\\u24D8\":\"i\",\"\\uFF49\":\"i\",\"\\u00EC\":\"i\",\"\\u00ED\":\"i\",\"\\u00EE\":\"i\",\"\\u0129\":\"i\",\"\\u012B\":\"i\",\"\\u012D\":\"i\",\"\\u00EF\":\"i\",\"\\u1E2F\":\"i\",\"\\u1EC9\":\"i\",\"\\u01D0\":\"i\",\"\\u0209\":\"i\",\"\\u020B\":\"i\",\"\\u1ECB\":\"i\",\"\\u012F\":\"i\",\"\\u1E2D\":\"i\",\"\\u0268\":\"i\",\"\\u0131\":\"i\",\"\\u24D9\":\"j\",\"\\uFF4A\":\"j\",\"\\u0135\":\"j\",\"\\u01F0\":\"j\",\"\\u0249\":\"j\",\"\\u24DA\":\"k\",\"\\uFF4B\":\"k\",\"\\u1E31\":\"k\",\"\\u01E9\":\"k\",\"\\u1E33\":\"k\",\"\\u0137\":\"k\",\"\\u1E35\":\"k\",\"\\u0199\":\"k\",\"\\u2C6A\":\"k\",\"\\uA741\":\"k\",\"\\uA743\":\"k\",\"\\uA745\":\"k\",\"\\uA7A3\":\"k\",\"\\u24DB\":\"l\",\"\\uFF4C\":\"l\",\"\\u0140\":\"l\",\"\\u013A\":\"l\",\"\\u013E\":\"l\",\"\\u1E37\":\"l\",\"\\u1E39\":\"l\",\"\\u013C\":\"l\",\"\\u1E3D\":\"l\",\"\\u1E3B\":\"l\",\"\\u017F\":\"l\",\"\\u0142\":\"l\",\"\\u019A\":\"l\",\"\\u026B\":\"l\",\"\\u2C61\":\"l\",\"\\uA749\":\"l\",\"\\uA781\":\"l\",\"\\uA747\":\"l\",\"\\u01C9\":\"lj\",\"\\u24DC\":\"m\",\"\\uFF4D\":\"m\",\"\\u1E3F\":\"m\",\"\\u1E41\":\"m\",\"\\u1E43\":\"m\",\"\\u0271\":\"m\",\"\\u026F\":\"m\",\"\\u24DD\":\"n\",\"\\uFF4E\":\"n\",\"\\u01F9\":\"n\",\"\\u0144\":\"n\",\"\\u00F1\":\"n\",\"\\u1E45\":\"n\",\"\\u0148\":\"n\",\"\\u1E47\":\"n\",\"\\u0146\":\"n\",\"\\u1E4B\":\"n\",\"\\u1E49\":\"n\",\"\\u019E\":\"n\",\"\\u0272\":\"n\",\"\\u0149\":\"n\",\"\\uA791\":\"n\",\"\\uA7A5\":\"n\",\"\\u01CC\":\"nj\",\"\\u24DE\":\"o\",\"\\uFF4F\":\"o\",\"\\u00F2\":\"o\",\"\\u00F3\":\"o\",\"\\u00F4\":\"o\",\"\\u1ED3\":\"o\",\"\\u1ED1\":\"o\",\"\\u1ED7\":\"o\",\"\\u1ED5\":\"o\",\"\\u00F5\":\"o\",\"\\u1E4D\":\"o\",\"\\u022D\":\"o\",\"\\u1E4F\":\"o\",\"\\u014D\":\"o\",\"\\u1E51\":\"o\",\"\\u1E53\":\"o\",\"\\u014F\":\"o\",\"\\u022F\":\"o\",\"\\u0231\":\"o\",\"\\u00F6\":\"o\",\"\\u022B\":\"o\",\"\\u1ECF\":\"o\",\"\\u0151\":\"o\",\"\\u01D2\":\"o\",\"\\u020D\":\"o\",\"\\u020F\":\"o\",\"\\u01A1\":\"o\",\"\\u1EDD\":\"o\",\"\\u1EDB\":\"o\",\"\\u1EE1\":\"o\",\"\\u1EDF\":\"o\",\"\\u1EE3\":\"o\",\"\\u1ECD\":\"o\",\"\\u1ED9\":\"o\",\"\\u01EB\":\"o\",\"\\u01ED\":\"o\",\"\\u00F8\":\"o\",\"\\u01FF\":\"o\",\"\\u0254\":\"o\",\"\\uA74B\":\"o\",\"\\uA74D\":\"o\",\"\\u0275\":\"o\",\"\\u01A3\":\"oi\",\"\\u0223\":\"ou\",\"\\uA74F\":\"oo\",\"\\u24DF\":\"p\",\"\\uFF50\":\"p\",\"\\u1E55\":\"p\",\"\\u1E57\":\"p\",\"\\u01A5\":\"p\",\"\\u1D7D\":\"p\",\"\\uA751\":\"p\",\"\\uA753\":\"p\",\"\\uA755\":\"p\",\"\\u24E0\":\"q\",\"\\uFF51\":\"q\",\"\\u024B\":\"q\",\"\\uA757\":\"q\",\"\\uA759\":\"q\",\"\\u24E1\":\"r\",\"\\uFF52\":\"r\",\"\\u0155\":\"r\",\"\\u1E59\":\"r\",\"\\u0159\":\"r\",\"\\u0211\":\"r\",\"\\u0213\":\"r\",\"\\u1E5B\":\"r\",\"\\u1E5D\":\"r\",\"\\u0157\":\"r\",\"\\u1E5F\":\"r\",\"\\u024D\":\"r\",\"\\u027D\":\"r\",\"\\uA75B\":\"r\",\"\\uA7A7\":\"r\",\"\\uA783\":\"r\",\"\\u24E2\":\"s\",\"\\uFF53\":\"s\",\"\\u00DF\":\"s\",\"\\u015B\":\"s\",\"\\u1E65\":\"s\",\"\\u015D\":\"s\",\"\\u1E61\":\"s\",\"\\u0161\":\"s\",\"\\u1E67\":\"s\",\"\\u1E63\":\"s\",\"\\u1E69\":\"s\",\"\\u0219\":\"s\",\"\\u015F\":\"s\",\"\\u023F\":\"s\",\"\\uA7A9\":\"s\",\"\\uA785\":\"s\",\"\\u1E9B\":\"s\",\"\\u24E3\":\"t\",\"\\uFF54\":\"t\",\"\\u1E6B\":\"t\",\"\\u1E97\":\"t\",\"\\u0165\":\"t\",\"\\u1E6D\":\"t\",\"\\u021B\":\"t\",\"\\u0163\":\"t\",\"\\u1E71\":\"t\",\"\\u1E6F\":\"t\",\"\\u0167\":\"t\",\"\\u01AD\":\"t\",\"\\u0288\":\"t\",\"\\u2C66\":\"t\",\"\\uA787\":\"t\",\"\\uA729\":\"tz\",\"\\u24E4\":\"u\",\"\\uFF55\":\"u\",\"\\u00F9\":\"u\",\"\\u00FA\":\"u\",\"\\u00FB\":\"u\",\"\\u0169\":\"u\",\"\\u1E79\":\"u\",\"\\u016B\":\"u\",\"\\u1E7B\":\"u\",\"\\u016D\":\"u\",\"\\u00FC\":\"u\",\"\\u01DC\":\"u\",\"\\u01D8\":\"u\",\"\\u01D6\":\"u\",\"\\u01DA\":\"u\",\"\\u1EE7\":\"u\",\"\\u016F\":\"u\",\"\\u0171\":\"u\",\"\\u01D4\":\"u\",\"\\u0215\":\"u\",\"\\u0217\":\"u\",\"\\u01B0\":\"u\",\"\\u1EEB\":\"u\",\"\\u1EE9\":\"u\",\"\\u1EEF\":\"u\",\"\\u1EED\":\"u\",\"\\u1EF1\":\"u\",\"\\u1EE5\":\"u\",\"\\u1E73\":\"u\",\"\\u0173\":\"u\",\"\\u1E77\":\"u\",\"\\u1E75\":\"u\",\"\\u0289\":\"u\",\"\\u24E5\":\"v\",\"\\uFF56\":\"v\",\"\\u1E7D\":\"v\",\"\\u1E7F\":\"v\",\"\\u028B\":\"v\",\"\\uA75F\":\"v\",\"\\u028C\":\"v\",\"\\uA761\":\"vy\",\"\\u24E6\":\"w\",\"\\uFF57\":\"w\",\"\\u1E81\":\"w\",\"\\u1E83\":\"w\",\"\\u0175\":\"w\",\"\\u1E87\":\"w\",\"\\u1E85\":\"w\",\"\\u1E98\":\"w\",\"\\u1E89\":\"w\",\"\\u2C73\":\"w\",\"\\u24E7\":\"x\",\"\\uFF58\":\"x\",\"\\u1E8B\":\"x\",\"\\u1E8D\":\"x\",\"\\u24E8\":\"y\",\"\\uFF59\":\"y\",\"\\u1EF3\":\"y\",\"\\u00FD\":\"y\",\"\\u0177\":\"y\",\"\\u1EF9\":\"y\",\"\\u0233\":\"y\",\"\\u1E8F\":\"y\",\"\\u00FF\":\"y\",\"\\u1EF7\":\"y\",\"\\u1E99\":\"y\",\"\\u1EF5\":\"y\",\"\\u01B4\":\"y\",\"\\u024F\":\"y\",\"\\u1EFF\":\"y\",\"\\u24E9\":\"z\",\"\\uFF5A\":\"z\",\"\\u017A\":\"z\",\"\\u1E91\":\"z\",\"\\u017C\":\"z\",\"\\u017E\":\"z\",\"\\u1E93\":\"z\",\"\\u1E95\":\"z\",\"\\u01B6\":\"z\",\"\\u0225\":\"z\",\"\\u0240\":\"z\",\"\\u2C6C\":\"z\",\"\\uA763\":\"z\",\"\\u0386\":\"\\u0391\",\"\\u0388\":\"\\u0395\",\"\\u0389\":\"\\u0397\",\"\\u038A\":\"\\u0399\",\"\\u03AA\":\"\\u0399\",\"\\u038C\":\"\\u039F\",\"\\u038E\":\"\\u03A5\",\"\\u03AB\":\"\\u03A5\",\"\\u038F\":\"\\u03A9\",\"\\u03AC\":\"\\u03B1\",\"\\u03AD\":\"\\u03B5\",\"\\u03AE\":\"\\u03B7\",\"\\u03AF\":\"\\u03B9\",\"\\u03CA\":\"\\u03B9\",\"\\u0390\":\"\\u03B9\",\"\\u03CC\":\"\\u03BF\",\"\\u03CD\":\"\\u03C5\",\"\\u03CB\":\"\\u03C5\",\"\\u03B0\":\"\\u03C5\",\"\\u03C9\":\"\\u03C9\",\"\\u03C2\":\"\\u03C3\"};\n\n    $document = $(document);\n\n    nextUid=(function() { var counter=1; return function() { return counter++; }; }());\n\n\n    function reinsertElement(element) {\n        var placeholder = $(document.createTextNode(''));\n\n        element.before(placeholder);\n        placeholder.before(element);\n        placeholder.remove();\n    }\n\n    function stripDiacritics(str) {\n        // Used 'uni range + named function' from http://jsperf.com/diacritics/18\n        function match(a) {\n            return DIACRITICS[a] || a;\n        }\n\n        return str.replace(/[^\\u0000-\\u007E]/g, match);\n    }\n\n    function indexOf(value, array) {\n        var i = 0, l = array.length;\n        for (; i < l; i = i + 1) {\n            if (equal(value, array[i])) return i;\n        }\n        return -1;\n    }\n\n    function measureScrollbar () {\n        var $template = $( MEASURE_SCROLLBAR_TEMPLATE );\n        $template.appendTo('body');\n\n        var dim = {\n            width: $template.width() - $template[0].clientWidth,\n            height: $template.height() - $template[0].clientHeight\n        };\n        $template.remove();\n\n        return dim;\n    }\n\n    /**\n     * Compares equality of a and b\n     * @param a\n     * @param b\n     */\n    function equal(a, b) {\n        if (a === b) return true;\n        if (a === undefined || b === undefined) return false;\n        if (a === null || b === null) return false;\n        // Check whether 'a' or 'b' is a string (primitive or object).\n        // The concatenation of an empty string (+'') converts its argument to a string's primitive.\n        if (a.constructor === String) return a+'' === b+''; // a+'' - in case 'a' is a String object\n        if (b.constructor === String) return b+'' === a+''; // b+'' - in case 'b' is a String object\n        return false;\n    }\n\n    /**\n     * Splits the string into an array of values, trimming each value. An empty array is returned for nulls or empty\n     * strings\n     * @param string\n     * @param separator\n     */\n    function splitVal(string, separator) {\n        var val, i, l;\n        if (string === null || string.length < 1) return [];\n        val = string.split(separator);\n        for (i = 0, l = val.length; i < l; i = i + 1) val[i] = $.trim(val[i]);\n        return val;\n    }\n\n    function getSideBorderPadding(element) {\n        return element.outerWidth(false) - element.width();\n    }\n\n    function installKeyUpChangeEvent(element) {\n        var key=\"keyup-change-value\";\n        element.on(\"keydown\", function () {\n            if ($.data(element, key) === undefined) {\n                $.data(element, key, element.val());\n            }\n        });\n        element.on(\"keyup\", function () {\n            var val= $.data(element, key);\n            if (val !== undefined && element.val() !== val) {\n                $.removeData(element, key);\n                element.trigger(\"keyup-change\");\n            }\n        });\n    }\n\n\n    /**\n     * filters mouse events so an event is fired only if the mouse moved.\n     *\n     * filters out mouse events that occur when mouse is stationary but\n     * the elements under the pointer are scrolled.\n     */\n    function installFilteredMouseMove(element) {\n        element.on(\"mousemove\", function (e) {\n            var lastpos = lastMousePosition;\n            if (lastpos === undefined || lastpos.x !== e.pageX || lastpos.y !== e.pageY) {\n                $(e.target).trigger(\"mousemove-filtered\", e);\n            }\n        });\n    }\n\n    /**\n     * Debounces a function. Returns a function that calls the original fn function only if no invocations have been made\n     * within the last quietMillis milliseconds.\n     *\n     * @param quietMillis number of milliseconds to wait before invoking fn\n     * @param fn function to be debounced\n     * @param ctx object to be used as this reference within fn\n     * @return debounced version of fn\n     */\n    function debounce(quietMillis, fn, ctx) {\n        ctx = ctx || undefined;\n        var timeout;\n        return function () {\n            var args = arguments;\n            window.clearTimeout(timeout);\n            timeout = window.setTimeout(function() {\n                fn.apply(ctx, args);\n            }, quietMillis);\n        };\n    }\n\n    function installDebouncedScroll(threshold, element) {\n        var notify = debounce(threshold, function (e) { element.trigger(\"scroll-debounced\", e);});\n        element.on(\"scroll\", function (e) {\n            if (indexOf(e.target, element.get()) >= 0) notify(e);\n        });\n    }\n\n    function focus($el) {\n        if ($el[0] === document.activeElement) return;\n\n        /* set the focus in a 0 timeout - that way the focus is set after the processing\n            of the current event has finished - which seems like the only reliable way\n            to set focus */\n        window.setTimeout(function() {\n            var el=$el[0], pos=$el.val().length, range;\n\n            $el.focus();\n\n            /* make sure el received focus so we do not error out when trying to manipulate the caret.\n                sometimes modals or others listeners may steal it after its set */\n            var isVisible = (el.offsetWidth > 0 || el.offsetHeight > 0);\n            if (isVisible && el === document.activeElement) {\n\n                /* after the focus is set move the caret to the end, necessary when we val()\n                    just before setting focus */\n                if(el.setSelectionRange)\n                {\n                    el.setSelectionRange(pos, pos);\n                }\n                else if (el.createTextRange) {\n                    range = el.createTextRange();\n                    range.collapse(false);\n                    range.select();\n                }\n            }\n        }, 0);\n    }\n\n    function getCursorInfo(el) {\n        el = $(el)[0];\n        var offset = 0;\n        var length = 0;\n        if ('selectionStart' in el) {\n            offset = el.selectionStart;\n            length = el.selectionEnd - offset;\n        } else if ('selection' in document) {\n            el.focus();\n            var sel = document.selection.createRange();\n            length = document.selection.createRange().text.length;\n            sel.moveStart('character', -el.value.length);\n            offset = sel.text.length - length;\n        }\n        return { offset: offset, length: length };\n    }\n\n    function killEvent(event) {\n        event.preventDefault();\n        event.stopPropagation();\n    }\n    function killEventImmediately(event) {\n        event.preventDefault();\n        event.stopImmediatePropagation();\n    }\n\n    function measureTextWidth(e) {\n        if (!sizer){\n            var style = e[0].currentStyle || window.getComputedStyle(e[0], null);\n            sizer = $(document.createElement(\"div\")).css({\n                position: \"absolute\",\n                left: \"-10000px\",\n                top: \"-10000px\",\n                display: \"none\",\n                fontSize: style.fontSize,\n                fontFamily: style.fontFamily,\n                fontStyle: style.fontStyle,\n                fontWeight: style.fontWeight,\n                letterSpacing: style.letterSpacing,\n                textTransform: style.textTransform,\n                whiteSpace: \"nowrap\"\n            });\n            sizer.attr(\"class\",\"select2-sizer\");\n            $(\"body\").append(sizer);\n        }\n        sizer.text(e.val());\n        return sizer.width();\n    }\n\n    function syncCssClasses(dest, src, adapter) {\n        var classes, replacements = [], adapted;\n\n        classes = $.trim(dest.attr(\"class\"));\n\n        if (classes) {\n            classes = '' + classes; // for IE which returns object\n\n            $(classes.split(/\\s+/)).each2(function() {\n                if (this.indexOf(\"select2-\") === 0) {\n                    replacements.push(this);\n                }\n            });\n        }\n\n        classes = $.trim(src.attr(\"class\"));\n\n        if (classes) {\n            classes = '' + classes; // for IE which returns object\n\n            $(classes.split(/\\s+/)).each2(function() {\n                if (this.indexOf(\"select2-\") !== 0) {\n                    adapted = adapter(this);\n\n                    if (adapted) {\n                        replacements.push(adapted);\n                    }\n                }\n            });\n        }\n\n        dest.attr(\"class\", replacements.join(\" \"));\n    }\n\n\n    function markMatch(text, term, markup, escapeMarkup) {\n        var match=stripDiacritics(text.toUpperCase()).indexOf(stripDiacritics(term.toUpperCase())),\n            tl=term.length;\n\n        if (match<0) {\n            markup.push(escapeMarkup(text));\n            return;\n        }\n\n        markup.push(escapeMarkup(text.substring(0, match)));\n        markup.push(\"<span class='select2-match'>\");\n        markup.push(escapeMarkup(text.substring(match, match + tl)));\n        markup.push(\"</span>\");\n        markup.push(escapeMarkup(text.substring(match + tl, text.length)));\n    }\n\n    function defaultEscapeMarkup(markup) {\n        var replace_map = {\n            '\\\\': '&#92;',\n            '&': '&amp;',\n            '<': '&lt;',\n            '>': '&gt;',\n            '\"': '&quot;',\n            \"'\": '&#39;',\n            \"/\": '&#47;'\n        };\n\n        return String(markup).replace(/[&<>\"'\\/\\\\]/g, function (match) {\n            return replace_map[match];\n        });\n    }\n\n    /**\n     * Produces an ajax-based query function\n     *\n     * @param options object containing configuration parameters\n     * @param options.params parameter map for the transport ajax call, can contain such options as cache, jsonpCallback, etc. see $.ajax\n     * @param options.transport function that will be used to execute the ajax request. must be compatible with parameters supported by $.ajax\n     * @param options.url url for the data\n     * @param options.data a function(searchTerm, pageNumber, context) that should return an object containing query string parameters for the above url.\n     * @param options.dataType request data type: ajax, jsonp, other datatypes supported by jQuery's $.ajax function or the transport function if specified\n     * @param options.quietMillis (optional) milliseconds to wait before making the ajaxRequest, helps debounce the ajax function if invoked too often\n     * @param options.results a function(remoteData, pageNumber, query) that converts data returned form the remote request to the format expected by Select2.\n     *      The expected format is an object containing the following keys:\n     *      results array of objects that will be used as choices\n     *      more (optional) boolean indicating whether there are more results available\n     *      Example: {results:[{id:1, text:'Red'},{id:2, text:'Blue'}], more:true}\n     */\n    function ajax(options) {\n        var timeout, // current scheduled but not yet executed request\n            handler = null,\n            quietMillis = options.quietMillis || 100,\n            ajaxUrl = options.url,\n            self = this;\n\n        return function (query) {\n            window.clearTimeout(timeout);\n            timeout = window.setTimeout(function () {\n                var data = options.data, // ajax data function\n                    url = ajaxUrl, // ajax url string or function\n                    transport = options.transport || $.fn.select2.ajaxDefaults.transport,\n                    // deprecated - to be removed in 4.0  - use params instead\n                    deprecated = {\n                        type: options.type || 'GET', // set type of request (GET or POST)\n                        cache: options.cache || false,\n                        jsonpCallback: options.jsonpCallback||undefined,\n                        dataType: options.dataType||\"json\"\n                    },\n                    params = $.extend({}, $.fn.select2.ajaxDefaults.params, deprecated);\n\n                data = data ? data.call(self, query.term, query.page, query.context) : null;\n                url = (typeof url === 'function') ? url.call(self, query.term, query.page, query.context) : url;\n\n                if (handler && typeof handler.abort === \"function\") { handler.abort(); }\n\n                if (options.params) {\n                    if ($.isFunction(options.params)) {\n                        $.extend(params, options.params.call(self));\n                    } else {\n                        $.extend(params, options.params);\n                    }\n                }\n\n                $.extend(params, {\n                    url: url,\n                    dataType: options.dataType,\n                    data: data,\n                    success: function (data) {\n                        // TODO - replace query.page with query so users have access to term, page, etc.\n                        // added query as third paramter to keep backwards compatibility\n                        var results = options.results(data, query.page, query);\n                        query.callback(results);\n                    },\n                    error: function(jqXHR, textStatus, errorThrown){\n                        var results = {\n                            hasError: true,\n                            jqXHR: jqXHR,\n                            textStatus: textStatus,\n                            errorThrown: errorThrown,\n                        };\n\n                        query.callback(results);\n                    }\n                });\n                handler = transport.call(self, params);\n            }, quietMillis);\n        };\n    }\n\n    /**\n     * Produces a query function that works with a local array\n     *\n     * @param options object containing configuration parameters. The options parameter can either be an array or an\n     * object.\n     *\n     * If the array form is used it is assumed that it contains objects with 'id' and 'text' keys.\n     *\n     * If the object form is used it is assumed that it contains 'data' and 'text' keys. The 'data' key should contain\n     * an array of objects that will be used as choices. These objects must contain at least an 'id' key. The 'text'\n     * key can either be a String in which case it is expected that each element in the 'data' array has a key with the\n     * value of 'text' which will be used to match choices. Alternatively, text can be a function(item) that can extract\n     * the text.\n     */\n    function local(options) {\n        var data = options, // data elements\n            dataText,\n            tmp,\n            text = function (item) { return \"\"+item.text; }; // function used to retrieve the text portion of a data item that is matched against the search\n\n         if ($.isArray(data)) {\n            tmp = data;\n            data = { results: tmp };\n        }\n\n         if ($.isFunction(data) === false) {\n            tmp = data;\n            data = function() { return tmp; };\n        }\n\n        var dataItem = data();\n        if (dataItem.text) {\n            text = dataItem.text;\n            // if text is not a function we assume it to be a key name\n            if (!$.isFunction(text)) {\n                dataText = dataItem.text; // we need to store this in a separate variable because in the next step data gets reset and data.text is no longer available\n                text = function (item) { return item[dataText]; };\n            }\n        }\n\n        return function (query) {\n            var t = query.term, filtered = { results: [] }, process;\n            if (t === \"\") {\n                query.callback(data());\n                return;\n            }\n\n            process = function(datum, collection) {\n                var group, attr;\n                datum = datum[0];\n                if (datum.children) {\n                    group = {};\n                    for (attr in datum) {\n                        if (datum.hasOwnProperty(attr)) group[attr]=datum[attr];\n                    }\n                    group.children=[];\n                    $(datum.children).each2(function(i, childDatum) { process(childDatum, group.children); });\n                    if (group.children.length || query.matcher(t, text(group), datum)) {\n                        collection.push(group);\n                    }\n                } else {\n                    if (query.matcher(t, text(datum), datum)) {\n                        collection.push(datum);\n                    }\n                }\n            };\n\n            $(data().results).each2(function(i, datum) { process(datum, filtered.results); });\n            query.callback(filtered);\n        };\n    }\n\n    // TODO javadoc\n    function tags(data) {\n        var isFunc = $.isFunction(data);\n        return function (query) {\n            var t = query.term, filtered = {results: []};\n            var result = isFunc ? data(query) : data;\n            if ($.isArray(result)) {\n                $(result).each(function () {\n                    var isObject = this.text !== undefined,\n                        text = isObject ? this.text : this;\n                    if (t === \"\" || query.matcher(t, text)) {\n                        filtered.results.push(isObject ? this : {id: this, text: this});\n                    }\n                });\n                query.callback(filtered);\n            }\n        };\n    }\n\n    /**\n     * Checks if the formatter function should be used.\n     *\n     * Throws an error if it is not a function. Returns true if it should be used,\n     * false if no formatting should be performed.\n     *\n     * @param formatter\n     */\n    function checkFormatter(formatter, formatterName) {\n        if ($.isFunction(formatter)) return true;\n        if (!formatter) return false;\n        if (typeof(formatter) === 'string') return true;\n        throw new Error(formatterName +\" must be a string, function, or falsy value\");\n    }\n\n  /**\n   * Returns a given value\n   * If given a function, returns its output\n   *\n   * @param val string|function\n   * @param context value of \"this\" to be passed to function\n   * @returns {*}\n   */\n    function evaluate(val, context) {\n        if ($.isFunction(val)) {\n            var args = Array.prototype.slice.call(arguments, 2);\n            return val.apply(context, args);\n        }\n        return val;\n    }\n\n    function countResults(results) {\n        var count = 0;\n        $.each(results, function(i, item) {\n            if (item.children) {\n                count += countResults(item.children);\n            } else {\n                count++;\n            }\n        });\n        return count;\n    }\n\n    /**\n     * Default tokenizer. This function uses breaks the input on substring match of any string from the\n     * opts.tokenSeparators array and uses opts.createSearchChoice to create the choice object. Both of those\n     * two options have to be defined in order for the tokenizer to work.\n     *\n     * @param input text user has typed so far or pasted into the search field\n     * @param selection currently selected choices\n     * @param selectCallback function(choice) callback tho add the choice to selection\n     * @param opts select2's opts\n     * @return undefined/null to leave the current input unchanged, or a string to change the input to the returned value\n     */\n    function defaultTokenizer(input, selection, selectCallback, opts) {\n        var original = input, // store the original so we can compare and know if we need to tell the search to update its text\n            dupe = false, // check for whether a token we extracted represents a duplicate selected choice\n            token, // token\n            index, // position at which the separator was found\n            i, l, // looping variables\n            separator; // the matched separator\n\n        if (!opts.createSearchChoice || !opts.tokenSeparators || opts.tokenSeparators.length < 1) return undefined;\n\n        while (true) {\n            index = -1;\n\n            for (i = 0, l = opts.tokenSeparators.length; i < l; i++) {\n                separator = opts.tokenSeparators[i];\n                index = input.indexOf(separator);\n                if (index >= 0) break;\n            }\n\n            if (index < 0) break; // did not find any token separator in the input string, bail\n\n            token = input.substring(0, index);\n            input = input.substring(index + separator.length);\n\n            if (token.length > 0) {\n                token = opts.createSearchChoice.call(this, token, selection);\n                if (token !== undefined && token !== null && opts.id(token) !== undefined && opts.id(token) !== null) {\n                    dupe = false;\n                    for (i = 0, l = selection.length; i < l; i++) {\n                        if (equal(opts.id(token), opts.id(selection[i]))) {\n                            dupe = true; break;\n                        }\n                    }\n\n                    if (!dupe) selectCallback(token);\n                }\n            }\n        }\n\n        if (original!==input) return input;\n    }\n\n    function cleanupJQueryElements() {\n        var self = this;\n\n        $.each(arguments, function (i, element) {\n            self[element].remove();\n            self[element] = null;\n        });\n    }\n\n    /**\n     * Creates a new class\n     *\n     * @param superClass\n     * @param methods\n     */\n    function clazz(SuperClass, methods) {\n        var constructor = function () {};\n        constructor.prototype = new SuperClass;\n        constructor.prototype.constructor = constructor;\n        constructor.prototype.parent = SuperClass.prototype;\n        constructor.prototype = $.extend(constructor.prototype, methods);\n        return constructor;\n    }\n\n    AbstractSelect2 = clazz(Object, {\n\n        // abstract\n        bind: function (func) {\n            var self = this;\n            return function () {\n                func.apply(self, arguments);\n            };\n        },\n\n        // abstract\n        init: function (opts) {\n            var results, search, resultsSelector = \".select2-results\";\n\n            // prepare options\n            this.opts = opts = this.prepareOpts(opts);\n\n            this.id=opts.id;\n\n            // destroy if called on an existing component\n            if (opts.element.data(\"select2\") !== undefined &&\n                opts.element.data(\"select2\") !== null) {\n                opts.element.data(\"select2\").destroy();\n            }\n\n            this.container = this.createContainer();\n\n            this.liveRegion = $(\"<span>\", {\n                    role: \"status\",\n                    \"aria-live\": \"polite\"\n                })\n                .addClass(\"select2-hidden-accessible\")\n                .appendTo(document.body);\n\n            this.containerId=\"s2id_\"+(opts.element.attr(\"id\") || \"autogen\"+nextUid());\n            this.containerEventName= this.containerId\n                .replace(/([.])/g, '_')\n                .replace(/([;&,\\-\\.\\+\\*\\~':\"\\!\\^#$%@\\[\\]\\(\\)=>\\|])/g, '\\\\$1');\n            this.container.attr(\"id\", this.containerId);\n\n            this.container.attr(\"title\", opts.element.attr(\"title\"));\n\n            this.body = $(\"body\");\n\n            syncCssClasses(this.container, this.opts.element, this.opts.adaptContainerCssClass);\n\n            this.container.attr(\"style\", opts.element.attr(\"style\"));\n            this.container.css(evaluate(opts.containerCss, this.opts.element));\n            this.container.addClass(evaluate(opts.containerCssClass, this.opts.element));\n\n            this.elementTabIndex = this.opts.element.attr(\"tabindex\");\n\n            // swap container for the element\n            this.opts.element\n                .data(\"select2\", this)\n                .attr(\"tabindex\", \"-1\")\n                .before(this.container)\n                .on(\"click.select2\", killEvent); // do not leak click events\n\n            this.container.data(\"select2\", this);\n\n            this.dropdown = this.container.find(\".select2-drop\");\n\n            syncCssClasses(this.dropdown, this.opts.element, this.opts.adaptDropdownCssClass);\n\n            this.dropdown.addClass(evaluate(opts.dropdownCssClass, this.opts.element));\n            this.dropdown.data(\"select2\", this);\n            this.dropdown.on(\"click\", killEvent);\n\n            this.results = results = this.container.find(resultsSelector);\n            this.search = search = this.container.find(\"input.select2-input\");\n\n            this.queryCount = 0;\n            this.resultsPage = 0;\n            this.context = null;\n\n            // initialize the container\n            this.initContainer();\n\n            this.container.on(\"click\", killEvent);\n\n            installFilteredMouseMove(this.results);\n\n            this.dropdown.on(\"mousemove-filtered\", resultsSelector, this.bind(this.highlightUnderEvent));\n            this.dropdown.on(\"touchstart touchmove touchend\", resultsSelector, this.bind(function (event) {\n                this._touchEvent = true;\n                this.highlightUnderEvent(event);\n            }));\n            this.dropdown.on(\"touchmove\", resultsSelector, this.bind(this.touchMoved));\n            this.dropdown.on(\"touchstart touchend\", resultsSelector, this.bind(this.clearTouchMoved));\n\n            // Waiting for a click event on touch devices to select option and hide dropdown\n            // otherwise click will be triggered on an underlying element\n            this.dropdown.on('click', this.bind(function (event) {\n                if (this._touchEvent) {\n                    this._touchEvent = false;\n                    this.selectHighlighted();\n                }\n            }));\n\n            installDebouncedScroll(80, this.results);\n            this.dropdown.on(\"scroll-debounced\", resultsSelector, this.bind(this.loadMoreIfNeeded));\n\n            // do not propagate change event from the search field out of the component\n            $(this.container).on(\"change\", \".select2-input\", function(e) {e.stopPropagation();});\n            $(this.dropdown).on(\"change\", \".select2-input\", function(e) {e.stopPropagation();});\n\n            // if jquery.mousewheel plugin is installed we can prevent out-of-bounds scrolling of results via mousewheel\n            if ($.fn.mousewheel) {\n                results.mousewheel(function (e, delta, deltaX, deltaY) {\n                    var top = results.scrollTop();\n                    if (deltaY > 0 && top - deltaY <= 0) {\n                        results.scrollTop(0);\n                        killEvent(e);\n                    } else if (deltaY < 0 && results.get(0).scrollHeight - results.scrollTop() + deltaY <= results.height()) {\n                        results.scrollTop(results.get(0).scrollHeight - results.height());\n                        killEvent(e);\n                    }\n                });\n            }\n\n            installKeyUpChangeEvent(search);\n            search.on(\"keyup-change input paste\", this.bind(this.updateResults));\n            search.on(\"focus\", function () { search.addClass(\"select2-focused\"); });\n            search.on(\"blur\", function () { search.removeClass(\"select2-focused\");});\n\n            this.dropdown.on(\"mouseup\", resultsSelector, this.bind(function (e) {\n                if ($(e.target).closest(\".select2-result-selectable\").length > 0) {\n                    this.highlightUnderEvent(e);\n                    this.selectHighlighted(e);\n                }\n            }));\n\n            // trap all mouse events from leaving the dropdown. sometimes there may be a modal that is listening\n            // for mouse events outside of itself so it can close itself. since the dropdown is now outside the select2's\n            // dom it will trigger the popup close, which is not what we want\n            // focusin can cause focus wars between modals and select2 since the dropdown is outside the modal.\n            this.dropdown.on(\"click mouseup mousedown touchstart touchend focusin\", function (e) { e.stopPropagation(); });\n\n            this.nextSearchTerm = undefined;\n\n            if ($.isFunction(this.opts.initSelection)) {\n                // initialize selection based on the current value of the source element\n                this.initSelection();\n\n                // if the user has provided a function that can set selection based on the value of the source element\n                // we monitor the change event on the element and trigger it, allowing for two way synchronization\n                this.monitorSource();\n            }\n\n            if (opts.maximumInputLength !== null) {\n                this.search.attr(\"maxlength\", opts.maximumInputLength);\n            }\n\n            var disabled = opts.element.prop(\"disabled\");\n            if (disabled === undefined) disabled = false;\n            this.enable(!disabled);\n\n            var readonly = opts.element.prop(\"readonly\");\n            if (readonly === undefined) readonly = false;\n            this.readonly(readonly);\n\n            // Calculate size of scrollbar\n            scrollBarDimensions = scrollBarDimensions || measureScrollbar();\n\n            this.autofocus = opts.element.prop(\"autofocus\");\n            opts.element.prop(\"autofocus\", false);\n            if (this.autofocus) this.focus();\n\n            this.search.attr(\"placeholder\", opts.searchInputPlaceholder);\n        },\n\n        // abstract\n        destroy: function () {\n            var element=this.opts.element, select2 = element.data(\"select2\"), self = this;\n\n            this.close();\n\n            if (element.length && element[0].detachEvent) {\n                element.each(function () {\n                    this.detachEvent(\"onpropertychange\", self._sync);\n                });\n            }\n            if (this.propertyObserver) {\n                this.propertyObserver.disconnect();\n                this.propertyObserver = null;\n            }\n            this._sync = null;\n\n            if (select2 !== undefined) {\n                select2.container.remove();\n                select2.liveRegion.remove();\n                select2.dropdown.remove();\n                element\n                    .removeClass(\"select2-offscreen\")\n                    .removeData(\"select2\")\n                    .off(\".select2\")\n                    .prop(\"autofocus\", this.autofocus || false);\n                if (this.elementTabIndex) {\n                    element.attr({tabindex: this.elementTabIndex});\n                } else {\n                    element.removeAttr(\"tabindex\");\n                }\n                element.show();\n            }\n\n            cleanupJQueryElements.call(this,\n                \"container\",\n                \"liveRegion\",\n                \"dropdown\",\n                \"results\",\n                \"search\"\n            );\n        },\n\n        // abstract\n        optionToData: function(element) {\n            if (element.is(\"option\")) {\n                return {\n                    id:element.prop(\"value\"),\n                    text:element.text(),\n                    element: element.get(),\n                    css: element.attr(\"class\"),\n                    disabled: element.prop(\"disabled\"),\n                    locked: equal(element.attr(\"locked\"), \"locked\") || equal(element.data(\"locked\"), true)\n                };\n            } else if (element.is(\"optgroup\")) {\n                return {\n                    text:element.attr(\"label\"),\n                    children:[],\n                    element: element.get(),\n                    css: element.attr(\"class\")\n                };\n            }\n        },\n\n        // abstract\n        prepareOpts: function (opts) {\n            var element, select, idKey, ajaxUrl, self = this;\n\n            element = opts.element;\n\n            if (element.get(0).tagName.toLowerCase() === \"select\") {\n                this.select = select = opts.element;\n            }\n\n            if (select) {\n                // these options are not allowed when attached to a select because they are picked up off the element itself\n                $.each([\"id\", \"multiple\", \"ajax\", \"query\", \"createSearchChoice\", \"initSelection\", \"data\", \"tags\"], function () {\n                    if (this in opts) {\n                        throw new Error(\"Option '\" + this + \"' is not allowed for Select2 when attached to a <select> element.\");\n                    }\n                });\n            }\n\n            opts = $.extend({}, {\n                populateResults: function(container, results, query) {\n                    var populate, id=this.opts.id, liveRegion=this.liveRegion;\n\n                    populate=function(results, container, depth) {\n\n                        var i, l, result, selectable, disabled, compound, node, label, innerContainer, formatted;\n\n                        results = opts.sortResults(results, container, query);\n\n                        // collect the created nodes for bulk append\n                        var nodes = [];\n                        for (i = 0, l = results.length; i < l; i = i + 1) {\n\n                            result=results[i];\n\n                            disabled = (result.disabled === true);\n                            selectable = (!disabled) && (id(result) !== undefined);\n\n                            compound=result.children && result.children.length > 0;\n\n                            node=$(\"<li></li>\");\n                            node.addClass(\"select2-results-dept-\"+depth);\n                            node.addClass(\"select2-result\");\n                            node.addClass(selectable ? \"select2-result-selectable\" : \"select2-result-unselectable\");\n                            if (disabled) { node.addClass(\"select2-disabled\"); }\n                            if (compound) { node.addClass(\"select2-result-with-children\"); }\n                            node.addClass(self.opts.formatResultCssClass(result));\n                            node.attr(\"role\", \"presentation\");\n\n                            label=$(document.createElement(\"div\"));\n                            label.addClass(\"select2-result-label\");\n                            label.attr(\"id\", \"select2-result-label-\" + nextUid());\n                            label.attr(\"role\", \"option\");\n\n                            formatted=opts.formatResult(result, label, query, self.opts.escapeMarkup);\n                            if (formatted!==undefined) {\n                                label.html(formatted);\n                                node.append(label);\n                            }\n\n\n                            if (compound) {\n\n                                innerContainer=$(\"<ul></ul>\");\n                                innerContainer.addClass(\"select2-result-sub\");\n                                populate(result.children, innerContainer, depth+1);\n                                node.append(innerContainer);\n                            }\n\n                            node.data(\"select2-data\", result);\n                            nodes.push(node[0]);\n                        }\n\n                        // bulk append the created nodes\n                        container.append(nodes);\n                        liveRegion.text(opts.formatMatches(results.length));\n                    };\n\n                    populate(results, container, 0);\n                }\n            }, $.fn.select2.defaults, opts);\n\n            if (typeof(opts.id) !== \"function\") {\n                idKey = opts.id;\n                opts.id = function (e) { return e[idKey]; };\n            }\n\n            if ($.isArray(opts.element.data(\"select2Tags\"))) {\n                if (\"tags\" in opts) {\n                    throw \"tags specified as both an attribute 'data-select2-tags' and in options of Select2 \" + opts.element.attr(\"id\");\n                }\n                opts.tags=opts.element.data(\"select2Tags\");\n            }\n\n            if (select) {\n                opts.query = this.bind(function (query) {\n                    var data = { results: [], more: false },\n                        term = query.term,\n                        children, placeholderOption, process;\n\n                    process=function(element, collection) {\n                        var group;\n                        if (element.is(\"option\")) {\n                            if (query.matcher(term, element.text(), element)) {\n                                collection.push(self.optionToData(element));\n                            }\n                        } else if (element.is(\"optgroup\")) {\n                            group=self.optionToData(element);\n                            element.children().each2(function(i, elm) { process(elm, group.children); });\n                            if (group.children.length>0) {\n                                collection.push(group);\n                            }\n                        }\n                    };\n\n                    children=element.children();\n\n                    // ignore the placeholder option if there is one\n                    if (this.getPlaceholder() !== undefined && children.length > 0) {\n                        placeholderOption = this.getPlaceholderOption();\n                        if (placeholderOption) {\n                            children=children.not(placeholderOption);\n                        }\n                    }\n\n                    children.each2(function(i, elm) { process(elm, data.results); });\n\n                    query.callback(data);\n                });\n                // this is needed because inside val() we construct choices from options and their id is hardcoded\n                opts.id=function(e) { return e.id; };\n            } else {\n                if (!(\"query\" in opts)) {\n\n                    if (\"ajax\" in opts) {\n                        ajaxUrl = opts.element.data(\"ajax-url\");\n                        if (ajaxUrl && ajaxUrl.length > 0) {\n                            opts.ajax.url = ajaxUrl;\n                        }\n                        opts.query = ajax.call(opts.element, opts.ajax);\n                    } else if (\"data\" in opts) {\n                        opts.query = local(opts.data);\n                    } else if (\"tags\" in opts) {\n                        opts.query = tags(opts.tags);\n                        if (opts.createSearchChoice === undefined) {\n                            opts.createSearchChoice = function (term) { return {id: $.trim(term), text: $.trim(term)}; };\n                        }\n                        if (opts.initSelection === undefined) {\n                            opts.initSelection = function (element, callback) {\n                                var data = [];\n                                $(splitVal(element.val(), opts.separator)).each(function () {\n                                    var obj = { id: this, text: this },\n                                        tags = opts.tags;\n                                    if ($.isFunction(tags)) tags=tags();\n                                    $(tags).each(function() { if (equal(this.id, obj.id)) { obj = this; return false; } });\n                                    data.push(obj);\n                                });\n\n                                callback(data);\n                            };\n                        }\n                    }\n                }\n            }\n            if (typeof(opts.query) !== \"function\") {\n                throw \"query function not defined for Select2 \" + opts.element.attr(\"id\");\n            }\n\n            if (opts.createSearchChoicePosition === 'top') {\n                opts.createSearchChoicePosition = function(list, item) { list.unshift(item); };\n            }\n            else if (opts.createSearchChoicePosition === 'bottom') {\n                opts.createSearchChoicePosition = function(list, item) { list.push(item); };\n            }\n            else if (typeof(opts.createSearchChoicePosition) !== \"function\")  {\n                throw \"invalid createSearchChoicePosition option must be 'top', 'bottom' or a custom function\";\n            }\n\n            return opts;\n        },\n\n        /**\n         * Monitor the original element for changes and update select2 accordingly\n         */\n        // abstract\n        monitorSource: function () {\n            var el = this.opts.element, observer, self = this;\n\n            el.on(\"change.select2\", this.bind(function (e) {\n                if (this.opts.element.data(\"select2-change-triggered\") !== true) {\n                    this.initSelection();\n                }\n            }));\n\n            this._sync = this.bind(function () {\n\n                // sync enabled state\n                var disabled = el.prop(\"disabled\");\n                if (disabled === undefined) disabled = false;\n                this.enable(!disabled);\n\n                var readonly = el.prop(\"readonly\");\n                if (readonly === undefined) readonly = false;\n                this.readonly(readonly);\n\n                syncCssClasses(this.container, this.opts.element, this.opts.adaptContainerCssClass);\n                this.container.addClass(evaluate(this.opts.containerCssClass, this.opts.element));\n\n                syncCssClasses(this.dropdown, this.opts.element, this.opts.adaptDropdownCssClass);\n                this.dropdown.addClass(evaluate(this.opts.dropdownCssClass, this.opts.element));\n\n            });\n\n            // IE8-10 (IE9/10 won't fire propertyChange via attachEventListener)\n            if (el.length && el[0].attachEvent) {\n                el.each(function() {\n                    this.attachEvent(\"onpropertychange\", self._sync);\n                });\n            }\n\n            // safari, chrome, firefox, IE11\n            observer = window.MutationObserver || window.WebKitMutationObserver|| window.MozMutationObserver;\n            if (observer !== undefined) {\n                if (this.propertyObserver) { delete this.propertyObserver; this.propertyObserver = null; }\n                this.propertyObserver = new observer(function (mutations) {\n                    $.each(mutations, self._sync);\n                });\n                this.propertyObserver.observe(el.get(0), { attributes:true, subtree:false });\n            }\n        },\n\n        // abstract\n        triggerSelect: function(data) {\n            var evt = $.Event(\"select2-selecting\", { val: this.id(data), object: data, choice: data });\n            this.opts.element.trigger(evt);\n            return !evt.isDefaultPrevented();\n        },\n\n        /**\n         * Triggers the change event on the source element\n         */\n        // abstract\n        triggerChange: function (details) {\n\n            details = details || {};\n            details= $.extend({}, details, { type: \"change\", val: this.val() });\n            // prevents recursive triggering\n            this.opts.element.data(\"select2-change-triggered\", true);\n            this.opts.element.trigger(details);\n            this.opts.element.data(\"select2-change-triggered\", false);\n\n            // some validation frameworks ignore the change event and listen instead to keyup, click for selects\n            // so here we trigger the click event manually\n            this.opts.element.click();\n\n            // ValidationEngine ignores the change event and listens instead to blur\n            // so here we trigger the blur event manually if so desired\n            if (this.opts.blurOnChange)\n                this.opts.element.blur();\n        },\n\n        //abstract\n        isInterfaceEnabled: function()\n        {\n            return this.enabledInterface === true;\n        },\n\n        // abstract\n        enableInterface: function() {\n            var enabled = this._enabled && !this._readonly,\n                disabled = !enabled;\n\n            if (enabled === this.enabledInterface) return false;\n\n            this.container.toggleClass(\"select2-container-disabled\", disabled);\n            this.close();\n            this.enabledInterface = enabled;\n\n            return true;\n        },\n\n        // abstract\n        enable: function(enabled) {\n            if (enabled === undefined) enabled = true;\n            if (this._enabled === enabled) return;\n            this._enabled = enabled;\n\n            this.opts.element.prop(\"disabled\", !enabled);\n            this.enableInterface();\n        },\n\n        // abstract\n        disable: function() {\n            this.enable(false);\n        },\n\n        // abstract\n        readonly: function(enabled) {\n            if (enabled === undefined) enabled = false;\n            if (this._readonly === enabled) return;\n            this._readonly = enabled;\n\n            this.opts.element.prop(\"readonly\", enabled);\n            this.enableInterface();\n        },\n\n        // abstract\n        opened: function () {\n            return (this.container) ? this.container.hasClass(\"select2-dropdown-open\") : false;\n        },\n\n        // abstract\n        positionDropdown: function() {\n            var $dropdown = this.dropdown,\n                offset = this.container.offset(),\n                height = this.container.outerHeight(false),\n                width = this.container.outerWidth(false),\n                dropHeight = $dropdown.outerHeight(false),\n                $window = $(window),\n                windowWidth = $window.width(),\n                windowHeight = $window.height(),\n                viewPortRight = $window.scrollLeft() + windowWidth,\n                viewportBottom = $window.scrollTop() + windowHeight,\n                dropTop = offset.top + height,\n                dropLeft = offset.left,\n                enoughRoomBelow = dropTop + dropHeight <= viewportBottom,\n                enoughRoomAbove = (offset.top - dropHeight) >= $window.scrollTop(),\n                dropWidth = $dropdown.outerWidth(false),\n                enoughRoomOnRight = dropLeft + dropWidth <= viewPortRight,\n                aboveNow = $dropdown.hasClass(\"select2-drop-above\"),\n                bodyOffset,\n                above,\n                changeDirection,\n                css,\n                resultsListNode;\n\n            // always prefer the current above/below alignment, unless there is not enough room\n            if (aboveNow) {\n                above = true;\n                if (!enoughRoomAbove && enoughRoomBelow) {\n                    changeDirection = true;\n                    above = false;\n                }\n            } else {\n                above = false;\n                if (!enoughRoomBelow && enoughRoomAbove) {\n                    changeDirection = true;\n                    above = true;\n                }\n            }\n\n            //if we are changing direction we need to get positions when dropdown is hidden;\n            if (changeDirection) {\n                $dropdown.hide();\n                offset = this.container.offset();\n                height = this.container.outerHeight(false);\n                width = this.container.outerWidth(false);\n                dropHeight = $dropdown.outerHeight(false);\n                viewPortRight = $window.scrollLeft() + windowWidth;\n                viewportBottom = $window.scrollTop() + windowHeight;\n                dropTop = offset.top + height;\n                dropLeft = offset.left;\n                dropWidth = $dropdown.outerWidth(false);\n                enoughRoomOnRight = dropLeft + dropWidth <= viewPortRight;\n                $dropdown.show();\n\n                // fix so the cursor does not move to the left within the search-textbox in IE\n                this.focusSearch();\n            }\n\n            if (this.opts.dropdownAutoWidth) {\n                resultsListNode = $('.select2-results', $dropdown)[0];\n                $dropdown.addClass('select2-drop-auto-width');\n                $dropdown.css('width', '');\n                // Add scrollbar width to dropdown if vertical scrollbar is present\n                dropWidth = $dropdown.outerWidth(false) + (resultsListNode.scrollHeight === resultsListNode.clientHeight ? 0 : scrollBarDimensions.width);\n                dropWidth > width ? width = dropWidth : dropWidth = width;\n                dropHeight = $dropdown.outerHeight(false);\n                enoughRoomOnRight = dropLeft + dropWidth <= viewPortRight;\n            }\n            else {\n                this.container.removeClass('select2-drop-auto-width');\n            }\n\n            //console.log(\"below/ droptop:\", dropTop, \"dropHeight\", dropHeight, \"sum\", (dropTop+dropHeight)+\" viewport bottom\", viewportBottom, \"enough?\", enoughRoomBelow);\n            //console.log(\"above/ offset.top\", offset.top, \"dropHeight\", dropHeight, \"top\", (offset.top-dropHeight), \"scrollTop\", this.body.scrollTop(), \"enough?\", enoughRoomAbove);\n\n            // fix positioning when body has an offset and is not position: static\n            if (this.body.css('position') !== 'static') {\n                bodyOffset = this.body.offset();\n                dropTop -= bodyOffset.top;\n                dropLeft -= bodyOffset.left;\n            }\n\n            if (!enoughRoomOnRight) {\n                dropLeft = offset.left + this.container.outerWidth(false) - dropWidth;\n            }\n\n            css =  {\n                left: dropLeft,\n                width: width\n            };\n\n            if (above) {\n                css.top = offset.top - dropHeight;\n                css.bottom = 'auto';\n                this.container.addClass(\"select2-drop-above\");\n                $dropdown.addClass(\"select2-drop-above\");\n            }\n            else {\n                css.top = dropTop;\n                css.bottom = 'auto';\n                this.container.removeClass(\"select2-drop-above\");\n                $dropdown.removeClass(\"select2-drop-above\");\n            }\n            css = $.extend(css, evaluate(this.opts.dropdownCss, this.opts.element));\n\n            $dropdown.css(css);\n        },\n\n        // abstract\n        shouldOpen: function() {\n            var event;\n\n            if (this.opened()) return false;\n\n            if (this._enabled === false || this._readonly === true) return false;\n\n            event = $.Event(\"select2-opening\");\n            this.opts.element.trigger(event);\n            return !event.isDefaultPrevented();\n        },\n\n        // abstract\n        clearDropdownAlignmentPreference: function() {\n            // clear the classes used to figure out the preference of where the dropdown should be opened\n            this.container.removeClass(\"select2-drop-above\");\n            this.dropdown.removeClass(\"select2-drop-above\");\n        },\n\n        /**\n         * Opens the dropdown\n         *\n         * @return {Boolean} whether or not dropdown was opened. This method will return false if, for example,\n         * the dropdown is already open, or if the 'open' event listener on the element called preventDefault().\n         */\n        // abstract\n        open: function () {\n\n            if (!this.shouldOpen()) return false;\n\n            this.opening();\n\n            // Only bind the document mousemove when the dropdown is visible\n            $document.on(\"mousemove.select2Event\", function (e) {\n                lastMousePosition.x = e.pageX;\n                lastMousePosition.y = e.pageY;\n            });\n\n            return true;\n        },\n\n        /**\n         * Performs the opening of the dropdown\n         */\n        // abstract\n        opening: function() {\n            var cid = this.containerEventName,\n                scroll = \"scroll.\" + cid,\n                resize = \"resize.\"+cid,\n                orient = \"orientationchange.\"+cid,\n                mask;\n\n            this.container.addClass(\"select2-dropdown-open\").addClass(\"select2-container-active\");\n\n            this.clearDropdownAlignmentPreference();\n\n            if(this.dropdown[0] !== this.body.children().last()[0]) {\n                this.dropdown.detach().appendTo(this.body);\n            }\n\n            // create the dropdown mask if doesn't already exist\n            mask = $(\"#select2-drop-mask\");\n            if (mask.length == 0) {\n                mask = $(document.createElement(\"div\"));\n                mask.attr(\"id\",\"select2-drop-mask\").attr(\"class\",\"select2-drop-mask\");\n                mask.hide();\n                mask.appendTo(this.body);\n                mask.on(\"mousedown touchstart click\", function (e) {\n                    // Prevent IE from generating a click event on the body\n                    reinsertElement(mask);\n\n                    var dropdown = $(\"#select2-drop\"), self;\n                    if (dropdown.length > 0) {\n                        self=dropdown.data(\"select2\");\n                        if (self.opts.selectOnBlur) {\n                            self.selectHighlighted({noFocus: true});\n                        }\n                        self.close();\n                        e.preventDefault();\n                        e.stopPropagation();\n                    }\n                });\n            }\n\n            // ensure the mask is always right before the dropdown\n            if (this.dropdown.prev()[0] !== mask[0]) {\n                this.dropdown.before(mask);\n            }\n\n            // move the global id to the correct dropdown\n            $(\"#select2-drop\").removeAttr(\"id\");\n            this.dropdown.attr(\"id\", \"select2-drop\");\n\n            // show the elements\n            mask.show();\n\n            this.positionDropdown();\n            this.dropdown.show();\n            this.positionDropdown();\n\n            this.dropdown.addClass(\"select2-drop-active\");\n\n            // attach listeners to events that can change the position of the container and thus require\n            // the position of the dropdown to be updated as well so it does not come unglued from the container\n            var that = this;\n            this.container.parents().add(window).each(function () {\n                $(this).on(resize+\" \"+scroll+\" \"+orient, function (e) {\n                    if (that.opened()) that.positionDropdown();\n                });\n            });\n\n\n        },\n\n        // abstract\n        close: function () {\n            if (!this.opened()) return;\n\n            var cid = this.containerEventName,\n                scroll = \"scroll.\" + cid,\n                resize = \"resize.\"+cid,\n                orient = \"orientationchange.\"+cid;\n\n            // unbind event listeners\n            this.container.parents().add(window).each(function () { $(this).off(scroll).off(resize).off(orient); });\n\n            this.clearDropdownAlignmentPreference();\n\n            $(\"#select2-drop-mask\").hide();\n            this.dropdown.removeAttr(\"id\"); // only the active dropdown has the select2-drop id\n            this.dropdown.hide();\n            this.container.removeClass(\"select2-dropdown-open\").removeClass(\"select2-container-active\");\n            this.results.empty();\n\n            // Now that the dropdown is closed, unbind the global document mousemove event\n            $document.off(\"mousemove.select2Event\");\n\n            this.clearSearch();\n            this.search.removeClass(\"select2-active\");\n            this.opts.element.trigger($.Event(\"select2-close\"));\n        },\n\n        /**\n         * Opens control, sets input value, and updates results.\n         */\n        // abstract\n        externalSearch: function (term) {\n            this.open();\n            this.search.val(term);\n            this.updateResults(false);\n        },\n\n        // abstract\n        clearSearch: function () {\n\n        },\n\n        //abstract\n        getMaximumSelectionSize: function() {\n            return evaluate(this.opts.maximumSelectionSize, this.opts.element);\n        },\n\n        // abstract\n        ensureHighlightVisible: function () {\n            var results = this.results, children, index, child, hb, rb, y, more, topOffset;\n\n            index = this.highlight();\n\n            if (index < 0) return;\n\n            if (index == 0) {\n\n                // if the first element is highlighted scroll all the way to the top,\n                // that way any unselectable headers above it will also be scrolled\n                // into view\n\n                results.scrollTop(0);\n                return;\n            }\n\n            children = this.findHighlightableChoices().find('.select2-result-label');\n\n            child = $(children[index]);\n\n            topOffset = (child.offset() || {}).top || 0;\n\n            hb = topOffset + child.outerHeight(true);\n\n            // if this is the last child lets also make sure select2-more-results is visible\n            if (index === children.length - 1) {\n                more = results.find(\"li.select2-more-results\");\n                if (more.length > 0) {\n                    hb = more.offset().top + more.outerHeight(true);\n                }\n            }\n\n            rb = results.offset().top + results.outerHeight(true);\n            if (hb > rb) {\n                results.scrollTop(results.scrollTop() + (hb - rb));\n            }\n            y = topOffset - results.offset().top;\n\n            // make sure the top of the element is visible\n            if (y < 0 && child.css('display') != 'none' ) {\n                results.scrollTop(results.scrollTop() + y); // y is negative\n            }\n        },\n\n        // abstract\n        findHighlightableChoices: function() {\n            return this.results.find(\".select2-result-selectable:not(.select2-disabled):not(.select2-selected)\");\n        },\n\n        // abstract\n        moveHighlight: function (delta) {\n            var choices = this.findHighlightableChoices(),\n                index = this.highlight();\n\n            while (index > -1 && index < choices.length) {\n                index += delta;\n                var choice = $(choices[index]);\n                if (choice.hasClass(\"select2-result-selectable\") && !choice.hasClass(\"select2-disabled\") && !choice.hasClass(\"select2-selected\")) {\n                    this.highlight(index);\n                    break;\n                }\n            }\n        },\n\n        // abstract\n        highlight: function (index) {\n            var choices = this.findHighlightableChoices(),\n                choice,\n                data;\n\n            if (arguments.length === 0) {\n                return indexOf(choices.filter(\".select2-highlighted\")[0], choices.get());\n            }\n\n            if (index >= choices.length) index = choices.length - 1;\n            if (index < 0) index = 0;\n\n            this.removeHighlight();\n\n            choice = $(choices[index]);\n            choice.addClass(\"select2-highlighted\");\n\n            // ensure assistive technology can determine the active choice\n            this.search.attr(\"aria-activedescendant\", choice.find(\".select2-result-label\").attr(\"id\"));\n\n            this.ensureHighlightVisible();\n\n            this.liveRegion.text(choice.text());\n\n            data = choice.data(\"select2-data\");\n            if (data) {\n                this.opts.element.trigger({ type: \"select2-highlight\", val: this.id(data), choice: data });\n            }\n        },\n\n        removeHighlight: function() {\n            this.results.find(\".select2-highlighted\").removeClass(\"select2-highlighted\");\n        },\n\n        touchMoved: function() {\n            this._touchMoved = true;\n        },\n\n        clearTouchMoved: function() {\n          this._touchMoved = false;\n        },\n\n        // abstract\n        countSelectableResults: function() {\n            return this.findHighlightableChoices().length;\n        },\n\n        // abstract\n        highlightUnderEvent: function (event) {\n            var el = $(event.target).closest(\".select2-result-selectable\");\n            if (el.length > 0 && !el.is(\".select2-highlighted\")) {\n                var choices = this.findHighlightableChoices();\n                this.highlight(choices.index(el));\n            } else if (el.length == 0) {\n                // if we are over an unselectable item remove all highlights\n                this.removeHighlight();\n            }\n        },\n\n        // abstract\n        loadMoreIfNeeded: function () {\n            var results = this.results,\n                more = results.find(\"li.select2-more-results\"),\n                below, // pixels the element is below the scroll fold, below==0 is when the element is starting to be visible\n                page = this.resultsPage + 1,\n                self=this,\n                term=this.search.val(),\n                context=this.context;\n\n            if (more.length === 0) return;\n            below = more.offset().top - results.offset().top - results.height();\n\n            if (below <= this.opts.loadMorePadding) {\n                more.addClass(\"select2-active\");\n                this.opts.query({\n                        element: this.opts.element,\n                        term: term,\n                        page: page,\n                        context: context,\n                        matcher: this.opts.matcher,\n                        callback: this.bind(function (data) {\n\n                    // ignore a response if the select2 has been closed before it was received\n                    if (!self.opened()) return;\n\n\n                    self.opts.populateResults.call(this, results, data.results, {term: term, page: page, context:context});\n                    self.postprocessResults(data, false, false);\n\n                    if (data.more===true) {\n                        more.detach().appendTo(results).text(evaluate(self.opts.formatLoadMore, self.opts.element, page+1));\n                        window.setTimeout(function() { self.loadMoreIfNeeded(); }, 10);\n                    } else {\n                        more.remove();\n                    }\n                    self.positionDropdown();\n                    self.resultsPage = page;\n                    self.context = data.context;\n                    this.opts.element.trigger({ type: \"select2-loaded\", items: data });\n                })});\n            }\n        },\n\n        /**\n         * Default tokenizer function which does nothing\n         */\n        tokenize: function() {\n\n        },\n\n        /**\n         * @param initial whether or not this is the call to this method right after the dropdown has been opened\n         */\n        // abstract\n        updateResults: function (initial) {\n            var search = this.search,\n                results = this.results,\n                opts = this.opts,\n                data,\n                self = this,\n                input,\n                term = search.val(),\n                lastTerm = $.data(this.container, \"select2-last-term\"),\n                // sequence number used to drop out-of-order responses\n                queryNumber;\n\n            // prevent duplicate queries against the same term\n            if (initial !== true && lastTerm && equal(term, lastTerm)) return;\n\n            $.data(this.container, \"select2-last-term\", term);\n\n            // if the search is currently hidden we do not alter the results\n            if (initial !== true && (this.showSearchInput === false || !this.opened())) {\n                return;\n            }\n\n            function postRender() {\n                search.removeClass(\"select2-active\");\n                self.positionDropdown();\n                if (results.find('.select2-no-results,.select2-selection-limit,.select2-searching').length) {\n                    self.liveRegion.text(results.text());\n                }\n                else {\n                    self.liveRegion.text(self.opts.formatMatches(results.find('.select2-result-selectable').length));\n                }\n            }\n\n            function render(html) {\n                results.html(html);\n                postRender();\n            }\n\n            queryNumber = ++this.queryCount;\n\n            var maxSelSize = this.getMaximumSelectionSize();\n            if (maxSelSize >=1) {\n                data = this.data();\n                if ($.isArray(data) && data.length >= maxSelSize && checkFormatter(opts.formatSelectionTooBig, \"formatSelectionTooBig\")) {\n                    render(\"<li class='select2-selection-limit'>\" + evaluate(opts.formatSelectionTooBig, opts.element, maxSelSize) + \"</li>\");\n                    return;\n                }\n            }\n\n            if (search.val().length < opts.minimumInputLength) {\n                if (checkFormatter(opts.formatInputTooShort, \"formatInputTooShort\")) {\n                    render(\"<li class='select2-no-results'>\" + evaluate(opts.formatInputTooShort, opts.element, search.val(), opts.minimumInputLength) + \"</li>\");\n                } else {\n                    render(\"\");\n                }\n                if (initial && this.showSearch) this.showSearch(true);\n                return;\n            }\n\n            if (opts.maximumInputLength && search.val().length > opts.maximumInputLength) {\n                if (checkFormatter(opts.formatInputTooLong, \"formatInputTooLong\")) {\n                    render(\"<li class='select2-no-results'>\" + evaluate(opts.formatInputTooLong, opts.element, search.val(), opts.maximumInputLength) + \"</li>\");\n                } else {\n                    render(\"\");\n                }\n                return;\n            }\n\n            if (opts.formatSearching && this.findHighlightableChoices().length === 0) {\n                render(\"<li class='select2-searching'>\" + evaluate(opts.formatSearching, opts.element) + \"</li>\");\n            }\n\n            search.addClass(\"select2-active\");\n\n            this.removeHighlight();\n\n            // give the tokenizer a chance to pre-process the input\n            input = this.tokenize();\n            if (input != undefined && input != null) {\n                search.val(input);\n            }\n\n            this.resultsPage = 1;\n\n            opts.query({\n                element: opts.element,\n                    term: search.val(),\n                    page: this.resultsPage,\n                    context: null,\n                    matcher: opts.matcher,\n                    callback: this.bind(function (data) {\n                var def; // default choice\n\n                // ignore old responses\n                if (queryNumber != this.queryCount) {\n                  return;\n                }\n\n                // ignore a response if the select2 has been closed before it was received\n                if (!this.opened()) {\n                    this.search.removeClass(\"select2-active\");\n                    return;\n                }\n\n                // handle ajax error\n                if(data.hasError !== undefined && checkFormatter(opts.formatAjaxError, \"formatAjaxError\")) {\n                    render(\"<li class='select2-ajax-error'>\" + evaluate(opts.formatAjaxError, opts.element, data.jqXHR, data.textStatus, data.errorThrown) + \"</li>\");\n                    return;\n                }\n\n                // save context, if any\n                this.context = (data.context===undefined) ? null : data.context;\n                // create a default choice and prepend it to the list\n                if (this.opts.createSearchChoice && search.val() !== \"\") {\n                    def = this.opts.createSearchChoice.call(self, search.val(), data.results);\n                    if (def !== undefined && def !== null && self.id(def) !== undefined && self.id(def) !== null) {\n                        if ($(data.results).filter(\n                            function () {\n                                return equal(self.id(this), self.id(def));\n                            }).length === 0) {\n                            this.opts.createSearchChoicePosition(data.results, def);\n                        }\n                    }\n                }\n\n                if (data.results.length === 0 && checkFormatter(opts.formatNoMatches, \"formatNoMatches\")) {\n                    render(\"<li class='select2-no-results'>\" + evaluate(opts.formatNoMatches, opts.element, search.val()) + \"</li>\");\n                    return;\n                }\n\n                results.empty();\n                self.opts.populateResults.call(this, results, data.results, {term: search.val(), page: this.resultsPage, context:null});\n\n                if (data.more === true && checkFormatter(opts.formatLoadMore, \"formatLoadMore\")) {\n                    results.append(\"<li class='select2-more-results'>\" + opts.escapeMarkup(evaluate(opts.formatLoadMore, opts.element, this.resultsPage)) + \"</li>\");\n                    window.setTimeout(function() { self.loadMoreIfNeeded(); }, 10);\n                }\n\n                this.postprocessResults(data, initial);\n\n                postRender();\n\n                this.opts.element.trigger({ type: \"select2-loaded\", items: data });\n            })});\n        },\n\n        // abstract\n        cancel: function () {\n            this.close();\n        },\n\n        // abstract\n        blur: function () {\n            // if selectOnBlur == true, select the currently highlighted option\n            if (this.opts.selectOnBlur)\n                this.selectHighlighted({noFocus: true});\n\n            this.close();\n            this.container.removeClass(\"select2-container-active\");\n            // synonymous to .is(':focus'), which is available in jquery >= 1.6\n            if (this.search[0] === document.activeElement) { this.search.blur(); }\n            this.clearSearch();\n            this.selection.find(\".select2-search-choice-focus\").removeClass(\"select2-search-choice-focus\");\n        },\n\n        // abstract\n        focusSearch: function () {\n            focus(this.search);\n        },\n\n        // abstract\n        selectHighlighted: function (options) {\n            if (this._touchMoved) {\n              this.clearTouchMoved();\n              return;\n            }\n            var index=this.highlight(),\n                highlighted=this.results.find(\".select2-highlighted\"),\n                data = highlighted.closest('.select2-result').data(\"select2-data\");\n\n            if (data) {\n                this.highlight(index);\n                this.onSelect(data, options);\n            } else if (options && options.noFocus) {\n                this.close();\n            }\n        },\n\n        // abstract\n        getPlaceholder: function () {\n            var placeholderOption;\n            return this.opts.element.attr(\"placeholder\") ||\n                this.opts.element.attr(\"data-placeholder\") || // jquery 1.4 compat\n                this.opts.element.data(\"placeholder\") ||\n                this.opts.placeholder ||\n                ((placeholderOption = this.getPlaceholderOption()) !== undefined ? placeholderOption.text() : undefined);\n        },\n\n        // abstract\n        getPlaceholderOption: function() {\n            if (this.select) {\n                var firstOption = this.select.children('option').first();\n                if (this.opts.placeholderOption !== undefined ) {\n                    //Determine the placeholder option based on the specified placeholderOption setting\n                    return (this.opts.placeholderOption === \"first\" && firstOption) ||\n                           (typeof this.opts.placeholderOption === \"function\" && this.opts.placeholderOption(this.select));\n                } else if ($.trim(firstOption.text()) === \"\" && firstOption.val() === \"\") {\n                    //No explicit placeholder option specified, use the first if it's blank\n                    return firstOption;\n                }\n            }\n        },\n\n        /**\n         * Get the desired width for the container element.  This is\n         * derived first from option `width` passed to select2, then\n         * the inline 'style' on the original element, and finally\n         * falls back to the jQuery calculated element width.\n         */\n        // abstract\n        initContainerWidth: function () {\n            function resolveContainerWidth() {\n                var style, attrs, matches, i, l, attr;\n\n                if (this.opts.width === \"off\") {\n                    return null;\n                } else if (this.opts.width === \"element\"){\n                    return this.opts.element.outerWidth(false) === 0 ? 'auto' : this.opts.element.outerWidth(false) + 'px';\n                } else if (this.opts.width === \"copy\" || this.opts.width === \"resolve\") {\n                    // check if there is inline style on the element that contains width\n                    style = this.opts.element.attr('style');\n                    if (style !== undefined) {\n                        attrs = style.split(';');\n                        for (i = 0, l = attrs.length; i < l; i = i + 1) {\n                            attr = attrs[i].replace(/\\s/g, '');\n                            matches = attr.match(/^width:(([-+]?([0-9]*\\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i);\n                            if (matches !== null && matches.length >= 1)\n                                return matches[1];\n                        }\n                    }\n\n                    if (this.opts.width === \"resolve\") {\n                        // next check if css('width') can resolve a width that is percent based, this is sometimes possible\n                        // when attached to input type=hidden or elements hidden via css\n                        style = this.opts.element.css('width');\n                        if (style.indexOf(\"%\") > 0) return style;\n\n                        // finally, fallback on the calculated width of the element\n                        return (this.opts.element.outerWidth(false) === 0 ? 'auto' : this.opts.element.outerWidth(false) + 'px');\n                    }\n\n                    return null;\n                } else if ($.isFunction(this.opts.width)) {\n                    return this.opts.width();\n                } else {\n                    return this.opts.width;\n               }\n            };\n\n            var width = resolveContainerWidth.call(this);\n            if (width !== null) {\n                this.container.css(\"width\", width);\n            }\n        }\n    });\n\n    SingleSelect2 = clazz(AbstractSelect2, {\n\n        // single\n\n        createContainer: function () {\n            var container = $(document.createElement(\"div\")).attr({\n                \"class\": \"select2-container\"\n            }).html([\n                \"<a href='javascript:void(0)' class='select2-choice' tabindex='-1'>\",\n                \"   <span class='select2-chosen'>&#160;</span><abbr class='select2-search-choice-close'></abbr>\",\n                \"   <span class='select2-arrow' role='presentation'><b role='presentation'></b></span>\",\n                \"</a>\",\n                \"<label for='' class='select2-offscreen'></label>\",\n                \"<input class='select2-focusser select2-offscreen' type='text' aria-haspopup='true' role='button' />\",\n                \"<div class='select2-drop select2-display-none'>\",\n                \"   <div class='select2-search'>\",\n                \"       <label for='' class='select2-offscreen'></label>\",\n                \"       <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input' role='combobox' aria-expanded='true'\",\n                \"       aria-autocomplete='list' />\",\n                \"   </div>\",\n                \"   <ul class='select2-results' role='listbox'>\",\n                \"   </ul>\",\n                \"</div>\"].join(\"\"));\n            return container;\n        },\n\n        // single\n        enableInterface: function() {\n            if (this.parent.enableInterface.apply(this, arguments)) {\n                this.focusser.prop(\"disabled\", !this.isInterfaceEnabled());\n            }\n        },\n\n        // single\n        opening: function () {\n            var el, range, len;\n\n            if (this.opts.minimumResultsForSearch >= 0) {\n                this.showSearch(true);\n            }\n\n            this.parent.opening.apply(this, arguments);\n\n            if (this.showSearchInput !== false) {\n                // IE appends focusser.val() at the end of field :/ so we manually insert it at the beginning using a range\n                // all other browsers handle this just fine\n\n                this.search.val(this.focusser.val());\n            }\n            if (this.opts.shouldFocusInput(this)) {\n                this.search.focus();\n                // move the cursor to the end after focussing, otherwise it will be at the beginning and\n                // new text will appear *before* focusser.val()\n                el = this.search.get(0);\n                if (el.createTextRange) {\n                    range = el.createTextRange();\n                    range.collapse(false);\n                    range.select();\n                } else if (el.setSelectionRange) {\n                    len = this.search.val().length;\n                    el.setSelectionRange(len, len);\n                }\n            }\n\n            // initializes search's value with nextSearchTerm (if defined by user)\n            // ignore nextSearchTerm if the dropdown is opened by the user pressing a letter\n            if(this.search.val() === \"\") {\n                if(this.nextSearchTerm != undefined){\n                    this.search.val(this.nextSearchTerm);\n                    this.search.select();\n                }\n            }\n\n            this.focusser.prop(\"disabled\", true).val(\"\");\n            this.updateResults(true);\n            this.opts.element.trigger($.Event(\"select2-open\"));\n        },\n\n        // single\n        close: function () {\n            if (!this.opened()) return;\n            this.parent.close.apply(this, arguments);\n\n            this.focusser.prop(\"disabled\", false);\n\n            if (this.opts.shouldFocusInput(this)) {\n                this.focusser.focus();\n            }\n        },\n\n        // single\n        focus: function () {\n            if (this.opened()) {\n                this.close();\n            } else {\n                this.focusser.prop(\"disabled\", false);\n                if (this.opts.shouldFocusInput(this)) {\n                    this.focusser.focus();\n                }\n            }\n        },\n\n        // single\n        isFocused: function () {\n            return this.container.hasClass(\"select2-container-active\");\n        },\n\n        // single\n        cancel: function () {\n            this.parent.cancel.apply(this, arguments);\n            this.focusser.prop(\"disabled\", false);\n\n            if (this.opts.shouldFocusInput(this)) {\n                this.focusser.focus();\n            }\n        },\n\n        // single\n        destroy: function() {\n            $(\"label[for='\" + this.focusser.attr('id') + \"']\")\n                .attr('for', this.opts.element.attr(\"id\"));\n            this.parent.destroy.apply(this, arguments);\n\n            cleanupJQueryElements.call(this,\n                \"selection\",\n                \"focusser\"\n            );\n        },\n\n        // single\n        initContainer: function () {\n\n            var selection,\n                container = this.container,\n                dropdown = this.dropdown,\n                idSuffix = nextUid(),\n                elementLabel;\n\n            if (this.opts.minimumResultsForSearch < 0) {\n                this.showSearch(false);\n            } else {\n                this.showSearch(true);\n            }\n\n            this.selection = selection = container.find(\".select2-choice\");\n\n            this.focusser = container.find(\".select2-focusser\");\n\n            // add aria associations\n            selection.find(\".select2-chosen\").attr(\"id\", \"select2-chosen-\"+idSuffix);\n            this.focusser.attr(\"aria-labelledby\", \"select2-chosen-\"+idSuffix);\n            this.results.attr(\"id\", \"select2-results-\"+idSuffix);\n            this.search.attr(\"aria-owns\", \"select2-results-\"+idSuffix);\n\n            // rewrite labels from original element to focusser\n            this.focusser.attr(\"id\", \"s2id_autogen\"+idSuffix);\n\n            elementLabel = $(\"label[for='\" + this.opts.element.attr(\"id\") + \"']\");\n\n            this.focusser.prev()\n                .text(elementLabel.text())\n                .attr('for', this.focusser.attr('id'));\n\n            // Ensure the original element retains an accessible name\n            var originalTitle = this.opts.element.attr(\"title\");\n            this.opts.element.attr(\"title\", (originalTitle || elementLabel.text()));\n\n            this.focusser.attr(\"tabindex\", this.elementTabIndex);\n\n            // write label for search field using the label from the focusser element\n            this.search.attr(\"id\", this.focusser.attr('id') + '_search');\n\n            this.search.prev()\n                .text($(\"label[for='\" + this.focusser.attr('id') + \"']\").text())\n                .attr('for', this.search.attr('id'));\n\n            this.search.on(\"keydown\", this.bind(function (e) {\n                if (!this.isInterfaceEnabled()) return;\n\n                // filter 229 keyCodes (input method editor is processing key input)\n                if (229 == e.keyCode) return;\n\n                if (e.which === KEY.PAGE_UP || e.which === KEY.PAGE_DOWN) {\n                    // prevent the page from scrolling\n                    killEvent(e);\n                    return;\n                }\n\n                switch (e.which) {\n                    case KEY.UP:\n                    case KEY.DOWN:\n                        this.moveHighlight((e.which === KEY.UP) ? -1 : 1);\n                        killEvent(e);\n                        return;\n                    case KEY.ENTER:\n                        this.selectHighlighted();\n                        killEvent(e);\n                        return;\n                    case KEY.TAB:\n                        this.selectHighlighted({noFocus: true});\n                        return;\n                    case KEY.ESC:\n                        this.cancel(e);\n                        killEvent(e);\n                        return;\n                }\n            }));\n\n            this.search.on(\"blur\", this.bind(function(e) {\n                // a workaround for chrome to keep the search field focussed when the scroll bar is used to scroll the dropdown.\n                // without this the search field loses focus which is annoying\n                if (document.activeElement === this.body.get(0)) {\n                    window.setTimeout(this.bind(function() {\n                        if (this.opened()) {\n                            this.search.focus();\n                        }\n                    }), 0);\n                }\n            }));\n\n            this.focusser.on(\"keydown\", this.bind(function (e) {\n                if (!this.isInterfaceEnabled()) return;\n\n                if (e.which === KEY.TAB || KEY.isControl(e) || KEY.isFunctionKey(e) || e.which === KEY.ESC) {\n                    return;\n                }\n\n                if (this.opts.openOnEnter === false && e.which === KEY.ENTER) {\n                    killEvent(e);\n                    return;\n                }\n\n                if (e.which == KEY.DOWN || e.which == KEY.UP\n                    || (e.which == KEY.ENTER && this.opts.openOnEnter)) {\n\n                    if (e.altKey || e.ctrlKey || e.shiftKey || e.metaKey) return;\n\n                    this.open();\n                    killEvent(e);\n                    return;\n                }\n\n                if (e.which == KEY.DELETE || e.which == KEY.BACKSPACE) {\n                    if (this.opts.allowClear) {\n                        this.clear();\n                    }\n                    killEvent(e);\n                    return;\n                }\n            }));\n\n\n            installKeyUpChangeEvent(this.focusser);\n            this.focusser.on(\"keyup-change input\", this.bind(function(e) {\n                if (this.opts.minimumResultsForSearch >= 0) {\n                    e.stopPropagation();\n                    if (this.opened()) return;\n                    this.open();\n                }\n            }));\n\n            selection.on(\"mousedown touchstart\", \"abbr\", this.bind(function (e) {\n                if (!this.isInterfaceEnabled()) return;\n                this.clear();\n                killEventImmediately(e);\n                this.close();\n                this.selection.focus();\n            }));\n\n            selection.on(\"mousedown touchstart\", this.bind(function (e) {\n                // Prevent IE from generating a click event on the body\n                reinsertElement(selection);\n\n                if (!this.container.hasClass(\"select2-container-active\")) {\n                    this.opts.element.trigger($.Event(\"select2-focus\"));\n                }\n\n                if (this.opened()) {\n                    this.close();\n                } else if (this.isInterfaceEnabled()) {\n                    this.open();\n                }\n\n                killEvent(e);\n            }));\n\n            dropdown.on(\"mousedown touchstart\", this.bind(function() {\n                if (this.opts.shouldFocusInput(this)) {\n                    this.search.focus();\n                }\n            }));\n\n            selection.on(\"focus\", this.bind(function(e) {\n                killEvent(e);\n            }));\n\n            this.focusser.on(\"focus\", this.bind(function(){\n                if (!this.container.hasClass(\"select2-container-active\")) {\n                    this.opts.element.trigger($.Event(\"select2-focus\"));\n                }\n                this.container.addClass(\"select2-container-active\");\n            })).on(\"blur\", this.bind(function() {\n                if (!this.opened()) {\n                    this.container.removeClass(\"select2-container-active\");\n                    this.opts.element.trigger($.Event(\"select2-blur\"));\n                }\n            }));\n            this.search.on(\"focus\", this.bind(function(){\n                if (!this.container.hasClass(\"select2-container-active\")) {\n                    this.opts.element.trigger($.Event(\"select2-focus\"));\n                }\n                this.container.addClass(\"select2-container-active\");\n            }));\n\n            this.initContainerWidth();\n            this.opts.element.addClass(\"select2-offscreen\");\n            this.setPlaceholder();\n\n        },\n\n        // single\n        clear: function(triggerChange) {\n            var data=this.selection.data(\"select2-data\");\n            if (data) { // guard against queued quick consecutive clicks\n                var evt = $.Event(\"select2-clearing\");\n                this.opts.element.trigger(evt);\n                if (evt.isDefaultPrevented()) {\n                    return;\n                }\n                var placeholderOption = this.getPlaceholderOption();\n                this.opts.element.val(placeholderOption ? placeholderOption.val() : \"\");\n                this.selection.find(\".select2-chosen\").empty();\n                this.selection.removeData(\"select2-data\");\n                this.setPlaceholder();\n\n                if (triggerChange !== false){\n                    this.opts.element.trigger({ type: \"select2-removed\", val: this.id(data), choice: data });\n                    this.triggerChange({removed:data});\n                }\n            }\n        },\n\n        /**\n         * Sets selection based on source element's value\n         */\n        // single\n        initSelection: function () {\n            var selected;\n            if (this.isPlaceholderOptionSelected()) {\n                this.updateSelection(null);\n                this.close();\n                this.setPlaceholder();\n            } else {\n                var self = this;\n                this.opts.initSelection.call(null, this.opts.element, function(selected){\n                    if (selected !== undefined && selected !== null) {\n                        self.updateSelection(selected);\n                        self.close();\n                        self.setPlaceholder();\n                        self.nextSearchTerm = self.opts.nextSearchTerm(selected, self.search.val());\n                    }\n                });\n            }\n        },\n\n        isPlaceholderOptionSelected: function() {\n            var placeholderOption;\n            if (this.getPlaceholder() === undefined) return false; // no placeholder specified so no option should be considered\n            return ((placeholderOption = this.getPlaceholderOption()) !== undefined && placeholderOption.prop(\"selected\"))\n                || (this.opts.element.val() === \"\")\n                || (this.opts.element.val() === undefined)\n                || (this.opts.element.val() === null);\n        },\n\n        // single\n        prepareOpts: function () {\n            var opts = this.parent.prepareOpts.apply(this, arguments),\n                self=this;\n\n            if (opts.element.get(0).tagName.toLowerCase() === \"select\") {\n                // install the selection initializer\n                opts.initSelection = function (element, callback) {\n                    var selected = element.find(\"option\").filter(function() { return this.selected && !this.disabled });\n                    // a single select box always has a value, no need to null check 'selected'\n                    callback(self.optionToData(selected));\n                };\n            } else if (\"data\" in opts) {\n                // install default initSelection when applied to hidden input and data is local\n                opts.initSelection = opts.initSelection || function (element, callback) {\n                    var id = element.val();\n                    //search in data by id, storing the actual matching item\n                    var match = null;\n                    opts.query({\n                        matcher: function(term, text, el){\n                            var is_match = equal(id, opts.id(el));\n                            if (is_match) {\n                                match = el;\n                            }\n                            return is_match;\n                        },\n                        callback: !$.isFunction(callback) ? $.noop : function() {\n                            callback(match);\n                        }\n                    });\n                };\n            }\n\n            return opts;\n        },\n\n        // single\n        getPlaceholder: function() {\n            // if a placeholder is specified on a single select without a valid placeholder option ignore it\n            if (this.select) {\n                if (this.getPlaceholderOption() === undefined) {\n                    return undefined;\n                }\n            }\n\n            return this.parent.getPlaceholder.apply(this, arguments);\n        },\n\n        // single\n        setPlaceholder: function () {\n            var placeholder = this.getPlaceholder();\n\n            if (this.isPlaceholderOptionSelected() && placeholder !== undefined) {\n\n                // check for a placeholder option if attached to a select\n                if (this.select && this.getPlaceholderOption() === undefined) return;\n\n                this.selection.find(\".select2-chosen\").html(this.opts.escapeMarkup(placeholder));\n\n                this.selection.addClass(\"select2-default\");\n\n                this.container.removeClass(\"select2-allowclear\");\n            }\n        },\n\n        // single\n        postprocessResults: function (data, initial, noHighlightUpdate) {\n            var selected = 0, self = this, showSearchInput = true;\n\n            // find the selected element in the result list\n\n            this.findHighlightableChoices().each2(function (i, elm) {\n                if (equal(self.id(elm.data(\"select2-data\")), self.opts.element.val())) {\n                    selected = i;\n                    return false;\n                }\n            });\n\n            // and highlight it\n            if (noHighlightUpdate !== false) {\n                if (initial === true && selected >= 0) {\n                    this.highlight(selected);\n                } else {\n                    this.highlight(0);\n                }\n            }\n\n            // hide the search box if this is the first we got the results and there are enough of them for search\n\n            if (initial === true) {\n                var min = this.opts.minimumResultsForSearch;\n                if (min >= 0) {\n                    this.showSearch(countResults(data.results) >= min);\n                }\n            }\n        },\n\n        // single\n        showSearch: function(showSearchInput) {\n            if (this.showSearchInput === showSearchInput) return;\n\n            this.showSearchInput = showSearchInput;\n\n            this.dropdown.find(\".select2-search\").toggleClass(\"select2-search-hidden\", !showSearchInput);\n            this.dropdown.find(\".select2-search\").toggleClass(\"select2-offscreen\", !showSearchInput);\n            //add \"select2-with-searchbox\" to the container if search box is shown\n            $(this.dropdown, this.container).toggleClass(\"select2-with-searchbox\", showSearchInput);\n        },\n\n        // single\n        onSelect: function (data, options) {\n\n            if (!this.triggerSelect(data)) { return; }\n\n            var old = this.opts.element.val(),\n                oldData = this.data();\n\n            this.opts.element.val(this.id(data));\n            this.updateSelection(data);\n\n            this.opts.element.trigger({ type: \"select2-selected\", val: this.id(data), choice: data });\n\n            this.nextSearchTerm = this.opts.nextSearchTerm(data, this.search.val());\n            this.close();\n\n            if ((!options || !options.noFocus) && this.opts.shouldFocusInput(this)) {\n                this.focusser.focus();\n            }\n\n            if (!equal(old, this.id(data))) {\n                this.triggerChange({ added: data, removed: oldData });\n            }\n        },\n\n        // single\n        updateSelection: function (data) {\n\n            var container=this.selection.find(\".select2-chosen\"), formatted, cssClass;\n\n            this.selection.data(\"select2-data\", data);\n\n            container.empty();\n            if (data !== null) {\n                formatted=this.opts.formatSelection(data, container, this.opts.escapeMarkup);\n            }\n            if (formatted !== undefined) {\n                container.append(formatted);\n            }\n            cssClass=this.opts.formatSelectionCssClass(data, container);\n            if (cssClass !== undefined) {\n                container.addClass(cssClass);\n            }\n\n            this.selection.removeClass(\"select2-default\");\n\n            if (this.opts.allowClear && this.getPlaceholder() !== undefined) {\n                this.container.addClass(\"select2-allowclear\");\n            }\n        },\n\n        // single\n        val: function () {\n            var val,\n                triggerChange = false,\n                data = null,\n                self = this,\n                oldData = this.data();\n\n            if (arguments.length === 0) {\n                return this.opts.element.val();\n            }\n\n            val = arguments[0];\n\n            if (arguments.length > 1) {\n                triggerChange = arguments[1];\n            }\n\n            if (this.select) {\n                this.select\n                    .val(val)\n                    .find(\"option\").filter(function() { return this.selected }).each2(function (i, elm) {\n                        data = self.optionToData(elm);\n                        return false;\n                    });\n                this.updateSelection(data);\n                this.setPlaceholder();\n                if (triggerChange) {\n                    this.triggerChange({added: data, removed:oldData});\n                }\n            } else {\n                // val is an id. !val is true for [undefined,null,'',0] - 0 is legal\n                if (!val && val !== 0) {\n                    this.clear(triggerChange);\n                    return;\n                }\n                if (this.opts.initSelection === undefined) {\n                    throw new Error(\"cannot call val() if initSelection() is not defined\");\n                }\n                this.opts.element.val(val);\n                this.opts.initSelection(this.opts.element, function(data){\n                    self.opts.element.val(!data ? \"\" : self.id(data));\n                    self.updateSelection(data);\n                    self.setPlaceholder();\n                    if (triggerChange) {\n                        self.triggerChange({added: data, removed:oldData});\n                    }\n                });\n            }\n        },\n\n        // single\n        clearSearch: function () {\n            this.search.val(\"\");\n            this.focusser.val(\"\");\n        },\n\n        // single\n        data: function(value) {\n            var data,\n                triggerChange = false;\n\n            if (arguments.length === 0) {\n                data = this.selection.data(\"select2-data\");\n                if (data == undefined) data = null;\n                return data;\n            } else {\n                if (arguments.length > 1) {\n                    triggerChange = arguments[1];\n                }\n                if (!value) {\n                    this.clear(triggerChange);\n                } else {\n                    data = this.data();\n                    this.opts.element.val(!value ? \"\" : this.id(value));\n                    this.updateSelection(value);\n                    if (triggerChange) {\n                        this.triggerChange({added: value, removed:data});\n                    }\n                }\n            }\n        }\n    });\n\n    MultiSelect2 = clazz(AbstractSelect2, {\n\n        // multi\n        createContainer: function () {\n            var container = $(document.createElement(\"div\")).attr({\n                \"class\": \"select2-container select2-container-multi\"\n            }).html([\n                \"<ul class='select2-choices'>\",\n                \"  <li class='select2-search-field'>\",\n                \"    <label for='' class='select2-offscreen'></label>\",\n                \"    <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input'>\",\n                \"  </li>\",\n                \"</ul>\",\n                \"<div class='select2-drop select2-drop-multi select2-display-none'>\",\n                \"   <ul class='select2-results'>\",\n                \"   </ul>\",\n                \"</div>\"].join(\"\"));\n            return container;\n        },\n\n        // multi\n        prepareOpts: function () {\n            var opts = this.parent.prepareOpts.apply(this, arguments),\n                self=this;\n\n            // TODO validate placeholder is a string if specified\n\n            if (opts.element.get(0).tagName.toLowerCase() === \"select\") {\n                // install the selection initializer\n                opts.initSelection = function (element, callback) {\n\n                    var data = [];\n\n                    element.find(\"option\").filter(function() { return this.selected && !this.disabled }).each2(function (i, elm) {\n                        data.push(self.optionToData(elm));\n                    });\n                    callback(data);\n                };\n            } else if (\"data\" in opts) {\n                // install default initSelection when applied to hidden input and data is local\n                opts.initSelection = opts.initSelection || function (element, callback) {\n                    var ids = splitVal(element.val(), opts.separator);\n                    //search in data by array of ids, storing matching items in a list\n                    var matches = [];\n                    opts.query({\n                        matcher: function(term, text, el){\n                            var is_match = $.grep(ids, function(id) {\n                                return equal(id, opts.id(el));\n                            }).length;\n                            if (is_match) {\n                                matches.push(el);\n                            }\n                            return is_match;\n                        },\n                        callback: !$.isFunction(callback) ? $.noop : function() {\n                            // reorder matches based on the order they appear in the ids array because right now\n                            // they are in the order in which they appear in data array\n                            var ordered = [];\n                            for (var i = 0; i < ids.length; i++) {\n                                var id = ids[i];\n                                for (var j = 0; j < matches.length; j++) {\n                                    var match = matches[j];\n                                    if (equal(id, opts.id(match))) {\n                                        ordered.push(match);\n                                        matches.splice(j, 1);\n                                        break;\n                                    }\n                                }\n                            }\n                            callback(ordered);\n                        }\n                    });\n                };\n            }\n\n            return opts;\n        },\n\n        // multi\n        selectChoice: function (choice) {\n\n            var selected = this.container.find(\".select2-search-choice-focus\");\n            if (selected.length && choice && choice[0] == selected[0]) {\n\n            } else {\n                if (selected.length) {\n                    this.opts.element.trigger(\"choice-deselected\", selected);\n                }\n                selected.removeClass(\"select2-search-choice-focus\");\n                if (choice && choice.length) {\n                    this.close();\n                    choice.addClass(\"select2-search-choice-focus\");\n                    this.opts.element.trigger(\"choice-selected\", choice);\n                }\n            }\n        },\n\n        // multi\n        destroy: function() {\n            $(\"label[for='\" + this.search.attr('id') + \"']\")\n                .attr('for', this.opts.element.attr(\"id\"));\n            this.parent.destroy.apply(this, arguments);\n\n            cleanupJQueryElements.call(this,\n                \"searchContainer\",\n                \"selection\"\n            );\n        },\n\n        // multi\n        initContainer: function () {\n\n            var selector = \".select2-choices\", selection;\n\n            this.searchContainer = this.container.find(\".select2-search-field\");\n            this.selection = selection = this.container.find(selector);\n\n            var _this = this;\n            this.selection.on(\"click\", \".select2-search-choice:not(.select2-locked)\", function (e) {\n                //killEvent(e);\n                _this.search[0].focus();\n                _this.selectChoice($(this));\n            });\n\n            // rewrite labels from original element to focusser\n            this.search.attr(\"id\", \"s2id_autogen\"+nextUid());\n\n            this.search.prev()\n                .text($(\"label[for='\" + this.opts.element.attr(\"id\") + \"']\").text())\n                .attr('for', this.search.attr('id'));\n\n            this.search.on(\"input paste\", this.bind(function() {\n                if (this.search.attr('placeholder') && this.search.val().length == 0) return;\n                if (!this.isInterfaceEnabled()) return;\n                if (!this.opened()) {\n                    this.open();\n                }\n            }));\n\n            this.search.attr(\"tabindex\", this.elementTabIndex);\n\n            this.keydowns = 0;\n            this.search.on(\"keydown\", this.bind(function (e) {\n                if (!this.isInterfaceEnabled()) return;\n\n                ++this.keydowns;\n                var selected = selection.find(\".select2-search-choice-focus\");\n                var prev = selected.prev(\".select2-search-choice:not(.select2-locked)\");\n                var next = selected.next(\".select2-search-choice:not(.select2-locked)\");\n                var pos = getCursorInfo(this.search);\n\n                if (selected.length &&\n                    (e.which == KEY.LEFT || e.which == KEY.RIGHT || e.which == KEY.BACKSPACE || e.which == KEY.DELETE || e.which == KEY.ENTER)) {\n                    var selectedChoice = selected;\n                    if (e.which == KEY.LEFT && prev.length) {\n                        selectedChoice = prev;\n                    }\n                    else if (e.which == KEY.RIGHT) {\n                        selectedChoice = next.length ? next : null;\n                    }\n                    else if (e.which === KEY.BACKSPACE) {\n                        if (this.unselect(selected.first())) {\n                            this.search.width(10);\n                            selectedChoice = prev.length ? prev : next;\n                        }\n                    } else if (e.which == KEY.DELETE) {\n                        if (this.unselect(selected.first())) {\n                            this.search.width(10);\n                            selectedChoice = next.length ? next : null;\n                        }\n                    } else if (e.which == KEY.ENTER) {\n                        selectedChoice = null;\n                    }\n\n                    this.selectChoice(selectedChoice);\n                    killEvent(e);\n                    if (!selectedChoice || !selectedChoice.length) {\n                        this.open();\n                    }\n                    return;\n                } else if (((e.which === KEY.BACKSPACE && this.keydowns == 1)\n                    || e.which == KEY.LEFT) && (pos.offset == 0 && !pos.length)) {\n\n                    this.selectChoice(selection.find(\".select2-search-choice:not(.select2-locked)\").last());\n                    killEvent(e);\n                    return;\n                } else {\n                    this.selectChoice(null);\n                }\n\n                if (this.opened()) {\n                    switch (e.which) {\n                    case KEY.UP:\n                    case KEY.DOWN:\n                        this.moveHighlight((e.which === KEY.UP) ? -1 : 1);\n                        killEvent(e);\n                        return;\n                    case KEY.ENTER:\n                        this.selectHighlighted();\n                        killEvent(e);\n                        return;\n                    case KEY.TAB:\n                        this.selectHighlighted({noFocus:true});\n                        this.close();\n                        return;\n                    case KEY.ESC:\n                        this.cancel(e);\n                        killEvent(e);\n                        return;\n                    }\n                }\n\n                if (e.which === KEY.TAB || KEY.isControl(e) || KEY.isFunctionKey(e)\n                 || e.which === KEY.BACKSPACE || e.which === KEY.ESC) {\n                    return;\n                }\n\n                if (e.which === KEY.ENTER) {\n                    if (this.opts.openOnEnter === false) {\n                        return;\n                    } else if (e.altKey || e.ctrlKey || e.shiftKey || e.metaKey) {\n                        return;\n                    }\n                }\n\n                this.open();\n\n                if (e.which === KEY.PAGE_UP || e.which === KEY.PAGE_DOWN) {\n                    // prevent the page from scrolling\n                    killEvent(e);\n                }\n\n                if (e.which === KEY.ENTER) {\n                    // prevent form from being submitted\n                    killEvent(e);\n                }\n\n            }));\n\n            this.search.on(\"keyup\", this.bind(function (e) {\n                this.keydowns = 0;\n                this.resizeSearch();\n            })\n            );\n\n            this.search.on(\"blur\", this.bind(function(e) {\n                this.container.removeClass(\"select2-container-active\");\n                this.search.removeClass(\"select2-focused\");\n                this.selectChoice(null);\n                if (!this.opened()) this.clearSearch();\n                e.stopImmediatePropagation();\n                this.opts.element.trigger($.Event(\"select2-blur\"));\n            }));\n\n            this.container.on(\"click\", selector, this.bind(function (e) {\n                if (!this.isInterfaceEnabled()) return;\n                if ($(e.target).closest(\".select2-search-choice\").length > 0) {\n                    // clicked inside a select2 search choice, do not open\n                    return;\n                }\n                this.selectChoice(null);\n                this.clearPlaceholder();\n                if (!this.container.hasClass(\"select2-container-active\")) {\n                    this.opts.element.trigger($.Event(\"select2-focus\"));\n                }\n                this.open();\n                this.focusSearch();\n                e.preventDefault();\n            }));\n\n            this.container.on(\"focus\", selector, this.bind(function () {\n                if (!this.isInterfaceEnabled()) return;\n                if (!this.container.hasClass(\"select2-container-active\")) {\n                    this.opts.element.trigger($.Event(\"select2-focus\"));\n                }\n                this.container.addClass(\"select2-container-active\");\n                this.dropdown.addClass(\"select2-drop-active\");\n                this.clearPlaceholder();\n            }));\n\n            this.initContainerWidth();\n            this.opts.element.addClass(\"select2-offscreen\");\n\n            // set the placeholder if necessary\n            this.clearSearch();\n        },\n\n        // multi\n        enableInterface: function() {\n            if (this.parent.enableInterface.apply(this, arguments)) {\n                this.search.prop(\"disabled\", !this.isInterfaceEnabled());\n            }\n        },\n\n        // multi\n        initSelection: function () {\n            var data;\n            if (this.opts.element.val() === \"\" && this.opts.element.text() === \"\") {\n                this.updateSelection([]);\n                this.close();\n                // set the placeholder if necessary\n                this.clearSearch();\n            }\n            if (this.select || this.opts.element.val() !== \"\") {\n                var self = this;\n                this.opts.initSelection.call(null, this.opts.element, function(data){\n                    if (data !== undefined && data !== null) {\n                        self.updateSelection(data);\n                        self.close();\n                        // set the placeholder if necessary\n                        self.clearSearch();\n                    }\n                });\n            }\n        },\n\n        // multi\n        clearSearch: function () {\n            var placeholder = this.getPlaceholder(),\n                maxWidth = this.getMaxSearchWidth();\n\n            if (placeholder !== undefined  && this.getVal().length === 0 && this.search.hasClass(\"select2-focused\") === false) {\n                this.search.val(placeholder).addClass(\"select2-default\");\n                // stretch the search box to full width of the container so as much of the placeholder is visible as possible\n                // we could call this.resizeSearch(), but we do not because that requires a sizer and we do not want to create one so early because of a firefox bug, see #944\n                this.search.width(maxWidth > 0 ? maxWidth : this.container.css(\"width\"));\n            } else {\n                this.search.val(\"\").width(10);\n            }\n        },\n\n        // multi\n        clearPlaceholder: function () {\n            if (this.search.hasClass(\"select2-default\")) {\n                this.search.val(\"\").removeClass(\"select2-default\");\n            }\n        },\n\n        // multi\n        opening: function () {\n            this.clearPlaceholder(); // should be done before super so placeholder is not used to search\n            this.resizeSearch();\n\n            this.parent.opening.apply(this, arguments);\n\n            this.focusSearch();\n\n            // initializes search's value with nextSearchTerm (if defined by user)\n            // ignore nextSearchTerm if the dropdown is opened by the user pressing a letter\n            if(this.search.val() === \"\") {\n                if(this.nextSearchTerm != undefined){\n                    this.search.val(this.nextSearchTerm);\n                    this.search.select();\n                }\n            }\n\n            this.updateResults(true);\n            if (this.opts.shouldFocusInput(this)) {\n                this.search.focus();\n            }\n            this.opts.element.trigger($.Event(\"select2-open\"));\n        },\n\n        // multi\n        close: function () {\n            if (!this.opened()) return;\n            this.parent.close.apply(this, arguments);\n        },\n\n        // multi\n        focus: function () {\n            this.close();\n            this.search.focus();\n        },\n\n        // multi\n        isFocused: function () {\n            return this.search.hasClass(\"select2-focused\");\n        },\n\n        // multi\n        updateSelection: function (data) {\n            var ids = [], filtered = [], self = this;\n\n            // filter out duplicates\n            $(data).each(function () {\n                if (indexOf(self.id(this), ids) < 0) {\n                    ids.push(self.id(this));\n                    filtered.push(this);\n                }\n            });\n            data = filtered;\n\n            this.selection.find(\".select2-search-choice\").remove();\n            $(data).each(function () {\n                self.addSelectedChoice(this);\n            });\n            self.postprocessResults();\n        },\n\n        // multi\n        tokenize: function() {\n            var input = this.search.val();\n            input = this.opts.tokenizer.call(this, input, this.data(), this.bind(this.onSelect), this.opts);\n            if (input != null && input != undefined) {\n                this.search.val(input);\n                if (input.length > 0) {\n                    this.open();\n                }\n            }\n\n        },\n\n        // multi\n        onSelect: function (data, options) {\n\n            if (!this.triggerSelect(data) || data.text === \"\") { return; }\n\n            this.addSelectedChoice(data);\n\n            this.opts.element.trigger({ type: \"selected\", val: this.id(data), choice: data });\n\n            // keep track of the search's value before it gets cleared\n            this.nextSearchTerm = this.opts.nextSearchTerm(data, this.search.val());\n\n            this.clearSearch();\n            this.updateResults();\n\n            if (this.select || !this.opts.closeOnSelect) this.postprocessResults(data, false, this.opts.closeOnSelect===true);\n\n            if (this.opts.closeOnSelect) {\n                this.close();\n                this.search.width(10);\n            } else {\n                if (this.countSelectableResults()>0) {\n                    this.search.width(10);\n                    this.resizeSearch();\n                    if (this.getMaximumSelectionSize() > 0 && this.val().length >= this.getMaximumSelectionSize()) {\n                        // if we reached max selection size repaint the results so choices\n                        // are replaced with the max selection reached message\n                        this.updateResults(true);\n                    } else {\n                        // initializes search's value with nextSearchTerm and update search result\n                        if(this.nextSearchTerm != undefined){\n                            this.search.val(this.nextSearchTerm);\n                            this.updateResults();\n                            this.search.select();\n                        }\n                    }\n                    this.positionDropdown();\n                } else {\n                    // if nothing left to select close\n                    this.close();\n                    this.search.width(10);\n                }\n            }\n\n            // since its not possible to select an element that has already been\n            // added we do not need to check if this is a new element before firing change\n            this.triggerChange({ added: data });\n\n            if (!options || !options.noFocus)\n                this.focusSearch();\n        },\n\n        // multi\n        cancel: function () {\n            this.close();\n            this.focusSearch();\n        },\n\n        addSelectedChoice: function (data) {\n            var enableChoice = !data.locked,\n                enabledItem = $(\n                    \"<li class='select2-search-choice'>\" +\n                    \"    <div></div>\" +\n                    \"    <a href='#' class='select2-search-choice-close' tabindex='-1'></a>\" +\n                    \"</li>\"),\n                disabledItem = $(\n                    \"<li class='select2-search-choice select2-locked'>\" +\n                    \"<div></div>\" +\n                    \"</li>\");\n            var choice = enableChoice ? enabledItem : disabledItem,\n                id = this.id(data),\n                val = this.getVal(),\n                formatted,\n                cssClass;\n\n            formatted=this.opts.formatSelection(data, choice.find(\"div\"), this.opts.escapeMarkup);\n            if (formatted != undefined) {\n                choice.find(\"div\").replaceWith(\"<div>\"+formatted+\"</div>\");\n            }\n            cssClass=this.opts.formatSelectionCssClass(data, choice.find(\"div\"));\n            if (cssClass != undefined) {\n                choice.addClass(cssClass);\n            }\n\n            if(enableChoice){\n              choice.find(\".select2-search-choice-close\")\n                  .on(\"mousedown\", killEvent)\n                  .on(\"click dblclick\", this.bind(function (e) {\n                  if (!this.isInterfaceEnabled()) return;\n\n                  this.unselect($(e.target));\n                  this.selection.find(\".select2-search-choice-focus\").removeClass(\"select2-search-choice-focus\");\n                  killEvent(e);\n                  this.close();\n                  this.focusSearch();\n              })).on(\"focus\", this.bind(function () {\n                  if (!this.isInterfaceEnabled()) return;\n                  this.container.addClass(\"select2-container-active\");\n                  this.dropdown.addClass(\"select2-drop-active\");\n              }));\n            }\n\n            choice.data(\"select2-data\", data);\n            choice.insertBefore(this.searchContainer);\n\n            val.push(id);\n            this.setVal(val);\n        },\n\n        // multi\n        unselect: function (selected) {\n            var val = this.getVal(),\n                data,\n                index;\n            selected = selected.closest(\".select2-search-choice\");\n\n            if (selected.length === 0) {\n                throw \"Invalid argument: \" + selected + \". Must be .select2-search-choice\";\n            }\n\n            data = selected.data(\"select2-data\");\n\n            if (!data) {\n                // prevent a race condition when the 'x' is clicked really fast repeatedly the event can be queued\n                // and invoked on an element already removed\n                return;\n            }\n\n            var evt = $.Event(\"select2-removing\");\n            evt.val = this.id(data);\n            evt.choice = data;\n            this.opts.element.trigger(evt);\n\n            if (evt.isDefaultPrevented()) {\n                return false;\n            }\n\n            while((index = indexOf(this.id(data), val)) >= 0) {\n                val.splice(index, 1);\n                this.setVal(val);\n                if (this.select) this.postprocessResults();\n            }\n\n            selected.remove();\n\n            this.opts.element.trigger({ type: \"select2-removed\", val: this.id(data), choice: data });\n            this.triggerChange({ removed: data });\n\n            return true;\n        },\n\n        // multi\n        postprocessResults: function (data, initial, noHighlightUpdate) {\n            var val = this.getVal(),\n                choices = this.results.find(\".select2-result\"),\n                compound = this.results.find(\".select2-result-with-children\"),\n                self = this;\n\n            choices.each2(function (i, choice) {\n                var id = self.id(choice.data(\"select2-data\"));\n                if (indexOf(id, val) >= 0) {\n                    choice.addClass(\"select2-selected\");\n                    // mark all children of the selected parent as selected\n                    choice.find(\".select2-result-selectable\").addClass(\"select2-selected\");\n                }\n            });\n\n            compound.each2(function(i, choice) {\n                // hide an optgroup if it doesn't have any selectable children\n                if (!choice.is('.select2-result-selectable')\n                    && choice.find(\".select2-result-selectable:not(.select2-selected)\").length === 0) {\n                    choice.addClass(\"select2-selected\");\n                }\n            });\n\n            if (this.highlight() == -1 && noHighlightUpdate !== false){\n                self.highlight(0);\n            }\n\n            //If all results are chosen render formatNoMatches\n            if(!this.opts.createSearchChoice && !choices.filter('.select2-result:not(.select2-selected)').length > 0){\n                if(!data || data && !data.more && this.results.find(\".select2-no-results\").length === 0) {\n                    if (checkFormatter(self.opts.formatNoMatches, \"formatNoMatches\")) {\n                        this.results.append(\"<li class='select2-no-results'>\" + evaluate(self.opts.formatNoMatches, self.opts.element, self.search.val()) + \"</li>\");\n                    }\n                }\n            }\n\n        },\n\n        // multi\n        getMaxSearchWidth: function() {\n            return this.selection.width() - getSideBorderPadding(this.search);\n        },\n\n        // multi\n        resizeSearch: function () {\n            var minimumWidth, left, maxWidth, containerLeft, searchWidth,\n                sideBorderPadding = getSideBorderPadding(this.search);\n\n            minimumWidth = measureTextWidth(this.search) + 10;\n\n            left = this.search.offset().left;\n\n            maxWidth = this.selection.width();\n            containerLeft = this.selection.offset().left;\n\n            searchWidth = maxWidth - (left - containerLeft) - sideBorderPadding;\n\n            if (searchWidth < minimumWidth) {\n                searchWidth = maxWidth - sideBorderPadding;\n            }\n\n            if (searchWidth < 40) {\n                searchWidth = maxWidth - sideBorderPadding;\n            }\n\n            if (searchWidth <= 0) {\n              searchWidth = minimumWidth;\n            }\n\n            this.search.width(Math.floor(searchWidth));\n        },\n\n        // multi\n        getVal: function () {\n            var val;\n            if (this.select) {\n                val = this.select.val();\n                return val === null ? [] : val;\n            } else {\n                val = this.opts.element.val();\n                return splitVal(val, this.opts.separator);\n            }\n        },\n\n        // multi\n        setVal: function (val) {\n            var unique;\n            if (this.select) {\n                this.select.val(val);\n            } else {\n                unique = [];\n                // filter out duplicates\n                $(val).each(function () {\n                    if (indexOf(this, unique) < 0) unique.push(this);\n                });\n                this.opts.element.val(unique.length === 0 ? \"\" : unique.join(this.opts.separator));\n            }\n        },\n\n        // multi\n        buildChangeDetails: function (old, current) {\n            var current = current.slice(0),\n                old = old.slice(0);\n\n            // remove intersection from each array\n            for (var i = 0; i < current.length; i++) {\n                for (var j = 0; j < old.length; j++) {\n                    if (equal(this.opts.id(current[i]), this.opts.id(old[j]))) {\n                        current.splice(i, 1);\n                        if(i>0){\n                        \ti--;\n                        }\n                        old.splice(j, 1);\n                        j--;\n                    }\n                }\n            }\n\n            return {added: current, removed: old};\n        },\n\n\n        // multi\n        val: function (val, triggerChange) {\n            var oldData, self=this;\n\n            if (arguments.length === 0) {\n                return this.getVal();\n            }\n\n            oldData=this.data();\n            if (!oldData.length) oldData=[];\n\n            // val is an id. !val is true for [undefined,null,'',0] - 0 is legal\n            if (!val && val !== 0) {\n                this.opts.element.val(\"\");\n                this.updateSelection([]);\n                this.clearSearch();\n                if (triggerChange) {\n                    this.triggerChange({added: this.data(), removed: oldData});\n                }\n                return;\n            }\n\n            // val is a list of ids\n            this.setVal(val);\n\n            if (this.select) {\n                this.opts.initSelection(this.select, this.bind(this.updateSelection));\n                if (triggerChange) {\n                    this.triggerChange(this.buildChangeDetails(oldData, this.data()));\n                }\n            } else {\n                if (this.opts.initSelection === undefined) {\n                    throw new Error(\"val() cannot be called if initSelection() is not defined\");\n                }\n\n                this.opts.initSelection(this.opts.element, function(data){\n                    var ids=$.map(data, self.id);\n                    self.setVal(ids);\n                    self.updateSelection(data);\n                    self.clearSearch();\n                    if (triggerChange) {\n                        self.triggerChange(self.buildChangeDetails(oldData, self.data()));\n                    }\n                });\n            }\n            this.clearSearch();\n        },\n\n        // multi\n        onSortStart: function() {\n            if (this.select) {\n                throw new Error(\"Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.\");\n            }\n\n            // collapse search field into 0 width so its container can be collapsed as well\n            this.search.width(0);\n            // hide the container\n            this.searchContainer.hide();\n        },\n\n        // multi\n        onSortEnd:function() {\n\n            var val=[], self=this;\n\n            // show search and move it to the end of the list\n            this.searchContainer.show();\n            // make sure the search container is the last item in the list\n            this.searchContainer.appendTo(this.searchContainer.parent());\n            // since we collapsed the width in dragStarted, we resize it here\n            this.resizeSearch();\n\n            // update selection\n            this.selection.find(\".select2-search-choice\").each(function() {\n                val.push(self.opts.id($(this).data(\"select2-data\")));\n            });\n            this.setVal(val);\n            this.triggerChange();\n        },\n\n        // multi\n        data: function(values, triggerChange) {\n            var self=this, ids, old;\n            if (arguments.length === 0) {\n                 return this.selection\n                     .children(\".select2-search-choice\")\n                     .map(function() { return $(this).data(\"select2-data\"); })\n                     .get();\n            } else {\n                old = this.data();\n                if (!values) { values = []; }\n                ids = $.map(values, function(e) { return self.opts.id(e); });\n                this.setVal(ids);\n                this.updateSelection(values);\n                this.clearSearch();\n                if (triggerChange) {\n                    this.triggerChange(this.buildChangeDetails(old, this.data()));\n                }\n            }\n        }\n    });\n\n    $.fn.select2 = function () {\n\n        var args = Array.prototype.slice.call(arguments, 0),\n            opts,\n            select2,\n            method, value, multiple,\n            allowedMethods = [\"val\", \"destroy\", \"opened\", \"open\", \"close\", \"focus\", \"isFocused\", \"container\", \"dropdown\", \"onSortStart\", \"onSortEnd\", \"enable\", \"disable\", \"readonly\", \"positionDropdown\", \"data\", \"search\"],\n            valueMethods = [\"opened\", \"isFocused\", \"container\", \"dropdown\"],\n            propertyMethods = [\"val\", \"data\"],\n            methodsMap = { search: \"externalSearch\" };\n\n        this.each(function () {\n            if (args.length === 0 || typeof(args[0]) === \"object\") {\n                opts = args.length === 0 ? {} : $.extend({}, args[0]);\n                opts.element = $(this);\n\n                if (opts.element.get(0).tagName.toLowerCase() === \"select\") {\n                    multiple = opts.element.prop(\"multiple\");\n                } else {\n                    multiple = opts.multiple || false;\n                    if (\"tags\" in opts) {opts.multiple = multiple = true;}\n                }\n\n                select2 = multiple ? new window.Select2[\"class\"].multi() : new window.Select2[\"class\"].single();\n                select2.init(opts);\n            } else if (typeof(args[0]) === \"string\") {\n\n                if (indexOf(args[0], allowedMethods) < 0) {\n                    throw \"Unknown method: \" + args[0];\n                }\n\n                value = undefined;\n                select2 = $(this).data(\"select2\");\n                if (select2 === undefined) return;\n\n                method=args[0];\n\n                if (method === \"container\") {\n                    value = select2.container;\n                } else if (method === \"dropdown\") {\n                    value = select2.dropdown;\n                } else {\n                    if (methodsMap[method]) method = methodsMap[method];\n\n                    value = select2[method].apply(select2, args.slice(1));\n                }\n                if (indexOf(args[0], valueMethods) >= 0\n                    || (indexOf(args[0], propertyMethods) >= 0 && args.length == 1)) {\n                    return false; // abort the iteration, ready to return first matched value\n                }\n            } else {\n                throw \"Invalid arguments to select2 plugin: \" + args;\n            }\n        });\n        return (value === undefined) ? this : value;\n    };\n\n    // plugin defaults, accessible to users\n    $.fn.select2.defaults = {\n        width: \"copy\",\n        loadMorePadding: 0,\n        closeOnSelect: true,\n        openOnEnter: true,\n        containerCss: {},\n        dropdownCss: {},\n        containerCssClass: \"\",\n        dropdownCssClass: \"\",\n        formatResult: function(result, container, query, escapeMarkup) {\n            var markup=[];\n            markMatch(result.text, query.term, markup, escapeMarkup);\n            return markup.join(\"\");\n        },\n        formatSelection: function (data, container, escapeMarkup) {\n            return data ? escapeMarkup(data.text) : undefined;\n        },\n        sortResults: function (results, container, query) {\n            return results;\n        },\n        formatResultCssClass: function(data) {return data.css;},\n        formatSelectionCssClass: function(data, container) {return undefined;},\n        minimumResultsForSearch: 0,\n        minimumInputLength: 0,\n        maximumInputLength: null,\n        maximumSelectionSize: 0,\n        id: function (e) { return e == undefined ? null : e.id; },\n        matcher: function(term, text) {\n            return stripDiacritics(''+text).toUpperCase().indexOf(stripDiacritics(''+term).toUpperCase()) >= 0;\n        },\n        separator: \",\",\n        tokenSeparators: [],\n        tokenizer: defaultTokenizer,\n        escapeMarkup: defaultEscapeMarkup,\n        blurOnChange: false,\n        selectOnBlur: false,\n        adaptContainerCssClass: function(c) { return c; },\n        adaptDropdownCssClass: function(c) { return null; },\n        nextSearchTerm: function(selectedObject, currentSearchTerm) { return undefined; },\n        searchInputPlaceholder: '',\n        createSearchChoicePosition: 'top',\n        shouldFocusInput: function (instance) {\n            // Attempt to detect touch devices\n            var supportsTouchEvents = (('ontouchstart' in window) ||\n                                       (navigator.msMaxTouchPoints > 0));\n\n            // Only devices which support touch events should be special cased\n            if (!supportsTouchEvents) {\n                return true;\n            }\n\n            // Never focus the input if search is disabled\n            if (instance.opts.minimumResultsForSearch < 0) {\n                return false;\n            }\n\n            return true;\n        }\n    };\n\n    $.fn.select2.locales = [];\n\n    $.fn.select2.locales['en'] = {\n         formatMatches: function (matches) { if (matches === 1) { return \"One result is available, press enter to select it.\"; } return matches + \" results are available, use up and down arrow keys to navigate.\"; },\n         formatNoMatches: function () { return \"No matches found\"; },\n         formatAjaxError: function (jqXHR, textStatus, errorThrown) { return \"Loading failed\"; },\n         formatInputTooShort: function (input, min) { var n = min - input.length; return \"Please enter \" + n + \" or more character\" + (n == 1 ? \"\" : \"s\"); },\n         formatInputTooLong: function (input, max) { var n = input.length - max; return \"Please delete \" + n + \" character\" + (n == 1 ? \"\" : \"s\"); },\n         formatSelectionTooBig: function (limit) { return \"You can only select \" + limit + \" item\" + (limit == 1 ? \"\" : \"s\"); },\n         formatLoadMore: function (pageNumber) { return \"Loading more results…\"; },\n         formatSearching: function () { return \"Searching…\"; },\n    };\n\n    $.extend($.fn.select2.defaults, $.fn.select2.locales['en']);\n\n    $.fn.select2.ajaxDefaults = {\n        transport: $.ajax,\n        params: {\n            type: \"GET\",\n            cache: false,\n            dataType: \"json\"\n        }\n    };\n\n    // exports\n    window.Select2 = {\n        query: {\n            ajax: ajax,\n            local: local,\n            tags: tags\n        }, util: {\n            debounce: debounce,\n            markMatch: markMatch,\n            escapeMarkup: defaultEscapeMarkup,\n            stripDiacritics: stripDiacritics\n        }, \"class\": {\n            \"abstract\": AbstractSelect2,\n            \"single\": SingleSelect2,\n            \"multi\": MultiSelect2\n        }\n    };\n\n}(jQuery));\n\n\n//# sourceURL=webpack://mapss/./media/node_modules/select2/select2.js?");

/***/ })

}]);